/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var E=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var F=Object.prototype.hasOwnProperty;var U=(r,o,t)=>o in r?E(r,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[o]=t;var z=(r,o)=>{for(var t in o)E(r,t,{get:o[t],enumerable:!0})},q=(r,o,t,s)=>{if(o&&typeof o=="object"||typeof o=="function")for(let a of V(o))!F.call(r,a)&&a!==t&&E(r,a,{get:()=>o[a],enumerable:!(s=A(o,a))||s.enumerable});return r};var j=r=>q(E({},"__esModule",{value:!0}),r);var C=(r,o,t)=>(U(r,typeof o!="symbol"?o+"":o,t),t);var R={};z(R,{default:()=>x});module.exports=j(R);var h=require("obsidian");var $={edit:{en:"Edit",ru:"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C"},collapsed:{en:"Collapsed by default",ru:"\u0421\u0432\u0451\u0440\u043D\u0443\u0442\u044B\u0439 \u043F\u043E \u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E"},expanded:{en:"Expanded by default",ru:"\u0420\u0430\u0437\u0432\u0451\u0440\u043D\u0443\u0442\u044B\u0439 \u043F\u043E \u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E"},removeCollapsing:{en:"Remove collapsing",ru:"\u0423\u0431\u0440\u0430\u0442\u044C \u0441\u0432\u043E\u0440\u0430\u0447\u0438\u0432\u0430\u043D\u0438\u0435"},calloutType:{en:"Callout type",ru:"\u0422\u0438\u043F \u0432\u044B\u043D\u043E\u0441\u043D\u043E\u0433\u043E \u0431\u043B\u043E\u043A\u0430"},other:{en:"Other...",ru:"\u0414\u0440\u0443\u0433\u0438\u0435..."},calloutTypePlaceholder:{en:"Callout type...",ru:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0438\u043F \u0432\u044B\u043D\u043E\u0441\u043D\u043E\u0433\u043E \u0431\u043B\u043E\u043A\u0430..."},addMetadata:{en:"Add callout metadata",ru:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043C\u0435\u0442\u0430\u0434\u0430\u043D\u043D\u044B\u0435"},removeMetadata:{en:"Remove callout metadata",ru:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043C\u0435\u0442\u0430\u0434\u0430\u043D\u043D\u044B\u0435"},clearFormatting:{en:"Clear formatting",ru:"\u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C \u0444\u043E\u0440\u043C\u0430\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435"},calloutTypes:{en:"Callout types",ru:"\u0422\u0438\u043F\u044B \u0432\u044B\u043D\u043E\u0441\u043D\u044B\u0445 \u0431\u043B\u043E\u043A\u043E\u0432"},calloutTypesDesc:{en:"Write a list of callout types (separated by commas) that should appear in context menu.",ru:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043F\u0438\u0441\u043E\u043A \u0442\u0438\u043F\u043E\u0432 \u0432\u044B\u043D\u043E\u0441\u043D\u044B\u0445 \u0431\u043B\u043E\u043A\u043E\u0432, \u043A\u043E\u0442\u043E\u0440\u044B\u0435 \u0431\u0443\u0434\u0443\u0442 \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0430\u0442\u044C\u0441\u044F \u0432 \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442\u043D\u043E\u043C \u043C\u0435\u043D\u044E (\u0447\u0435\u0440\u0435\u0437 \u0437\u0430\u043F\u044F\u0442\u0443\u044E)."},metadataTypes:{en:"Callout metadata types",ru:"\u0422\u0438\u043F\u044B \u043C\u0435\u0442\u0430\u0434\u0430\u043D\u043D\u044B\u0445 \u0434\u043B\u044F \u0432\u044B\u043D\u043E\u0441\u043D\u044B\u0445 \u0431\u043B\u043E\u043A\u043E\u0432"},metadataTypesDesc:{en:"Write a list of callout metadata types (separated by commas) that should appear in context menu.",ru:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043F\u0438\u0441\u043E\u043A \u0442\u0438\u043F\u043E\u0432 \u043C\u0435\u0442\u0430\u0434\u0430\u043D\u043D\u044B\u0445 \u0434\u043B\u044F \u0432\u044B\u043D\u043E\u0441\u043D\u044B\u0445 \u0431\u043B\u043E\u043A\u043E\u0432, \u043A\u043E\u0442\u043E\u0440\u044B\u0435 \u0431\u0443\u0434\u0443\u0442 \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0430\u0442\u044C\u0441\u044F \u0432 \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442\u043D\u043E\u043C \u043C\u0435\u043D\u044E (\u0447\u0435\u0440\u0435\u0437 \u0437\u0430\u043F\u044F\u0442\u0443\u044E)."}},O={types:"note, info, tip",metaTypes:"no-icon, no-title"},x=class extends h.Plugin{constructor(){super(...arguments);C(this,"settings")}async onload(){await this.loadSettings(),this.addSettingTab(new k(this.app,this)),this.registerDomEvent(document,"mouseup",s=>{s.button==2&&this.createCalloutMenu(s)});let t;this.registerDomEvent(document,"touchstart",s=>{t=setTimeout(()=>{t=null,this.createCalloutMenu(s)},500)}),this.registerDomEvent(document,"touchend",s=>{clearTimeout(t)})}onunload(){}async loadSettings(){this.settings=Object.assign({},O,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}getPath(t){let s=p=>{let f=T=>{let c=T.parentElement||T.parentNode,d=-1,I;for(;c&&(I=c.childNodes[++d]);)if(I==T)return d;return-1},u,g=[],L=f(p);return(u=p.parentElement||p.parentNode)&&(g=s(u)),L>-1&&g.push(p),g},a=t.path;return a||(a=t.composedPath()),(!a||a.length==0)&&(a=s(t.target)),a}createCalloutMenu(t){let s=this.settings.types.split(",").map(g=>g.trim()),a=this.settings.metaTypes.split(",").map(g=>g.trim()),p=["note","info","important","tip","success","question","warning","example","quote","abstract","summary","tldr","todo","hint","check","done","question","faq","help","caution","attention","failure","fail","missing","danger","error","bug","example","cite"],u=this.getPath(t).find(g=>g.classList&&g.classList.contains("cm-callout"));if(u){let g=u.children[0].children[0].classList,L=u.children[0].children[0].getAttribute("data-callout-fold"),T=u.cmView.widget,c=T.editor.editor,d=c.offsetToPos(T.start).line,I=c.offsetToPos(T.end).line,y=c.getLine(d),b=[];for(let e=d;e<=I;e++)b.push(e);let w=y.replace(/(.*?])(.*)/,"$1"),D=u.cmView.widget.getType().replace(/([^|]+)(.*)/,"$1"),P=[...a],M=a.filter(e=>w.includes("|"+e+"|")||w.includes("|"+e+"]")),v=P.filter(e=>!w.includes("|"+e+"|")&&!w.includes("|"+e+"]")),i=new h.Menu;if(i.addItem(e=>e.setTitle(this.getLocalStrings().edit).onClick(()=>{t.target.click()})),i.addSeparator(),g.contains("is-collapsible")&&L=="-"?(i.addItem(e=>{e.setTitle(this.getLocalStrings().expanded).setIcon("plus").onClick(()=>{c.setLine(d,y.replace("]-","]+"))})}),i.addItem(e=>{e.setTitle(this.getLocalStrings().removeCollapsing).setIcon("x").onClick(()=>{c.setLine(d,y.replace("]-","]"))})})):g.contains("is-collapsible")&&L=="+"?(i.addItem(e=>{e.setTitle(this.getLocalStrings().collapsed).setIcon("minus").onClick(()=>{c.setLine(d,y.replace("]+","]-"))})}),i.addItem(e=>{e.setTitle(this.getLocalStrings().removeCollapsing).setIcon("x").onClick(()=>{c.setLine(d,y.replace("]+","]"))})})):(i.addItem(e=>{e.setTitle(this.getLocalStrings().collapsed).setIcon("minus").onClick(()=>{c.setLine(d,y.replace("]","]-"))})}),i.addItem(e=>{e.setTitle(this.getLocalStrings().expanded).setIcon("plus").onClick(()=>{c.setLine(d,y.replace("]","]+"))})})),i.addSeparator(),h.Platform.isMobile){for(let e of s)i.addItem(l=>{let n=e[0].toUpperCase()+e.slice(1,e.length).replace("|"," | ");l.setTitle(n).onClick(()=>{u.cmView.widget.updateType(e)}).setChecked(D==e)});if(i.addItem(e=>{let l=this.getLocalStrings().other;e.setTitle(l).onClick(async()=>{let n=await this.calloutSuggester(p);u.cmView.widget.updateType(n)})}),i.addSeparator(),v.length>0)for(let e of v)i.addItem(l=>{let n=e[0].toUpperCase()+e.slice(1,e.length).replace("|"," | ");l.setTitle(n).setIcon("plus").onClick(()=>{c.setLine(d,y.replace("]","|"+e+"]"))})});if(i.addSeparator(),M.length>0)for(let e of M)i.addItem(l=>{let n=e[0].toUpperCase()+e.slice(1,e.length).replace("|"," | ");l.setTitle(n).setIcon("minus").onClick(()=>{c.setLine(d,y.replace("|"+e,""))})})}else i.addItem(e=>{e.setTitle(this.getLocalStrings().calloutType);let l=e.setSubmenu();l.dom.classList.add("callout-menu");for(let n of s)l.addItem(m=>{let S=n[0].toUpperCase()+n.slice(1,n.length).replace("|"," | ");m.setTitle(S).onClick(()=>{u.cmView.widget.updateType(n)}).setChecked(D==n)});l.addItem(n=>{let m=this.getLocalStrings().other;n.setTitle(m).onClick(async()=>{let S=await this.calloutSuggester(p);u.cmView.widget.updateType(S)})})}),v.length>0&&i.addItem(e=>{e.setTitle(this.getLocalStrings().addMetadata);let l=e.setSubmenu();l.dom.classList.add("callout-menu");for(let n of v)l.addItem(m=>{let S=n[0].toUpperCase()+n.slice(1,n.length).replace("|"," | ");m.setTitle(S).onClick(()=>{c.setLine(d,y.replace("]","|"+n+"]"))})})}),M.length>0&&i.addItem(e=>{e.setTitle(this.getLocalStrings().removeMetadata);let l=e.setSubmenu();l.dom.classList.add("callout-menu");for(let n of M)l.addItem(m=>{let S=n[0].toUpperCase()+n.slice(1,n.length).replace("|"," | ");m.setTitle(S).onClick(()=>{c.setLine(d,y.replace("|"+n,""))})})});i.addSeparator(),i.addItem(e=>e.setTitle(this.getLocalStrings().clearFormatting).setIcon("eraser").onClick(()=>{for(let l of b){let m=c.getLine(l).replace(">","");l==d&&(m=m.replace("]+","]").replace("]-","]").replace(/(\[.*?\])(.*)/,"$2").replace(/^ /,"")),m=m.replace(/^ /,""),c.setLine(l,m)}})),i.showAtMouseEvent(t),i.dom.classList.add("callout-menu"),setTimeout(()=>{document.querySelectorAll(".menu:not(.callout-menu)").forEach(l=>{l.parentNode&&l.parentNode.removeChild(l)})},10)}}async calloutSuggester(t){let s=this.getLocalStrings().calloutTypePlaceholder;return new Promise((p,f)=>{new N(this.app,p,f,t,s).open()})}getLocalStrings(){var a,p;let t=(a=window.localStorage.getItem("language"))!=null?a:"en",s={...$};for(let f in s){let u=s[f];s[f]=(p=u[t])!=null?p:u.en}return s}},N=class extends h.FuzzySuggestModal{constructor(t,s,a,p,f){super(t);C(this,"resolve");C(this,"reject");C(this,"values");C(this,"placeholder");this.resolve=s,this.reject=a,this.values=p,this.placeholder=f}getItems(){return this.values}getItemText(t){return this.setPlaceholder(this.placeholder),t}renderSuggestion(t,s){let a=t.item;s.createEl("div",{text:a})}onChooseItem(t){this.resolve(t)}},k=class extends h.PluginSettingTab{constructor(t,s){super(t,s);C(this,"plugin");this.plugin=s}display(){let{containerEl:t}=this;t.empty(),new h.Setting(t).setName(this.plugin.getLocalStrings().calloutTypes).setDesc(this.plugin.getLocalStrings().calloutTypesDesc).addTextArea(s=>s.setValue(this.plugin.settings.types).onChange(async a=>{this.plugin.settings.types=a,await this.plugin.saveSettings()})),new h.Setting(t).setName(this.plugin.getLocalStrings().metadataTypes).setDesc(this.plugin.getLocalStrings().metadataTypesDesc).addTextArea(s=>s.setValue(this.plugin.settings.metaTypes).onChange(async a=>{this.plugin.settings.metaTypes=a,await this.plugin.saveSettings()}))}};

/* nosourcemap */