/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var v=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var U=Object.prototype.hasOwnProperty;var z=(r,o,e)=>o in r?v(r,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[o]=e;var q=(r,o)=>{for(var e in o)v(r,e,{get:o[e],enumerable:!0})},H=(r,o,e,a)=>{if(o&&typeof o=="object"||typeof o=="function")for(let s of F(o))!U.call(r,s)&&s!==e&&v(r,s,{get:()=>o[s],enumerable:!(a=V(o,s))||a.enumerable});return r};var j=r=>H(v({},"__esModule",{value:!0}),r);var f=(r,o,e)=>(z(r,typeof o!="symbol"?o+"":o,e),e);var R={};q(R,{default:()=>x});module.exports=j(R);var p=require("obsidian");var $={edit:{en:"Edit",ru:"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C"},collapsed:{en:"Collapsed by default",ru:"\u0421\u0432\u0451\u0440\u043D\u0443\u0442\u044B\u0439 \u043F\u043E \u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E"},expanded:{en:"Expanded by default",ru:"\u0420\u0430\u0437\u0432\u0451\u0440\u043D\u0443\u0442\u044B\u0439 \u043F\u043E \u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E"},removeCollapsing:{en:"Remove collapsing",ru:"\u0423\u0431\u0440\u0430\u0442\u044C \u0441\u0432\u043E\u0440\u0430\u0447\u0438\u0432\u0430\u043D\u0438\u0435"},calloutType:{en:"Callout type",ru:"\u0422\u0438\u043F \u0432\u044B\u043D\u043E\u0441\u043D\u043E\u0433\u043E \u0431\u043B\u043E\u043A\u0430"},other:{en:"Other...",ru:"\u0414\u0440\u0443\u0433\u0438\u0435..."},calloutTypePlaceholder:{en:"Callout type...",ru:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0438\u043F \u0432\u044B\u043D\u043E\u0441\u043D\u043E\u0433\u043E \u0431\u043B\u043E\u043A\u0430..."},addMetadata:{en:"Add callout metadata",ru:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043C\u0435\u0442\u0430\u0434\u0430\u043D\u043D\u044B\u0435"},removeMetadata:{en:"Remove callout metadata",ru:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043C\u0435\u0442\u0430\u0434\u0430\u043D\u043D\u044B\u0435"},clearFormatting:{en:"Clear formatting",ru:"\u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C \u0444\u043E\u0440\u043C\u0430\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435"},calloutTypes:{en:"Callout types",ru:"\u0422\u0438\u043F\u044B \u0432\u044B\u043D\u043E\u0441\u043D\u044B\u0445 \u0431\u043B\u043E\u043A\u043E\u0432"},calloutTypesDesc:{en:"Write a list of callout types (separated by commas) that should appear in context menu.",ru:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043F\u0438\u0441\u043E\u043A \u0442\u0438\u043F\u043E\u0432 \u0432\u044B\u043D\u043E\u0441\u043D\u044B\u0445 \u0431\u043B\u043E\u043A\u043E\u0432, \u043A\u043E\u0442\u043E\u0440\u044B\u0435 \u0431\u0443\u0434\u0443\u0442 \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0430\u0442\u044C\u0441\u044F \u0432 \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442\u043D\u043E\u043C \u043C\u0435\u043D\u044E (\u0447\u0435\u0440\u0435\u0437 \u0437\u0430\u043F\u044F\u0442\u0443\u044E)."},metadataTypes:{en:"Callout metadata types",ru:"\u0422\u0438\u043F\u044B \u043C\u0435\u0442\u0430\u0434\u0430\u043D\u043D\u044B\u0445 \u0434\u043B\u044F \u0432\u044B\u043D\u043E\u0441\u043D\u044B\u0445 \u0431\u043B\u043E\u043A\u043E\u0432"},metadataTypesDesc:{en:"Write a list of callout metadata types (separated by commas) that should appear in context menu.",ru:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043F\u0438\u0441\u043E\u043A \u0442\u0438\u043F\u043E\u0432 \u043C\u0435\u0442\u0430\u0434\u0430\u043D\u043D\u044B\u0445 \u0434\u043B\u044F \u0432\u044B\u043D\u043E\u0441\u043D\u044B\u0445 \u0431\u043B\u043E\u043A\u043E\u0432, \u043A\u043E\u0442\u043E\u0440\u044B\u0435 \u0431\u0443\u0434\u0443\u0442 \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0430\u0442\u044C\u0441\u044F \u0432 \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442\u043D\u043E\u043C \u043C\u0435\u043D\u044E (\u0447\u0435\u0440\u0435\u0437 \u0437\u0430\u043F\u044F\u0442\u0443\u044E)."}},O={types:"note, info, tip",metaTypes:"no-icon, no-title"},x=class extends p.Plugin{constructor(){super(...arguments);f(this,"settings")}async onload(){if(await this.loadSettings(),this.addSettingTab(new N(this.app,this)),p.Platform.isDesktop&&this.registerDomEvent(window,"contextmenu",e=>{e.button==2&&e.target.closest(".cm-callout")&&this.createCalloutMenu(e)}),p.Platform.isMobile){let e;this.registerDomEvent(window,"touchstart",a=>{a.target.closest(".cm-callout")&&(e=setTimeout(()=>{e=null,this.createCalloutMenu(a)},500))}),this.registerDomEvent(window,"touchend",a=>{clearTimeout(e)})}}onunload(){}async loadSettings(){this.settings=Object.assign({},O,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}getPath(e){let a=u=>{let m=C=>{let L=C.parentElement||C.parentNode,c=-1,d;for(;L&&(d=L.childNodes[++c]);)if(d==C)return c;return-1},y,S=[],I=m(u);return(y=u.parentElement||u.parentNode)&&(S=a(y)),I>-1&&S.push(u),S},s=e.path;return s||(s=e.composedPath()),(!s||s.length==0)&&(s=a(e.target)),s}createCalloutMenu(e){let a=e.target,s=a.closest(".cm-callout"),u=a.closest(".callout"),m=this.settings.types.split(",").map(t=>t.trim()),y=this.settings.metaTypes.split(",").map(t=>t.trim()),S=["note","info","important","tip","success","question","warning","example","quote","abstract","summary","tldr","todo","hint","check","done","question","faq","help","caution","attention","failure","fail","missing","danger","error","bug","example","cite"],I=u.classList,C=u.getAttribute("data-callout-fold"),L=s.cmView.widget,c=L.editor.editor,d=c.offsetToPos(L.start).line,P=c.offsetToPos(L.end).line,h=c.getLine(d),b=[];for(let t=d;t<=P;t++)b.push(t);let w=h.replace(/(.*?])(.*)/,"$1"),D=s.cmView.widget.getType().replace(/([^|]+)(.*)/,"$1"),A=[...y],M=y.filter(t=>w.includes("|"+t+"|")||w.includes("|"+t+"]")),E=A.filter(t=>!w.includes("|"+t+"|")&&!w.includes("|"+t+"]")),n=new p.Menu;if(n.addItem(t=>t.setTitle(this.getLocalStrings().edit).onClick(()=>{a.click()})),n.addSeparator(),I.contains("is-collapsible")&&C=="-"?(n.addItem(t=>{t.setTitle(this.getLocalStrings().expanded).setIcon("plus").onClick(()=>{c.setLine(d,h.replace("]-","]+"))})}),n.addItem(t=>{t.setTitle(this.getLocalStrings().removeCollapsing).setIcon("x").onClick(()=>{c.setLine(d,h.replace("]-","]"))})})):I.contains("is-collapsible")&&C=="+"?(n.addItem(t=>{t.setTitle(this.getLocalStrings().collapsed).setIcon("minus").onClick(()=>{c.setLine(d,h.replace("]+","]-"))})}),n.addItem(t=>{t.setTitle(this.getLocalStrings().removeCollapsing).setIcon("x").onClick(()=>{c.setLine(d,h.replace("]+","]"))})})):(n.addItem(t=>{t.setTitle(this.getLocalStrings().collapsed).setIcon("minus").onClick(()=>{c.setLine(d,h.replace("]","]-"))})}),n.addItem(t=>{t.setTitle(this.getLocalStrings().expanded).setIcon("plus").onClick(()=>{c.setLine(d,h.replace("]","]+"))})})),n.addSeparator(),p.Platform.isMobile){for(let t of m)n.addItem(i=>{let l=t[0].toUpperCase()+t.slice(1,t.length).replace("|"," | ");i.setTitle(l).onClick(()=>{s.cmView.widget.updateType(t)}).setChecked(D==t)});if(n.addItem(t=>{let i=this.getLocalStrings().other;t.setTitle(i).onClick(async()=>{let l=await this.calloutSuggester(S);s.cmView.widget.updateType(l)})}),n.addSeparator(),E.length>0)for(let t of E)n.addItem(i=>{let l=t[0].toUpperCase()+t.slice(1,t.length).replace("|"," | ");i.setTitle(l).setIcon("plus").onClick(()=>{c.setLine(d,h.replace("]","|"+t+"]"))})});if(n.addSeparator(),M.length>0)for(let t of M)n.addItem(i=>{let l=t[0].toUpperCase()+t.slice(1,t.length).replace("|"," | ");i.setTitle(l).setIcon("minus").onClick(()=>{c.setLine(d,h.replace("|"+t,""))})})}else n.addItem(t=>{t.setTitle(this.getLocalStrings().calloutType);let i=t.setSubmenu();i.dom.classList.add("callout-menu");for(let l of m)i.addItem(g=>{let T=l[0].toUpperCase()+l.slice(1,l.length).replace("|"," | ");g.setTitle(T).onClick(()=>{s.cmView.widget.updateType(l)}).setChecked(D==l)});i.addItem(l=>{let g=this.getLocalStrings().other;l.setTitle(g).onClick(async()=>{let T=await this.calloutSuggester(S);s.cmView.widget.updateType(T)})})}),E.length>0&&n.addItem(t=>{t.setTitle(this.getLocalStrings().addMetadata);let i=t.setSubmenu();i.dom.classList.add("callout-menu");for(let l of E)i.addItem(g=>{let T=l[0].toUpperCase()+l.slice(1,l.length).replace("|"," | ");g.setTitle(T).onClick(()=>{c.setLine(d,h.replace("]","|"+l+"]"))})})}),M.length>0&&n.addItem(t=>{t.setTitle(this.getLocalStrings().removeMetadata);let i=t.setSubmenu();i.dom.classList.add("callout-menu");for(let l of M)i.addItem(g=>{let T=l[0].toUpperCase()+l.slice(1,l.length).replace("|"," | ");g.setTitle(T).onClick(()=>{c.setLine(d,h.replace("|"+l,""))})})});n.addSeparator(),n.addItem(t=>t.setTitle(this.getLocalStrings().clearFormatting).setIcon("eraser").onClick(()=>{for(let i of b){let g=c.getLine(i).replace(">","");i==d&&(g=g.replace("]+","]").replace("]-","]").replace(/(\[.*?\])(.*)/,"$2").replace(/^ /,"")),g=g.replace(/^ /,""),c.setLine(i,g)}})),n.showAtMouseEvent(e),n.dom.classList.add("callout-menu")}async calloutSuggester(e){let a=this.getLocalStrings().calloutTypePlaceholder;return new Promise((u,m)=>{new k(this.app,u,m,e,a).open()})}getLocalStrings(){var s,u;let e=(s=window.localStorage.getItem("language"))!=null?s:"en",a={...$};for(let m in a){let y=a[m];a[m]=(u=y[e])!=null?u:y.en}return a}},k=class extends p.FuzzySuggestModal{constructor(e,a,s,u,m){super(e);f(this,"resolve");f(this,"reject");f(this,"values");f(this,"placeholder");this.resolve=a,this.reject=s,this.values=u,this.placeholder=m}getItems(){return this.values}getItemText(e){return this.setPlaceholder(this.placeholder),e}renderSuggestion(e,a){let s=e.item;a.createEl("div",{text:s})}onChooseItem(e){this.resolve(e)}},N=class extends p.PluginSettingTab{constructor(e,a){super(e,a);f(this,"plugin");this.plugin=a}display(){let{containerEl:e}=this;e.empty(),new p.Setting(e).setName(this.plugin.getLocalStrings().calloutTypes).setDesc(this.plugin.getLocalStrings().calloutTypesDesc).addTextArea(a=>a.setValue(this.plugin.settings.types).onChange(async s=>{this.plugin.settings.types=s,await this.plugin.saveSettings()})),new p.Setting(e).setName(this.plugin.getLocalStrings().metadataTypes).setDesc(this.plugin.getLocalStrings().metadataTypesDesc).addTextArea(a=>a.setValue(this.plugin.settings.metaTypes).onChange(async s=>{this.plugin.settings.metaTypes=s,await this.plugin.saveSettings()}))}};
