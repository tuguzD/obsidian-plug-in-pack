
/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var Pe=Object.create;var bt=Object.defineProperty;var Ie=Object.getOwnPropertyDescriptor;var Se=Object.getOwnPropertyNames;var Te=Object.getPrototypeOf,Ce=Object.prototype.hasOwnProperty;var xe=(e,n)=>{for(var t in n)bt(e,t,{get:n[t],enumerable:!0})},Zt=(e,n,t,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of Se(n))!Ce.call(e,a)&&a!==t&&bt(e,a,{get:()=>n[a],enumerable:!(s=Ie(n,a))||s.enumerable});return e};var Yt=(e,n,t)=>(t=e!=null?Pe(Te(e)):{},Zt(n||!e||!e.__esModule?bt(t,"default",{value:e,enumerable:!0}):t,e)),ke=e=>Zt(bt({},"__esModule",{value:!0}),e);var Ne={};xe(Ne,{default:()=>Et});module.exports=ke(Ne);var st=require("obsidian");function Ft(e,n){let t=Object.keys(n).map(s=>Ee(e,s,n[s]));return t.length===1?t[0]:function(){t.forEach(s=>s())}}function Ee(e,n,t){let s=e[n],a=e.hasOwnProperty(n),d=a?s:function(){return Object.getPrototypeOf(e)[n].apply(this,arguments)},l=t(d);return s&&Object.setPrototypeOf(l,s),Object.setPrototypeOf(h,l),e[n]=h,A;function h(...p){return l===d&&e[n]===h&&A(),l.apply(this,p)}function A(){e[n]===h&&(a?e[n]=d:delete e[n]),l!==d&&(l=d,Object.setPrototypeOf(h,s||Function))}}var M={annotations:{"plugins-annotations":{name:"Plugins Annotations",desc:"Allows writing annotations (just like this one) about the community plugins installed in the vault."}},plugins_annotations_uuid:"BC56AB7B-A46F-4ACF-9BA1-3A4461F74C79",hide_placeholders:!1,delete_placeholder_string_on_insertion:!1,label_mobile:"<b>Annotation:&nbsp;</b>",label_desktop:"<b>Personal annotation:&nbsp;</b>",label_placeholder:"<em>Add your personal comment about <strong>${plugin_name}</strong> here...</em>",editable:!0,automatic_remove:!1,markdown_file_path:"",show_github_icons:!0,backups:[],compatibility:"1.7.0"};function Vt(e){return typeof e!="object"||e===null?!1:"annotations"in e&&"compatibility"in e&&e.compatibility==="1.7.0"&&"plugins_annotations_uuid"in e&&e.plugins_annotations_uuid===M.plugins_annotations_uuid}function yt(e){if(typeof e!="object"||e===null)return!1;let n=e,t=typeof n.name=="string",s=typeof n.desc=="string";return t&&s}var vt={annotations:{"plugins-annotations":{name:"Plugins Annotations",desc:"Allows writing annotations (just like this one) about the community plugins installed in the vault."}},plugins_annotations_uuid:"BC56AB7B-A46F-4ACF-9BA1-3A4461F74C79",hide_placeholders:!1,delete_placeholder_string_on_insertion:!1,label_mobile:"<b>Annotation:&nbsp;</b>",label_desktop:"<b>Personal annotation:&nbsp;</b>",label_placeholder:"<em>Add your personal comment about <strong>${plugin_name}</strong> here...</em>",editable:!0,automatic_remove:!1,markdown_file_path:"",backups:[],compatibility:"1.6.0"},At={annotations:{"plugins-annotations":{name:"Plugins Annotations",desc:"Allows writing annotations (just like this one) about the community plugins installed in the vault.",type:"markdown"}},plugins_annotations_uuid:"BC56AB7B-A46F-4ACF-9BA1-3A4461F74C79",hide_placeholders:!1,delete_placeholder_string_on_insertion:!1,label_mobile:"<b>Annotation:&nbsp;</b>",label_desktop:"<b>Personal annotation:&nbsp;</b>",label_placeholder:"<em>Add your personal comment about <strong>${plugin_name}</strong> here...</em>",editable:!0,automatic_remove:!1,markdown_file_path:"",backups:[],compatibility:"1.5.0"},wt={plugins_annotations_uuid:"B265C5B2-A6AD-4194-9E4C-C1327DB1EA18",hide_placeholders:!1,delete_placeholder_string_on_insertion:!1,label_mobile:"<b>Annotation:&nbsp;</b>",label_desktop:"<b>Personal annotation:&nbsp;</b>",label_placeholder:"<em>Add your personal comment about <strong>${plugin_name}</strong> here...</em>",editable:!0,automatic_remove:!1,annotations:{}},Pt={plugins_annotations_uuid:"FAA70013-38E9-4FDF-B06A-F899F6487C19",hide_placeholders:!1,delete_placeholder_string_on_insertion:!1,label_mobile:"<b>Annotation:&nbsp;</b>",label_desktop:"<b>Personal annotation:&nbsp;</b>",label_placeholder:"<em>Add your personal comment about <strong>${plugin_name}</strong> here...</em>",editable:!0,automatic_remove:!1,annotations:{}};function Wt(e){return typeof e!="object"||e===null?!1:"annotations"in e&&"compatibility"in e&&e.compatibility==="1.6.0"&&"plugins_annotations_uuid"in e&&e.plugins_annotations_uuid===vt.plugins_annotations_uuid}function Jt(e){return typeof e!="object"||e===null?!1:"annotations"in e&&"compatibility"in e&&e.compatibility==="1.5.0"&&"plugins_annotations_uuid"in e&&e.plugins_annotations_uuid===At.plugins_annotations_uuid}function Qt(e){return typeof e!="object"||e===null?!1:"annotations"in e&&"plugins_annotations_uuid"in e&&e.plugins_annotations_uuid===wt.plugins_annotations_uuid}function qt(e){let n=e.split(`
`),t=n[0].toLowerCase(),s=n.slice(1).join(`
`);return t.startsWith("html:")?{type:"html",content:s}:t.startsWith("markdown:")?{type:"markdown",content:s.replace(/\$\{label\}/g,"")}:t.startsWith("text:")?{type:"text",content:s}:{type:"text",content:e}}function Xt(e){return typeof e!="object"||e===null?!1:Object.values(e).every(n=>typeof n=="string")}function Kt(e){return typeof e!="object"||e===null?!1:"annotations"in e&&"plugins_annotations_uuid"in e&&e.plugins_annotations_uuid===Pt.plugins_annotations_uuid}var le=require("obsidian");var O=require("obsidian"),St=Yt(require("path"));function et(e){e=(0,O.normalizePath)(e);let n=e.lastIndexOf("/"),t=n!==-1?e.substring(0,n):"",s=n!==-1?e.substring(n+1):e,a=s.lastIndexOf("."),d=a!==-1?s.substring(0,a):s,l=a!==-1?s.substring(a):"";return{dir:(0,O.normalizePath)(t),base:s,filename:d,ext:l,path:e}}function nt(e,n,t){return new Promise(s=>{let a=new class extends O.Modal{resolveState;constructor(l){super(l),this.resolveState=!1}onClose(){s(this.resolveState)}}(e);a.titleEl.setText(n),typeof t=="string"?a.contentEl.setText(t):a.contentEl.appendChild(t);let d=a.contentEl.createDiv({cls:"modal-button-container"});d.createEl("button",{text:"Yes",cls:"mod-cta"}).addEventListener("click",()=>{a.resolveState=!0,a.close()}),d.createEl("button",{text:"No"}).addEventListener("click",()=>{a.resolveState=!1,a.close()}),a.open()})}function te(e){return e.split(St.posix.sep).join(St.sep)}function ee(...e){return e.join("/")}function Le(e){return e instanceof O.TFolder}function Me(e,n){let t=e.getAbstractFileByPath(n);return!!t&&Le(t)}async function ne(e,n){if(!await e.adapter.exists(n))return null;let s=n.toLowerCase();for(let a of e.getFiles())if(a.path.toLowerCase()===s)return a;return null}async function ie(e,n){if(!Me(e,n))try{await e.createFolder(n)}catch(t){throw new Error(`Failed to create folder at ${n}: ${t}`)}}function se(e,n){let t=null,s=null,a=null;return{waitFnc:async()=>{for(;s;)await s},debouncedFct:(...d)=>{t&&(clearTimeout(t),t=null);let l=a;s=new Promise((h,A)=>{a=()=>{h()},t=setTimeout(async()=>{s=null,a=null,t=null;try{await e(...d),h()}catch(p){A(p)}},n)}),l&&l()}}}var It=class extends O.AbstractInputSuggest{constructor(t,s,a=d=>{}){super(t,s);this.onSelectCallback=a}files=[];doFuzzySearch(t,s=20,a=-2){if(!t||t.length<2)return[];let d=(0,O.prepareFuzzySearch)(t),h=this.files.map(A=>[A,d(A.path)]).filter(([,A])=>A!==null&&A.score>a);return h.sort(([,A],[,p])=>p.score-A.score),h.map(A=>A[0]).slice(0,s)}getSuggestions(t){return this.doFuzzySearch(t)}renderSuggestion(t,s){s.setText(t.path)}selectSuggestion(t,s){this.onSelectCallback(t),this.textInputEl.value=t.path,this.textInputEl.dispatchEvent(new Event("change")),this.textInputEl.setSelectionRange(0,1),this.textInputEl.setSelectionRange(this.textInputEl.value.length,this.textInputEl.value.length),this.textInputEl.focus(),this.close()}setSuggestions(t){this.files=t}};function oe(e,n="data.json"){if(typeof e!="object"||e===null)return!1;let t=JSON.stringify(e,null,2),s=new Blob([t],{type:"application/json"}),a=URL.createObjectURL(s),d=document.createElement("a");d.href=a,d.download=n,document.body.appendChild(d),d.click(),setTimeout(()=>{document.body.removeChild(d),URL.revokeObjectURL(a)},0)}function Tt(e){let n=Object.entries(e).map(([t,s])=>({pluginId:t,name:s.name}));return n.sort((t,s)=>t.name.localeCompare(s.name)),n.map(t=>t.pluginId)}async function Q(e,n,t){if(typeof n!="object"||n===null)return;let s;if(n.hasOwnProperty("backups")){let{backups:d,...l}=n;s=l}else s=n;let a=structuredClone(s);t.unshift({name:e,date:new Date,settings:a})}function it(e){return new Promise(n=>setTimeout(n,e))}function De(e,n){function t(){this.constructor=e}t.prototype=n.prototype,e.prototype=new t}function V(e,n,t,s){var a=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(a,V.prototype),a.expected=n,a.found=t,a.location=s,a.name="SyntaxError",a}De(V,Error);function Nt(e,n,t){return t=t||" ",e.length>n?e:(n-=e.length,t+=t.repeat(n),e+t.slice(0,n))}V.prototype.format=function(e){var n="Error: "+this.message;if(this.location){var t=null,s;for(s=0;s<e.length;s++)if(e[s].source===this.location.source){t=e[s].text.split(/\r\n|\n|\r/g);break}var a=this.location.start,d=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(a):a,l=this.location.source+":"+d.line+":"+d.column;if(t){var h=this.location.end,A=Nt("",d.line.toString().length," "),p=t[a.line-1],f=a.line===h.line?h.column:p.length+1,C=f-a.column||1;n+=`
 --> `+l+`
`+A+` |
`+d.line+" | "+p+`
`+A+" | "+Nt("",a.column-1," ")+Nt("",C,"^")}else n+=`
 at `+l}return n};V.buildMessage=function(e,n){var t={literal:function(p){return'"'+a(p.text)+'"'},class:function(p){var f=p.parts.map(function(C){return Array.isArray(C)?d(C[0])+"-"+d(C[1]):d(C)});return"["+(p.inverted?"^":"")+f.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(p){return p.description}};function s(p){return p.charCodeAt(0).toString(16).toUpperCase()}function a(p){return p.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(f){return"\\x0"+s(f)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(f){return"\\x"+s(f)})}function d(p){return p.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(f){return"\\x0"+s(f)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(f){return"\\x"+s(f)})}function l(p){return t[p.type](p)}function h(p){var f=p.map(l),C,E;if(f.sort(),f.length>0){for(C=1,E=1;C<f.length;C++)f[C-1]!==f[C]&&(f[E]=f[C],E++);f.length=E}switch(f.length){case 1:return f[0];case 2:return f[0]+" or "+f[1];default:return f.slice(0,-1).join(", ")+", or "+f[f.length-1]}}function A(p){return p?'"'+a(p)+'"':"end of input"}return"Expected "+h(e)+" but "+A(n)+" found."};function ae(e,n){n=n!==void 0?n:{};var t={},s=n.grammarSource,a={main:zt},d=zt,l="#",h="<!--",A="id:",p="-->",f=":",C="BEGIN",E="ANNOTATION",B="END",N=/^[^\n\r]/,dt=/^[\n\r]/,pt=/^[ \f\t\v \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]/,ht=J("#",!1),q=J("<!--",!1),mt=J("id:",!1),j=J("-->",!1),R=ue(),K=J(":",!1),ft=J("BEGIN",!1),ot=J("ANNOTATION",!1),u=J("END",!1),P=Mt([`
`,"\r"],!0,!1),L=Mt([`
`,"\r"],!1,!1),$=Mt([" ","\f","	","\v"," ","\xA0","\u1680",["\u2000","\u200A"],"\u2028","\u2029","\u202F","\u205F","\u3000","\uFEFF"],!1,!1),z=function(o){return o.reduce((c,g)=>(g&&Ae(c,g),c),{})},Y=function(o,r,c){let g=r.reduce((y,I)=>(y[I.tag]=I.arg,y),{}),w=!0;for(let y of we)if(!(y in g)){w=!1;break}return w&&c.trim()!==""?{id:g.id,name:o,desc:c}:null},W=function(o){return{tag:"id",arg:o}},Z=function(o,r){return{tag:o,arg:r}},i=n.peg$currPos|0,G=i,tt=[{line:1,column:1}],U=i,_t=n.peg$maxFailExpected||[],_=n.peg$silentFails|0,at;if(n.startRule){if(!(n.startRule in a))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');d=a[n.startRule]}function je(){return e.substring(G,i)}function He(){return G}function Be(){return{source:s,start:G,end:i}}function $e(){return lt(G,i)}function Oe(o,r){throw r=r!==void 0?r:lt(G,i),Rt([ge(o)],e.substring(G,i),r)}function Re(o,r){throw r=r!==void 0?r:lt(G,i),de(o,r)}function J(o,r){return{type:"literal",text:o,ignoreCase:r}}function Mt(o,r,c){return{type:"class",parts:o,inverted:r,ignoreCase:c}}function ue(){return{type:"any"}}function ce(){return{type:"end"}}function ge(o){return{type:"other",description:o}}function Ot(o){var r=tt[o],c;if(r)return r;if(o>=tt.length)c=tt.length-1;else for(c=o;!tt[--c];);for(r=tt[c],r={line:r.line,column:r.column};c<o;)e.charCodeAt(c)===10?(r.line++,r.column=1):r.column++,c++;return tt[o]=r,r}function lt(o,r,c){var g=Ot(o),w=Ot(r),y={source:s,start:{offset:o,line:g.line,column:g.column},end:{offset:r,line:w.line,column:w.column}};return c&&s&&typeof s.offset=="function"&&(y.start=s.offset(y.start),y.end=s.offset(y.end)),y}function T(o){i<U||(i>U&&(U=i,_t=[]),_t.push(o))}function de(o,r){return new V(o,null,null,r)}function Rt(o,r,c){return new V(V.buildMessage(o,r),o,r,c)}function zt(){var o,r,c;for(o=i,r=[],c=Gt();c!==t;)r.push(c),c=Gt();return G=o,r=z(r),o=r,o}function Gt(){var o;return o=pe(),o===t&&(o=ye()),o}function pe(){var o,r,c,g,w,y;if(o=i,r=he(),r!==t){if(c=[],g=Ut(),g!==t)for(;g!==t;)c.push(g),g=Ut();else c=t;c!==t?(g=_e(),g!==t?(w=be(),y=Dt(),y!==t?(G=o,o=Y(r,c,w)):(i=o,o=t)):(i=o,o=t)):(i=o,o=t)}else i=o,o=t;return o}function he(){var o,r,c,g,w,y;if(o=i,e.charCodeAt(i)===35?(r=l,i++):(r=t,_===0&&T(ht)),r!==t)if(c=k(),c!==t)if(g=i,w=ve(),w!==t?g=e.substring(g,i):g=w,g!==t){if(w=[],y=H(),y!==t)for(;y!==t;)w.push(y),y=H();else w=t;w!==t?o=g:(i=o,o=t)}else i=o,o=t;else i=o,o=t;else i=o,o=t;return o}function me(){var o,r,c,g,w,y,I,b,m,v,S;if(o=i,e.substr(i,4)===h?(r=h,i+=4):(r=t,_===0&&T(q)),r!==t){for(c=[],g=k();g!==t;)c.push(g),g=k();if(e.substr(i,3)===A?(g=A,i+=3):(g=t,_===0&&T(mt)),g!==t)if(w=k(),w!==t){if(y=i,I=[],b=i,m=i,_++,e.substr(i,3)===p?(v=p,i+=3):(v=t,_===0&&T(j)),_--,v===t?m=void 0:(i=m,m=t),m!==t?(v=i,_++,S=k(),_--,S===t?v=void 0:(i=v,v=t),v!==t?(e.length>i?(S=e.charAt(i),i++):(S=t,_===0&&T(R)),S!==t?(m=[m,v,S],b=m):(i=b,b=t)):(i=b,b=t)):(i=b,b=t),b!==t)for(;b!==t;)I.push(b),b=i,m=i,_++,e.substr(i,3)===p?(v=p,i+=3):(v=t,_===0&&T(j)),_--,v===t?m=void 0:(i=m,m=t),m!==t?(v=i,_++,S=k(),_--,S===t?v=void 0:(i=v,v=t),v!==t?(e.length>i?(S=e.charAt(i),i++):(S=t,_===0&&T(R)),S!==t?(m=[m,v,S],b=m):(i=b,b=t)):(i=b,b=t)):(i=b,b=t);else I=t;if(I!==t?y=e.substring(y,i):y=I,y!==t){for(I=[],b=k();b!==t;)I.push(b),b=k();if(e.substr(i,3)===p?(b=p,i+=3):(b=t,_===0&&T(j)),b!==t){if(m=[],v=H(),v!==t)for(;v!==t;)m.push(v),v=H();else m=t;m!==t?(G=o,o=W(y)):(i=o,o=t)}else i=o,o=t}else i=o,o=t}else i=o,o=t;else i=o,o=t}else i=o,o=t;return o}function fe(){var o,r,c,g,w,y,I,b,m,v,S,D,F;if(o=i,e.substr(i,4)===h?(r=h,i+=4):(r=t,_===0&&T(q)),r!==t){for(c=[],g=k();g!==t;)c.push(g),g=k();for(g=i,w=[],y=i,I=i,_++,e.charCodeAt(i)===58?(b=f,i++):(b=t,_===0&&T(K)),_--,b===t?I=void 0:(i=I,I=t),I!==t?(b=i,_++,e.substr(i,3)===p?(m=p,i+=3):(m=t,_===0&&T(j)),_--,m===t?b=void 0:(i=b,b=t),b!==t?(e.length>i?(m=e.charAt(i),i++):(m=t,_===0&&T(R)),m!==t?(I=[I,b,m],y=I):(i=y,y=t)):(i=y,y=t)):(i=y,y=t);y!==t;)w.push(y),y=i,I=i,_++,e.charCodeAt(i)===58?(b=f,i++):(b=t,_===0&&T(K)),_--,b===t?I=void 0:(i=I,I=t),I!==t?(b=i,_++,e.substr(i,3)===p?(m=p,i+=3):(m=t,_===0&&T(j)),_--,m===t?b=void 0:(i=b,b=t),b!==t?(e.length>i?(m=e.charAt(i),i++):(m=t,_===0&&T(R)),m!==t?(I=[I,b,m],y=I):(i=y,y=t)):(i=y,y=t)):(i=y,y=t);if(g=e.substring(g,i),e.charCodeAt(i)===58?(w=f,i++):(w=t,_===0&&T(K)),w!==t){for(y=[],I=k();I!==t;)y.push(I),I=k();for(I=i,b=[],m=i,v=i,_++,S=i,D=[],F=k();F!==t;)D.push(F),F=k();for(e.substr(i,3)===p?(F=p,i+=3):(F=t,_===0&&T(j)),F!==t?(D=[D,F],S=D):(i=S,S=t),_--,S===t?v=void 0:(i=v,v=t),v!==t?(e.length>i?(S=e.charAt(i),i++):(S=t,_===0&&T(R)),S!==t?(v=[v,S],m=v):(i=m,m=t)):(i=m,m=t);m!==t;){for(b.push(m),m=i,v=i,_++,S=i,D=[],F=k();F!==t;)D.push(F),F=k();e.substr(i,3)===p?(F=p,i+=3):(F=t,_===0&&T(j)),F!==t?(D=[D,F],S=D):(i=S,S=t),_--,S===t?v=void 0:(i=v,v=t),v!==t?(e.length>i?(S=e.charAt(i),i++):(S=t,_===0&&T(R)),S!==t?(v=[v,S],m=v):(i=m,m=t)):(i=m,m=t)}for(I=e.substring(I,i),b=[],m=k();m!==t;)b.push(m),m=k();if(e.substr(i,3)===p?(m=p,i+=3):(m=t,_===0&&T(j)),m!==t){if(v=[],S=H(),S!==t)for(;S!==t;)v.push(S),S=H();else v=t;v!==t?(G=o,o=Z(g,I)):(i=o,o=t)}else i=o,o=t}else i=o,o=t}else i=o,o=t;return o}function Ut(){var o;return o=me(),o===t&&(o=fe()),o}function _e(){var o,r,c,g,w,y,I,b,m,v,S;if(o=i,r=i,e.substr(i,4)===h?(c=h,i+=4):(c=t,_===0&&T(q)),c!==t){for(g=[],w=k();w!==t;)g.push(w),w=k();if(e.substr(i,5)===C?(w=C,i+=5):(w=t,_===0&&T(ft)),w!==t){for(y=[],I=k();I!==t;)y.push(I),I=k();if(e.substr(i,10)===E?(I=E,i+=10):(I=t,_===0&&T(ot)),I!==t){for(b=[],m=k();m!==t;)b.push(m),m=k();if(e.substr(i,3)===p?(m=p,i+=3):(m=t,_===0&&T(j)),m!==t){for(v=[],S=H();S!==t;)v.push(S),S=H();c=[c,g,w,y,I,b,m,v],r=c}else i=r,r=t}else i=r,r=t}else i=r,r=t}else i=r,r=t;return r!==t?o=e.substring(o,i):o=r,o}function Dt(){var o,r,c,g,w,y,I,b,m,v,S,D;for(o=i,r=i,c=[],g=H();g!==t;)c.push(g),g=H();if(e.substr(i,4)===h?(g=h,i+=4):(g=t,_===0&&T(q)),g!==t){for(w=[],y=k();y!==t;)w.push(y),y=k();if(e.substr(i,3)===B?(y=B,i+=3):(y=t,_===0&&T(u)),y!==t){for(I=[],b=k();b!==t;)I.push(b),b=k();if(e.substr(i,10)===E?(b=E,i+=10):(b=t,_===0&&T(ot)),b!==t){for(m=[],v=k();v!==t;)m.push(v),v=k();if(e.substr(i,3)===p?(v=p,i+=3):(v=t,_===0&&T(j)),v!==t){if(S=[],D=H(),D!==t)for(;D!==t;)S.push(D),D=H();else S=t;S!==t?(c=[c,g,w,y,I,b,m,v,S],r=c):(i=r,r=t)}else i=r,r=t}else i=r,r=t}else i=r,r=t}else i=r,r=t;return r!==t?o=e.substring(o,i):o=r,o}function be(){var o,r,c,g,w;for(o=i,r=[],c=i,g=i,_++,w=Dt(),_--,w===t?g=void 0:(i=g,g=t),g!==t?(e.length>i?(w=e.charAt(i),i++):(w=t,_===0&&T(R)),w!==t?(g=[g,w],c=g):(i=c,c=t)):(i=c,c=t);c!==t;)r.push(c),c=i,g=i,_++,w=Dt(),_--,w===t?g=void 0:(i=g,g=t),g!==t?(e.length>i?(w=e.charAt(i),i++):(w=t,_===0&&T(R)),w!==t?(g=[g,w],c=g):(i=c,c=t)):(i=c,c=t);return o=e.substring(o,i),o}function ye(){var o,r,c,g;for(o=i,r=i,c=[],g=e.charAt(i),N.test(g)?i++:(g=t,_===0&&T(P));g!==t;)c.push(g),g=e.charAt(i),N.test(g)?i++:(g=t,_===0&&T(P));if(g=H(),g!==t?(c=[c,g],r=c):(i=r,r=t),r===t)if(r=[],c=e.charAt(i),N.test(c)?i++:(c=t,_===0&&T(P)),c!==t)for(;c!==t;)r.push(c),c=e.charAt(i),N.test(c)?i++:(c=t,_===0&&T(P));else r=t;return r!==t?o=e.substring(o,i):o=r,o}function ve(){var o,r;if(o=[],r=e.charAt(i),N.test(r)?i++:(r=t,_===0&&T(P)),r!==t)for(;r!==t;)o.push(r),r=e.charAt(i),N.test(r)?i++:(r=t,_===0&&T(P));else o=t;return o}function H(){var o;return o=e.charAt(i),dt.test(o)?i++:(o=t,_===0&&T(L)),o}function k(){var o;return o=e.charAt(i),pt.test(o)?i++:(o=t,_===0&&T($)),o}function Ae(o,r){if(r.id){let{id:c,...g}=r;o[c]=g}return o}let we=["id"];if(at=d(),n.peg$library)return{peg$result:at,peg$currPos:i,peg$FAILED:t,peg$maxFailExpected:_t,peg$maxFailPos:U};if(at!==t&&i===e.length)return at;throw at!==t&&i<e.length&&T(ce()),Rt(_t,U<e.length?e.charAt(U):null,U<e.length?lt(U,U+1):lt(U,U))}var rt=!1;async function re(e,n){let t=e.app.vault.getAbstractFileByPath(n),{base:s}=et(n);if(t){let{base:a}=et(n),d=createFragment(h=>{h.appendText("The file "),le.Platform.isDesktopApp?h.createEl("a",{text:a,href:"#"}).addEventListener("click",p=>{p.preventDefault(),window.require("electron").remote.shell.showItemInFolder(te(ee(e.getVaultPath(),n)))}):h.createEl("strong",{text:a}),h.appendText(" already exists. Do you want to replace the file with your personal annotations about the installed plugins? If you reply yes, the existing file is moved to the trash.")});if(!await nt(e.app,"Overwrite file",d))return!1;await e.app.vault.adapter.trashSystem(t.path)}else{let a=createFragment(l=>{l.appendText("The file "),l.createEl("strong",{text:s}),l.appendText(" does not exist. Do you want to create it?")});if(!await nt(e.app,"Create file",a))return!1}return!0}async function jt(e){if(rt)return;let n=e.settings.markdown_file_path,t=e.app.vault.getFileByPath(n);if(!t){Ht(e);return}try{let s=await e.app.vault.read(t);try{let a=ae(s);e.settings.annotations=a}catch(a){a instanceof V?console.error("Syntax error:",a):console.error("Unexpected error:",a)}}catch(s){console.error("Failed to read annotations from file:",s);return}}async function Ht(e){if(!e.pluginNameToIdMap)return;let n=e.settings.markdown_file_path;if(n==="")return;let t=e.settings.annotations,a=["Make changes only within the annotation blocks marked by `<!-- BEGIN ANNOTATION -->` and `<!-- END ANNOTATION -->`. Changes made anywhere else will be overwritten.\n"];for(let l of e.sortedPluginIds)a.push(`# ${t[l].name}

<!-- id: ${l} -->
<!-- BEGIN ANNOTATION -->
${t[l].desc}
<!-- END ANNOTATION -->
`);let d=a.join(`
`);try{let l=await ne(e.app.vault,n);if(l!==null&&l.path!==n&&(await e.app.vault.adapter.remove(l.path),l=null),l)rt=!0,await e.app.vault.modify(l,d),rt=!1;else{try{let{dir:h}=et(n);await ie(e.app.vault,h)}catch(h){console.error("Failed to create folder for Markdown file with annotations:",h);return}rt=!0,l=await e.app.vault.create(n,d),rt=!1}}catch(l){console.error("Failed to write Markdown file with annotations:",l);return}}var x=require("obsidian");var kt=require("obsidian");var ut=atob("PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxOCIgaGVpZ2h0PSIxOCIgdmlld0JveD0iMCAwIDI0IDI0IiBcCiAgICAgICAgICAgICAgICAgICAgZmlsbD0ibm9uZSIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0ibHVjaWRlIGx1Y2lkZS1sb2NrLW9wZW4iPlwKICAgICAgICAgICAgICAgICAgICA8cmVjdCB3aWR0aD0iMTgiIGhlaWdodD0iMTEiIHg9IjMiIHk9IjExIiByeD0iMiIgcnk9IjIiLz5cCiAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik03IDExdi00YzAtMi44IDIuMi01IDUtNSAxLjYgMCAzLjEuOCA0IDIiLz4gXAogICAgICAgICAgICAgICAgPC9zdmc+"),ct=atob("PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxOCIgaGVpZ2h0PSIxOCIgdmlld0JveD0iMCAwIDI0IDI0IiBcCiAgICAgICAgICAgICAgICAgICAgZmlsbD0ibm9uZSIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0ibHVjaWRlIGx1Y2lkZS1sb2NrIj5cCiAgICAgICAgICAgICAgICAgICAgPHJlY3Qgd2lkdGg9IjE4IiBoZWlnaHQ9IjExIiB4PSIzIiB5PSIxMSIgcng9IjIiIHJ5PSIyIi8+XAogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik03IDExVjdhNSA1IDAgMCAxIDEwIDB2NCIvPlwKICAgICAgICAgICAgICAgIDwvc3ZnPg=="),Ct=atob("PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9InN2Zy1pY29uIGx1Y2lkZS1zZXR0aW5ncyI+CiAgPGRlZnM+CiAgICA8c3R5bGU+CiAgICAgIC5jbHMtMSB7CiAgICAgICAgZmlsbDogIzI0MjkyZjsKICAgICAgICBmaWxsLXJ1bGU6IGV2ZW5vZGQ7CiAgICAgICAgc3Ryb2tlLXdpZHRoOiAwcHg7CiAgICAgIH0KICAgIDwvc3R5bGU+CiAgPC9kZWZzPgogIDxwYXRoIGNsYXNzPSJjbHMtMSIgZD0iTTEyLC4zQzUuNC4zLjEsNS43LjEsMTIuM3MzLjQsOS44LDguMSwxMS40Yy42LjEuOC0uMy44LS42czAtMS4yLDAtMi4yYy0zLjMuNy00LTEuNC00LTEuNC0uNS0xLjQtMS4zLTEuNy0xLjMtMS43LTEuMS0uNywwLS43LDAtLjcsMS4yLDAsMS44LDEuMiwxLjgsMS4yLDEuMSwxLjgsMi44LDEuMywzLjUsMSwwLS44LjQtMS4zLjctMS42LTIuNi0uMy01LjQtMS4zLTUuNC01LjlzLjUtMi40LDEuMi0zLjJjLS4xLS4zLS41LTEuNS4xLTMuMiwwLDAsMS0uMywzLjMsMS4yLDEtLjMsMi0uNCwzLS40LDEsMCwyLC4xLDMsLjQsMi4zLTEuNSwzLjMtMS4yLDMuMy0xLjIuNywxLjYuMiwyLjkuMSwzLjIuOC44LDEuMiwxLjksMS4yLDMuMiwwLDQuNi0yLjgsNS42LTUuNCw1LjkuNC40LjgsMS4xLjgsMi4yLDAsMS42LDAsMi45LDAsMy4zcy4yLjcuOC42YzQuNy0xLjYsOC4xLTYuMSw4LjEtMTEuNCwwLTYuNi01LjMtMTItMTEuOS0xMloiPjwvcGF0aD4KPC9zdmc+"),xt=atob("PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9InN2Zy1pY29uIGx1Y2lkZS1zZXR0aW5ncyI+CiAgPGRlZnM+CiAgICA8c3R5bGU+CiAgICAgIC5jbHMtMSB7CiAgICAgICAgZmlsbDogI2ZmZjsKICAgICAgICBmaWxsLXJ1bGU6IGV2ZW5vZGQ7CiAgICAgICAgc3Ryb2tlLXdpZHRoOiAwcHg7CiAgICAgIH0KICAgIDwvc3R5bGU+CiAgPC9kZWZzPgogIDxwYXRoIGNsYXNzPSJjbHMtMSIgZD0iTTEyLC4zQzUuNC4zLjEsNS43LjEsMTIuM3MzLjQsOS44LDguMSwxMS40Yy42LjEuOC0uMy44LS42czAtMS4yLDAtMi4yYy0zLjMuNy00LTEuNC00LTEuNC0uNS0xLjQtMS4zLTEuNy0xLjMtMS43LTEuMS0uNywwLS43LDAtLjcsMS4yLDAsMS44LDEuMiwxLjgsMS4yLDEuMSwxLjgsMi44LDEuMywzLjUsMSwwLS44LjQtMS4zLjctMS42LTIuNi0uMy01LjQtMS4zLTUuNC01LjlzLjUtMi40LDEuMi0zLjJjLS4xLS4zLS41LTEuNS4xLTMuMiwwLDAsMS0uMywzLjMsMS4yLDEtLjMsMi0uNCwzLS40LDEsMCwyLC4xLDMsLjQsMi4zLTEuNSwzLjMtMS4yLDMuMy0xLjIuNiwxLjYuMiwyLjkuMSwzLjIuOC44LDEuMiwxLjksMS4yLDMuMiwwLDQuNi0yLjgsNS42LTUuNCw1LjkuNC40LjgsMS4xLjgsMi4yLDAsMS42LDAsMi45LDAsMy4zcy4yLjcuOC42YzQuNy0xLjYsOC4xLTYuMSw4LjEtMTEuNCwwLTYuNi01LjMtMTItMTEuOS0xMloiPjwvcGF0aD4KPC9zdmc+");var Fe="https://github.com/",X=class{constructor(n,t,s,a){this.plugin=n;this.annotation_container=t;this.pluginId=s;this.pluginName=a;this.clickedLink=!1,this.isPlaceholder=!(this.plugin.settings.annotations.hasOwnProperty(s)&&yt(this.plugin.settings.annotations[s])),this.label=kt.Platform.isMobile?this.plugin.settings.label_mobile:this.plugin.settings.label_desktop,this.placeholder=this.plugin.settings.label_placeholder.replace(/\$\{plugin_name\}/g,a),this.annotation_div=document.createElement("div"),this.annotation_div.className="plugin-comment-annotation",this.plugin.settings.editable?(this.annotation_div.contentEditable="true",this.annotation_div.classList.add("plugin-comment-annotation-editable")):(this.annotation_div.contentEditable="false",this.annotation_div.classList.remove("plugin-comment-annotation-editable")),this.isPlaceholder?(this.annotationDesc=this.placeholder.trim(),this.setPlaceholderClasses()):this.annotationDesc=this.plugin.settings.annotations[s].desc,this.renderAnnotation(),this.addEventListeners(),t.appendChild(this.annotation_div)}clickedLink;isPlaceholder;annotationDesc;placeholder;label;annotation_div;addEventListeners(){this.annotation_div.addEventListener("mousedown",n=>{n.target&&n.target.tagName==="A"?this.clickedLink=!0:this.clickedLink=!1}),this.annotation_div.addEventListener("click",n=>{if(this.plugin.settings.editable)n.stopPropagation();else return}),this.annotation_div.addEventListener("focus",async n=>{if(!this.clickedLink)if(this.plugin.annotationBeingEdited=!0,this.isPlaceholder){if(this.plugin.settings.delete_placeholder_string_on_insertion)this.annotation_div.innerText="";else{let t=this.annotation_div.innerText;this.annotation_div.innerText=t}this.removePlaceholderClasses(),this.selectExistingText()}else this.annotation_div.innerText=this.annotationDesc,this.selectExistingText()}),this.annotation_div.addEventListener("input",n=>{let t=this.annotation_div.innerText.trim();t===""?(this.isPlaceholder=!0,this.annotationDesc="",this.plugin.removeAnnotation(this.pluginId)):(this.isPlaceholder=!1,this.annotationDesc=t.trim(),this.plugin.modifyAnnotation(this.pluginId,{desc:this.annotationDesc,name:this.pluginName})),this.plugin.debouncedSaveAnnotations()}),this.annotation_div.addEventListener("blur",n=>{this.plugin.annotationBeingEdited=!1,this.plugin.settings.editable&&(this.clickedLink||(this.isPlaceholder?this.setPlaceholderClasses():this.removePlaceholderClasses(),this.renderAnnotation()))})}setPlaceholderClasses(){this.annotation_div.classList.add("plugin-comment-placeholder"),this.plugin.settings.hide_placeholders&&(this.plugin.settings.editable?this.annotation_container.classList.add("plugin-comment-placeholder"):this.annotation_container.classList.add("plugin-comment-hidden"))}removePlaceholderClasses(){this.annotation_div.classList.remove("plugin-comment-placeholder"),this.plugin.settings.hide_placeholders&&this.annotation_container.classList.remove("plugin-comment-placeholder")}selectExistingText(){requestAnimationFrame(()=>{let n=document.createRange();n.selectNodeContents(this.annotation_div);let t=getSelection();t&&(t.removeAllRanges(),t.addRange(n))})}async renderAnnotation(){this.annotation_div.innerText="";let n="";this.isPlaceholder?n=this.placeholder:n=(this.label+this.annotationDesc).replace(/\$\{plugin_name\}/g,this.pluginName),await kt.MarkdownRenderer.renderMarkdown(n,this.annotation_div,"",this.plugin),this.handleAnnotationLinks(this.annotation_div)}handleAnnotationLinks(n){n.querySelectorAll("a").forEach(s=>{s.addEventListener("click",a=>{this.clickedLink=!0,a.preventDefault(),a.stopPropagation();let d=s.getAttribute("href");d&&(this.plugin.app.workspace.openLinkText(d,"",!1),this.plugin.app.setting.close())})})}addGitHubIcon(n,t,s){if(n){let a=document.createElement("div");a.classList.add("clickable-icon","extra-setting-button","github-icon"),a.setAttribute("aria-label","Open plugin's GitHub page"),a.innerHTML=s?xt:Ct,a.addEventListener("click",()=>{window.open(Fe+t,"_blank")});let d=n.querySelectorAll(".clickable-icon");if(d.length>0){let l=d[d.length-1];n.insertBefore(a,l)}else n.insertBefore(a,n.firstChild);return a}return null}};var gt=class extends x.PluginSettingTab{plugin;uninstalledPluginsManager=null;backupManager=null;constructor(n,t){super(n,t),this.plugin=t}async display(){let n=()=>createFragment(u=>{let P=u.createEl("em"),L=u.createEl("a",{href:"#",text:"Community plugins"});L.onclick=()=>{this.app.setting.openTabById("community-plugins")},P.appendChild(L)});await this.plugin.loadSettings();let t=this.containerEl;t.empty(),t.classList.add("plugin-comment-settings"),new x.Setting(t).setName("Editing annotations").setHeading();let s=createFragment(u=>{let P=document.createElement("div");P.classList.add("plugin-comment-instructions");let L=document.createElement("p");L.appendText("To add or edit your personal annotations for the installed plugins, go to the "),L.appendChild(n()),L.appendText(" pane and click over the annotation field of the plugin you want to edit."),P.appendChild(L);let $=document.createElement("p2");$.innerText="You can enter rich text annotations using Markdown just the same way you do in Obsidian.                 Once you are finished editing, the Markdown annotation will be rendered correctly.",P.appendChild($);let z=document.createElement("p");z.innerText="You can directly link notes inside your                 vault by adding Obsidian links such as ";let Y=document.createElement("code");Y.appendText("[[My notes/Review of plugin XYZ|my plugin note]]"),Y.classList.add("plugin-comment-selectable"),z.appendChild(Y),z.appendText("."),P.appendChild(z),u.appendChild(P)});new x.Setting(t).setName(s);let a=new x.Setting(t).setName("Editable"),d;a.addToggle(u=>{d=u,u.setValue(this.plugin.settings.editable).onChange(P=>{this.plugin.settings.editable=P,this.plugin.debouncedSaveAnnotations(()=>{this.uninstalledPluginsManager?.updateUninstalledPluginSettings(t)})})}),a.addExtraButton(u=>{u.setIcon("reset").setTooltip("Reset to default value").onClick(()=>{d.setValue(M.editable),this.plugin.debouncedSaveAnnotations(()=>{this.uninstalledPluginsManager?.updateUninstalledPluginSettings(t)})})}),a.setDesc(createFragment(u=>{u.appendText("If disabled, the annotations cannot be edited from the preference pane and are thus                         protected against accidental changes.  In the "),u.appendChild(n()),u.appendText(" pane, you can coveniently change this setting by clicking on the displayed icon");let P=u.createDiv();P.classList.add("plugin-comment-icon-container");let L=document.createElement("div");L.classList.add("clickable-icon"),L.innerHTML=ut,L.addEventListener("click",z=>{d.setValue(!0)});let $=document.createElement("div");$.classList.add("clickable-icon"),$.innerHTML=ct,$.addEventListener("click",z=>{d.setValue(!1)}),P.appendText("{"),P.appendChild($),P.appendText(","),P.appendChild(L),P.appendText("}"),u.appendText("which either locks (make non-editable) or unlocks (make editable) your personal annotations.")})),new x.Setting(t).setName("Storage").setHeading();let l=new x.Setting(t).setName("Store annotations in a Markdown file").setDesc("With this option enabled, you can select a Markdown file in your vault to                 contain your personal annotations for the installed plugins. This feature is intended                 for power users who prefer to edit annotations directly from a Markdown file.                 A second advantage of this mode is that if you use links to some of your notes in                 the vault, those links will be automatically updated if your notes are later renamed."),h,A,p=new x.Setting(t).setName("Markdown File Path").setDesc(createFragment(u=>{u.appendText("Markdown file where the plugins' annotations are stored (e.g, "),u.createEl("code",{cls:"plugin-comment-selectable"}).appendText("00 Meta/Misc/Plugins annotations.md"),u.appendText(")."),A=u.createDiv({text:"Error: the filename must end with .md extension.",cls:"mod-warning"}),A.style.display="none"})),f;p.addText(u=>{f=u;let P=!1;h=u,u.setPlaceholder("E.g.: 00 Meta/Plugins annotations.md"),u.setValue(this.plugin.settings.markdown_file_path);let L=u.inputEl,$=new It(this.app,L),z=()=>{$&&$.setSuggestions(this.app.vault.getFiles().filter(W=>W.extension==="md"))};z();let Y=async W=>{if(P)return;P=!0;let Z=L.value;if(Z===""||Z!==this.plugin.settings.markdown_file_path){if(Z.trim()===""){A.style.display="none",this.plugin.settings.markdown_file_path="",u.setValue(this.plugin.settings.markdown_file_path),P=!1,this.plugin.debouncedSaveAnnotations();return}if(Z=(0,x.normalizePath)(Z),et(Z).ext!==".md"){A.style.display="",this.plugin.settings.markdown_file_path=M.markdown_file_path,await this.plugin.saveSettings(),P=!1;return}A.style.display="none",await re(this.plugin,Z)&&(this.plugin.settings.markdown_file_path=Z,await this.plugin.saveSettings(),z()),u.setValue(this.plugin.settings.markdown_file_path)}P=!1};L.addEventListener("keydown",async W=>{W.key==="Enter"&&(W.preventDefault(),Y(W))}),L.addEventListener("blur",Y),L.addEventListener("change",Y)}),p.addExtraButton(u=>{u.setIcon("reset").setTooltip("Reset to default value").onClick(()=>{f.setValue(M.markdown_file_path),this.plugin.debouncedSaveAnnotations()})}),p.settingEl.style.display=this.plugin.settings.markdown_file_path===""?"none":"";let C;l.addToggle(u=>{C=u,u.setValue(this.plugin.settings.markdown_file_path!=="").onChange(async P=>{P?(p.settingEl.style.display="",this.plugin.settings.markdown_file_path=h.getValue()):(p.settingEl.style.display="none",this.plugin.settings.markdown_file_path=""),this.plugin.debouncedSaveAnnotations()})}),l.addExtraButton(u=>{u.setIcon("reset").setTooltip("Reset to default value").onClick(()=>{C.setValue(M.markdown_file_path!==""),this.plugin.debouncedSaveAnnotations()})}),t.appendChild(l.settingEl),t.appendChild(p.settingEl),new x.Setting(t).setName("Display").setHeading();let E,B,N;x.Platform.isMobile?(E=this.plugin.settings.label_mobile,B="mobile",N=u=>{this.plugin.settings.label_mobile=u,this.plugin.debouncedSaveAnnotations(()=>{this.uninstalledPluginsManager?.updateUninstalledPluginSettings(t)})}):(E=this.plugin.settings.label_desktop,B="desktop",N=u=>{this.plugin.settings.label_desktop=u,this.plugin.debouncedSaveAnnotations(()=>{this.uninstalledPluginsManager?.updateUninstalledPluginSettings(t)})});let dt=new x.Setting(t).setName("Annotation label").setDesc(createFragment(u=>{u.appendText(`Choose the annotation label for the ${B} version of Obsidian.                 Use HTML code if you want to format it. Enter an empty string if you want                 to hide the label. Use `),u.createEl("code",{cls:"plugin-comment-selectable"}).appendText("${plugin_name}"),u.appendText(" as a template for the plugin name; for example, you can generate automatic links to your notes with a label of the kind "),u.createEl("code",{cls:"plugin-comment-selectable"}).appendText("[[00 Meta/Installed plugins/${plugin_name}|${plugin_name}]]"),u.appendText(".")})),pt;dt.addText(u=>{pt=u,u.setPlaceholder("Annotation label"),u.setValue(E),u.onChange(N)}),dt.addExtraButton(u=>{u.setIcon("reset").setTooltip("Reset to default value").onClick(()=>{let P;x.Platform.isMobile?(P=M.label_mobile,this.plugin.settings.label_mobile=P):(P=M.label_desktop,this.plugin.settings.label_desktop=P),pt.setValue(P),this.plugin.debouncedSaveAnnotations(()=>{this.uninstalledPluginsManager?.updateUninstalledPluginSettings(t)})})});let ht=new x.Setting(t).setName("Placeholder label").setDesc(createFragment(u=>{u.appendText("Choose the label appearing where no user annotation is provied yet. Use "),u.createEl("code",{cls:"plugin-comment-selectable"}).appendText("${plugin_name}"),u.appendText(" as a template for the plugin name; for example, you can generate automatic                         links to your notes with a placeholder of the kind "),u.createEl("code",{cls:"plugin-comment-selectable"}).appendText("[[00 Meta/Installed plugins/${plugin_name}|${plugin_name}]]"),u.appendText(".")})),q;ht.addText(u=>{q=u,u.setPlaceholder("Annotation label"),u.setValue(this.plugin.settings.label_placeholder),u.onChange(async P=>{this.plugin.settings.label_placeholder=P,this.plugin.debouncedSaveAnnotations(()=>{this.uninstalledPluginsManager?.updateUninstalledPluginSettings(t)})})}),ht.addExtraButton(u=>{u.setIcon("reset").setTooltip("Reset to default value").onClick(()=>{q.setValue(M.label_placeholder),this.plugin.debouncedSaveAnnotations(()=>{this.uninstalledPluginsManager?.updateUninstalledPluginSettings(t)})})});let mt=new x.Setting(t).setName("Hide empty annotations").setDesc(createFragment(u=>{if(u.appendText("If this option is enabled, only annotations set by the user                     will be shown. If you want to insert an annotation to a plugin for the first                     time, hover with the mouse over the chosen plugin in the "),u.appendChild(n()),u.appendText(" pane. The annotation field will appear automatically."),x.Platform.isMobile){let P=u.createEl("p");P.createEl("span",{text:"On mobile devices, you can hover over plugins with your finger instead of using the mouse."}).classList.add("mod-warning"),u.appendChild(P)}})),j;mt.addToggle(u=>{j=u,u.setValue(this.plugin.settings.hide_placeholders).onChange(async P=>{this.plugin.settings.hide_placeholders=P,this.plugin.debouncedSaveAnnotations(()=>{this.uninstalledPluginsManager?.updateUninstalledPluginSettings(t)})})}),mt.addExtraButton(u=>{u.setIcon("reset").setTooltip("Reset to default value").onClick(()=>{j.setValue(M.hide_placeholders),this.plugin.debouncedSaveAnnotations(()=>{this.uninstalledPluginsManager?.updateUninstalledPluginSettings(t)})})});let R=new x.Setting(t).setName("Delete placeholder text when inserting a new annotation").setDesc("If this option is enabled, the placeholder text will be deleted                     automatically when you start typing a new annotation. If disabled,                     the placeholder text will be selected for easier replacement.                     This is a minor customization."),K;R.addToggle(u=>{K=u,u.setValue(this.plugin.settings.delete_placeholder_string_on_insertion).onChange(async P=>{this.plugin.settings.delete_placeholder_string_on_insertion=P,this.plugin.debouncedSaveAnnotations(()=>{this.uninstalledPluginsManager?.updateUninstalledPluginSettings(t)})})}),R.addExtraButton(u=>{u.setIcon("reset").setTooltip("Reset to default value").onClick(()=>{K.setValue(M.delete_placeholder_string_on_insertion),this.plugin.debouncedSaveAnnotations(()=>{this.uninstalledPluginsManager?.updateUninstalledPluginSettings(t)})})});let ft=new x.Setting(t).setName("Show GitHub links").setDesc("If this option is enabled, aclickable icon linking to the plugin's GitHub page will be displayed in the Community plugin pane."),ot;ft.addToggle(u=>{ot=u,u.setValue(this.plugin.settings.show_github_icons).onChange(async P=>{this.plugin.settings.show_github_icons=P,this.plugin.debouncedSaveAnnotations()})}),ft.addExtraButton(u=>{u.setIcon("reset").setTooltip("Reset to default value").onClick(()=>{let P=M.show_github_icons;ot.setValue(P)})}),this.backupManager=new Bt(this.plugin,t),this.uninstalledPluginsManager=new $t(this.plugin,t)}},Bt=class{constructor(n,t){this.plugin=n;this.containerEl=t;new x.Setting(this.containerEl).setName("Backups").setHeading(),this.addBackupButtons(),this.backupTableContainer=this.containerEl.createDiv(),this.backupTableContainer.classList.add("setting-item"),this.backupTableContainer.style.display="none",this.updateListBackups()}backupTableContainer;UNTITLED_BACKUP="Untitled backup";addBackupButtons(){let n=x.Platform.isDesktopApp?" Use the export and import buttons             to copy the current settings and annnotations to an external file and, vicevera,             to restore them from an external file.":"",t=new x.Setting(this.containerEl).setName("Create a backup copy of your current settings and annotations").setDesc("Use the backup button to create an internal backup copy.                 You can customize the names of existing backups by clicking on their names once you have created them."+n).addButton(s=>s.setButtonText("Create Backup").setCta().onClick(async()=>{let a=this.UNTITLED_BACKUP;await Q(a,this.plugin.settings,this.plugin.settings.backups),await this.plugin.saveSettings(),this.updateListBackups()}));t.controlEl.classList.add("plugin-comment-export-buttons"),x.Platform.isDesktopApp&&(t.addButton(s=>s.setButtonText("Export").setCta().onClick(async()=>{let{backups:a,...d}=this.plugin.settings;oe(d)})),t.addButton(s=>s.setButtonText("Import").setCta().onClick(async()=>{let a=document.createElement("input");a.type="file",a.accept=".json",a.onchange=async()=>{let d=a.files?.[0];if(d){let l=new FileReader;l.onload=async h=>{try{let A=JSON.parse(h.target?.result);if(A==null||typeof A!="object")throw new Error("Something went wrong with the data in the backup.");await this.plugin.loadSettings({...A,backups:this.plugin.settings.backups}),new x.Notice("Settings successfully imported."),this.updateListBackups()}catch(A){console.error("Error importing settings:",A),alert("Failed to import settings. Please ensure the file is valid.")}},l.readAsText(d)}},a.click()})))}updateListBackups(){if(this.backupTableContainer.innerHTML="",this.plugin.settings.backups.length>0){this.backupTableContainer.style.display="",this.plugin.settings.backups.sort((s,a)=>a.date.getTime()-s.date.getTime());let n=this.backupTableContainer.createDiv({cls:"plugin-comment-backup-table"}),t=n.createDiv({cls:"plugin-comment-backup-table-row header"});t.createDiv({cls:"plugin-comment-backup-table-cell",text:"Backup name"+(x.Platform.isMobileApp?"":" (click to edit)")}),t.createDiv({cls:"plugin-comment-backup-table-cell",text:"Created on"}),t.createDiv({cls:"plugin-comment-backup-table-cell",text:""}),this.plugin.settings.backups.forEach(s=>{let a=n.createDiv({cls:"plugin-comment-backup-table-row"}),l=a.createDiv({cls:"plugin-comment-backup-table-cell plugin-comment-backup-name"}).createDiv({text:s.name,attr:{contenteditable:"true"}});l.addEventListener("input",()=>{let p=l.innerText.trim();s.name=p===""?this.UNTITLED_BACKUP:p,this.plugin.debouncedSaveAnnotations()}),l.addEventListener("blur",()=>{l.innerText.trim()===""&&(l.innerText=s.name),this.plugin.debouncedSaveAnnotations()}),l.addEventListener("keydown",p=>{p.key==="Enter"&&(p.preventDefault(),l.blur())}),a.createDiv({cls:"plugin-comment-backup-table-cell"}).setText(moment(s.date).format("YYYY-MM-DD HH:mm:ss"));let A=a.createDiv({cls:"plugin-comment-backup-table-cell plugin-comment-backup-buttons"});A.createEl("button",{text:"Restore",cls:"mod-cta"}).addEventListener("click",async()=>{if(await nt(this.plugin.app,"Delete backup",createFragment(f=>{f.appendText("You are about to restore the settings from the backup named "),f.createEl("strong",{text:s.name}),f.appendText(" created on "),f.createEl("strong",{text:moment(s.date).format("YYYY-MM-DD HH:mm:ss")}),f.appendText(". If you proceed, the current settings will be overwritten with those from the backup.                                     If you want to keep a copy of the current settings, make a backup before proceeding.                                    Do you want to proceed restoring the seettings from the backup?")}))){let f=structuredClone(s.settings);if(f==null||typeof f!="object")throw new Error("Something went wrong with the data in the backup.");await this.plugin.loadSettings({...f,backups:this.plugin.settings.backups}),new x.Notice(`Annotations restored from backup "${s.name}"`),this.updateListBackups()}}),A.createEl("button",{text:"Delete",cls:"mod-cta"}).addEventListener("click",async()=>{if(await nt(this.plugin.app,"Delete backup",createFragment(f=>{f.appendText("You are about to delete the backup named "),f.createEl("strong",{text:s.name}),f.appendText(" created on "),f.createEl("strong",{text:moment(s.date).format("YYYY-MM-DD HH:mm:ss")}),f.appendText(". Do you want to continue?")}))){let f=this.plugin.settings.backups.indexOf(s);f!==-1&&this.plugin.settings.backups.splice(f,1),this.plugin.debouncedSaveAnnotations(),a.remove(),this.plugin.settings.backups.length===0&&(this.backupTableContainer.style.display="none")}})})}else this.backupTableContainer.style.display="none"}},$t=class{constructor(n,t){this.plugin=n;this.containerEl=t;this.uninstalledPlugins=this.plugin.getUninstalledPlugins(),new x.Setting(t).setName("Annotations of no longer installed community plugins").setHeading();let s=new x.Setting(t).setName("Automatically remove personal annotations of uninstalled plugins").setDesc("If this option is enabled, whenever a plugin is uninstalled, the                 attached personal annotation is automatically removed.                 If this option is disabled, you can still  manually remove the personal                 annotations of any plugin that is no longer installed.                 The list of the no longer installed plugins is shown below, when the list is not empty."),a;if(s.addToggle(l=>{a=l,l.setValue(this.plugin.settings.automatic_remove).onChange(async h=>{this.plugin.settings.automatic_remove=h,this.plugin.debouncedSaveAnnotations()})}),s.addExtraButton(l=>{l.setIcon("reset").setTooltip("Reset to default value").onClick(()=>{a.setValue(M.automatic_remove),this.plugin.debouncedSaveAnnotations()})}),Object.keys(this.uninstalledPlugins).length===0)return;let d=new x.Setting(t).setName("List of no longer installed plugins").setDesc("If you plan to reinstall the plugin in the future,                 it is recommended not to remove your annotations, as you can reuse them later.");Tt(this.uninstalledPlugins).forEach(l=>{let h=new x.Setting(t).setName(`Plugin ${this.uninstalledPlugins[l].name}`).addButton(A=>A.setButtonText("Delete").setCta().onClick(async()=>{delete this.plugin.settings.annotations[l],delete this.uninstalledPlugins[l],h.settingEl.remove(),this.plugin.debouncedSaveAnnotations(),Object.keys(this.uninstalledPlugins).length===0&&d.settingEl.remove()}));h.descEl.dataset.plugin=l,new X(this.plugin,h.descEl,l,this.uninstalledPlugins[l].name),h.descEl.classList.add("plugin-comment-annotation"),h.settingEl.classList.add("plugin-comment-uninstalled")})}uninstalledPlugins={};updateUninstalledPluginSettings(n){n.querySelectorAll("div.setting-item-description.plugin-comment-annotation").forEach(s=>{if(s instanceof HTMLElement){let a=s.dataset.plugin;a&&(s.innerHTML="",new X(this.plugin,s,a,this.uninstalledPlugins[a].name))}})}};var Lt=Yt(require("path"));var Et=class extends st.Plugin{settings=structuredClone(M);pluginNameToIdMap={};pluginIdToNameMap={};sortedPluginIds=[];lockIcon=null;communityPluginTab=void 0;vaultPath=null;community_plugins={};handleThemeChange=null;colorSchemeMedia=null;debouncedSaveAnnotations;waitForSaveToComplete;communityPluginSettingTabPatched=!1;listGitHubIcons=[];annotationBeingEdited=!1;constructor(n,t){super(n,t);let s=200,{debouncedFct:a,waitFnc:d}=se(async(l=()=>{})=>{await this.saveSettings(),l&&l()},s);this.debouncedSaveAnnotations=a,this.waitForSaveToComplete=d,this.onLayoutReady=this.onLayoutReady.bind(this),this.onModifiedFile=this.onModifiedFile.bind(this)}async onload(){this.addSettingTab(new gt(this.app,this)),this.app.workspace.onLayoutReady(this.onLayoutReady),this.app.vault.on("modify",this.onModifiedFile),this.loadCommunityPluginsJson()}async onModifiedFile(n){this.settings.markdown_file_path!==""&&n.path===this.settings.markdown_file_path&&(this.annotationBeingEdited||(await jt(this),this.sortPluginAnnotationsByName(),this.saveDataJson(),this.updateCommunityPluginPaneIfOpened()))}async onLayoutReady(){let n=this.loadSettings(),t=this.loadCommunityPluginsJson();this.communityPluginTab=this.app.setting.settingTabs.find(s=>s.id==="community-plugins"),this.communityPluginTab&&this.patchCommunityPluginSettingTab(this.communityPluginTab),this.hookOnInstallAndUninstallPlugins(),this.colorSchemeMedia=matchMedia("(prefers-color-scheme: dark)"),this.communityPluginTab&&this.communityPluginTab.containerEl&&this.listenForThemeChange(this.communityPluginTab.containerEl),this.updateCommunityPluginPaneIfOpened([n,t])}async importSettings(n){let t=[],s=!1,a=async l=>{if(Vt(l))return l;if(Wt(l))return await Q("Settings before upgrade from 1.5 to 1.6",l,t),await it(10),{...l,compatibility:"1.7.0",show_github_icons:M.show_github_icons};if(Jt(l)){await Q("Settings before upgrade from 1.5 to 1.6",l,t),await it(10);let h={};for(let C in l.annotations){let{type:E,...B}=l.annotations[C];h[C]=B}let A=l,p=vt,f={...A,annotations:h,plugins_annotations_uuid:p.plugins_annotations_uuid,compatibility:p.compatibility};return s=!0,await a(f)}else if(Qt(l)){await Q("Settings before upgrade from 1.4 to 1.5",l,t),await it(10);let h={};for(let C in l.annotations){let E=l.annotations[C],{type:B,content:N}=qt(E.anno);h[C]={name:E.name,desc:N,type:B}}let A=l,p=At,f={...A,annotations:h,plugins_annotations_uuid:p.plugins_annotations_uuid,backups:p.backups,compatibility:p.compatibility,markdown_file_path:p.markdown_file_path};return s=!0,await a(f)}else if(Kt(l)){await Q("Settings before upgrade from 1.3 to 1.4",l,t),await it(10);let h={};for(let C in l.annotations){let E=l.annotations[C];h[C]={name:this.pluginIdToNameMap[C]||C,anno:E}}let f={...l,annotations:h,plugins_annotations_uuid:wt.plugins_annotations_uuid};return s=!0,await a(f)}else{await Q("Settings before upgrade from 1.0 to 1.3",l,t),await it(10);let h=structuredClone(Pt),A=h;return A.annotations=Xt(l)?l:h.annotations,s=!0,await a(A)}},d=await a(n);for(let l in d.annotations)yt(d.annotations[l])||delete d.annotations[l];return d.backups.forEach(l=>{l.date=new Date(l.date)}),d.backups=[...t,...d.backups],this.settings=Object.assign({},structuredClone(M),d),s}async loadSettings(n){this.pluginNameToIdMap=this.constructPluginNameToIdMap(),this.pluginIdToNameMap=this.generateInvertedMap(this.pluginNameToIdMap);let t;n===void 0?(this.waitForSaveToComplete(),n=await this.loadData(),t=!1):t=!0,(n==null||typeof n!="object")&&(n=structuredClone(M));let s=await this.importSettings(n);!!(t||s)?await this.saveSettings():this.settings.markdown_file_path!==""&&await jt(this),this.sortPluginAnnotationsByName()}async updateCommunityPluginPaneIfOpened(n){let t=this.app.setting.activeTab;t&&t.id==="community-plugins"&&(n&&await Promise.all(n),this.removeCommentsFromTab(),this.removeGitHubIcons(),this.removeLockIcon(),this.communityPluginTab&&this.communityPluginTab.containerEl&&this.addLockIcon(this.communityPluginTab.containerEl),this.addAnnotations())}onExternalSettingsChange(){let n=this.loadSettings();this.updateCommunityPluginPaneIfOpened([n]);let t=this.app.setting.activeTab;t&&t instanceof gt&&t.display()}getVaultPath(){if(this.vaultPath)return this.vaultPath;if(st.Platform.isDesktopApp){let n=this.app.vault.adapter;if(!(n instanceof st.FileSystemAdapter))throw new Error("The vault folder could not be determined.");return this.vaultPath=n.getBasePath().split(Lt.sep).join(Lt.posix.sep),this.vaultPath}else return""}async saveDataJson(){try{await this.saveData(this.settings)}catch(n){console.error("Failed to save annotations:",n)}}async saveSettings(){if(await this.saveDataJson(),this.settings.markdown_file_path!=="")try{await Ht(this)}catch(n){console.error("Failed to save annotations to md file:",n)}}constructPluginNameToIdMap(){let n={};for(let t in this.app.plugins.manifests){let s=this.app.plugins.manifests[t];s&&(n[s.name]=s.id)}return n}generateInvertedMap(n){let t={};for(let s in n)if(n.hasOwnProperty(s)){let a=n[s];t[a]=s}return t}patchCommunityPluginSettingTab(n){if(this.communityPluginSettingTabPatched)return;let t=this,s=Ft(n,{renderInstalledPlugin:a=>function(d,l,h,A,p){a.call(this,d,l,h,A,p),l&&l.lastElementChild&&t.addAnnotation(l.lastElementChild)},render:a=>function(d){t.listGitHubIcons=[],a.call(this,d),t.addLockIcon(this.containerEl)}});this.register(s),this.communityPluginSettingTabPatched=!0}hookOnInstallAndUninstallPlugins(){let n=this,t=Ft(this.app.plugins,{uninstallPlugin:s=>async function(a){await s.call(this,a),n.settings.automatic_remove&&n.settings.annotations.hasOwnProperty(a)&&(n.removeAnnotation(a),n.debouncedSaveAnnotations())},installPlugin:s=>async function(a,d,l){await s.call(this,a,d,l),n.pluginNameToIdMap[l.name]=l.id}});this.register(t)}removeAnnotation(n){delete this.settings.annotations[n],this.sortedPluginIds=this.sortedPluginIds.filter(t=>t!==n)}modifyAnnotation(n,t){let s=this.settings.annotations.hasOwnProperty(n);this.settings.annotations[n]=t,s||this.sortPluginAnnotationsByName()}sortPluginAnnotationsByName(){this.sortedPluginIds=Tt(this.settings.annotations)}listenForThemeChange(n){if(!this.handleThemeChange){if(this.colorSchemeMedia===null){console.warn("Color scheme could not be determined.");return}this.handleThemeChange=t=>{let s=n.querySelector(".installed-plugins-container"),a=t.matches;s&&s.querySelectorAll("div.setting-item > div.setting-item-control > div.github-icon").forEach(l=>{a?l.innerHTML=xt:l.innerHTML=Ct})},this.colorSchemeMedia.addEventListener("change",this.handleThemeChange)}}async addLockIcon(n){let t=n.querySelector(".setting-item-heading .setting-item-control");if(t){this.lockIcon=document.createElement("div");let s=this.lockIcon;s.classList.add("clickable-icon","extra-setting-button"),this.settings.editable?(s.setAttribute("aria-label","Click to lock personal annotations"),s.innerHTML=ut):(s.setAttribute("aria-label","Click to be able to edit personal annotations"),s.innerHTML=ct),s.addEventListener("click",a=>{this.settings.editable=!this.settings.editable,this.debouncedSaveAnnotations(),this.settings.editable?(s.setAttribute("aria-label","Click to lock personal annotations"),s.innerHTML=ut):(s.setAttribute("aria-label","Click to unlock personal annotations"),s.innerHTML=ct),n.querySelectorAll(".plugin-comment-annotation").forEach(h=>{h instanceof HTMLDivElement&&(this.settings.editable?(h.contentEditable="true",h.classList.add("plugin-comment-annotation-editable")):(h.contentEditable="false",h.classList.remove("plugin-comment-annotation-editable")))}),document.querySelectorAll(this.settings.editable?"div.plugin-comment.plugin-comment-hidden":"div.plugin-comment.plugin-comment-placeholder").forEach(h=>{this.settings.editable?(h.classList.add("plugin-comment-placeholder"),h.classList.remove("plugin-comment-hidden")):(h.classList.add("plugin-comment-hidden"),h.classList.remove("plugin-comment-placeholder"))})}),t.appendChild(s)}}removeLockIcon(){this.lockIcon&&(this.lockIcon.remove(),this.lockIcon=null)}removeGitHubIcons(){this.listGitHubIcons.forEach(n=>{n.remove()})}async loadCommunityPluginsJson(){if(this.settings.show_github_icons&&!(Object.keys(this.community_plugins).length>0))try{let n=await fetch("https://raw.githubusercontent.com/obsidianmd/obsidian-releases/master/community-plugins.json");if(!n.ok)return;let t=await n.json();this.community_plugins=t.reduce((s,a)=>(s[a.id]=a,s),{})}catch(n){console.error("Error loading community plugins JSON:",n)}}addAnnotation(n){let t=n.querySelector(".setting-item-name"),s=t?t.textContent:null;if(!s){console.warn("Plugin name not found");return}let a=this.pluginNameToIdMap[s];if(!a){console.warn(`Plugin ID not found for plugin name: ${s}`);return}let d=n.querySelector(".setting-item-info");if(d){let l=d.querySelector(".setting-item-description");if(l&&!l.querySelector(".plugin-comment")){let A=document.createElement("div");A.className="plugin-comment";let p=new X(this,A,a,s);if(l.appendChild(A),this.settings.show_github_icons){let f=this.community_plugins[a],C=f?f.repo:void 0;if(C){let E=n.querySelector(".setting-item-control");if(E&&this.colorSchemeMedia){let B=this.colorSchemeMedia.matches,N=p.addGitHubIcon(E,C,B);N&&this.listGitHubIcons.push(N)}}}}}}addAnnotations(){if(this.communityPluginTab===void 0){console.warn("Annotations could not be added because the community plugin pane was not detected.");return}let n=this.communityPluginTab.containerEl.querySelector(".installed-plugins-container");if(!n){console.warn("Annotations could not be added because installed-plugins-container was not detected.");return}n.querySelectorAll(".setting-item").forEach(s=>{this.addAnnotation(s)})}removeCommentsFromTab(){this.communityPluginTab&&this.communityPluginTab.containerEl.querySelectorAll(".plugin-comment").forEach(t=>{t.remove()})}removeHandleThemeChangeListener(){this.handleThemeChange&&this.colorSchemeMedia&&this.colorSchemeMedia.removeEventListener("change",this.handleThemeChange)}onunload(){this.removeCommentsFromTab(),this.removeLockIcon(),this.removeHandleThemeChangeListener(),this.app.vault.off("modify",this.onModifiedFile),this.removeGitHubIcons()}getUninstalledPlugins(){let n=new Set(Object.keys(this.app.plugins.manifests)),t={};for(let s of this.sortedPluginIds)n.has(s)||(t[s]=this.settings.annotations[s]);return t}};

/* nosourcemap */