/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var V=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var R=Object.prototype.hasOwnProperty;var A=(g,c)=>{for(var e in c)V(g,e,{get:c[e],enumerable:!0})},N=(g,c,e,t)=>{if(c&&typeof c=="object"||typeof c=="function")for(let i of D(c))!R.call(g,i)&&i!==e&&V(g,i,{get:()=>c[i],enumerable:!(t=b(c,i))||t.enumerable});return g};var I=g=>N(V({},"__esModule",{value:!0}),g);var k={};A(k,{default:()=>C});module.exports=I(k);var n=require("obsidian"),d=require("obsidian"),M={maxNotesToShow:100,showMarkdownFiles:!0,showImageFiles:!0,showPDFFiles:!0,showAudioFiles:!0,showVideoFiles:!0,showCanvasFiles:!0,showCSVFiles:!0,excludedFolders:[],excludedFiles:[],previewLines:1},S="recent-notes-view",E=class extends n.ItemView{constructor(e,t){super(e);this.refreshTimeout=null;this.lastActiveFile=null;this.firstLineCache=new Map;this.MAX_FILE_SIZE_FOR_PREVIEW=100*1024;this.CACHE_DURATION=5*60*1e3;this.debouncedRefresh=()=>{this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(()=>{this.refreshView(),this.refreshTimeout=null},20)};this.plugin=t,this.containerEl.addClass("recent-notes-view")}clearOldCache(){let e=Date.now();for(let[t,i]of this.firstLineCache.entries())e-i.timestamp>this.CACHE_DURATION&&this.firstLineCache.delete(t)}shouldRefreshForFile(e){if(!e)return!1;let t=e.path.toLowerCase();if(this.plugin.settings.excludedFolders.some(s=>{let u=s.toLowerCase().trim();return u&&t.startsWith(u+"/")})||this.plugin.settings.excludedFiles.some(s=>{let u=s.toLowerCase().trim();return u&&t===u}))return!1;let l=e.extension.toLowerCase();return this.plugin.settings.showMarkdownFiles&&l==="md"||this.plugin.settings.showImageFiles&&["png","jpg","jpeg","gif","bmp","svg"].includes(l)||this.plugin.settings.showPDFFiles&&l==="pdf"||this.plugin.settings.showAudioFiles&&["mp3","wav","m4a","ogg","3gp","flac","webm","aac"].includes(l)||this.plugin.settings.showVideoFiles&&["mp4","webm","ogv","mov","mkv"].includes(l)||this.plugin.settings.showCanvasFiles&&l==="canvas"||this.plugin.settings.showCSVFiles&&l==="csv"}clearCache(){this.firstLineCache.clear()}getViewType(){return S}getDisplayText(){return"Recent notes"}getIcon(){return"clock-10"}async getFirstLineOfFile(e){var r,l,s,u;let t=e.extension.toLowerCase();if(t!=="md"){let h=e.stat.size,a="";if(h<1024?a=`${h} B`:h<1024*1024?a=`${(h/1024).toFixed(1)} KB`:a=`${(h/(1024*1024)).toFixed(1)} MB`,["png","jpg","jpeg","gif","bmp","svg"].includes(t))return`Image file \u2022 ${a}`;if(t==="pdf")return`PDF document \u2022 ${a}`;if(["mp3","wav","m4a","ogg","3gp","flac","webm","aac"].includes(t))return`Audio file \u2022 ${a}`;if(["mp4","webm","ogv","mov","mkv"].includes(t))return`Video file \u2022 ${a}`;if(t==="canvas")return"Canvas file";if(t==="csv"){if(e.stat.size>this.MAX_FILE_SIZE_FOR_PREVIEW)return`CSV file \u2022 ${a}`;let m=this.firstLineCache.get(e.path);if(m&&Date.now()-m.timestamp<this.CACHE_DURATION)return m.line;try{let o=(r=(await this.app.vault.cachedRead(e)).split(`
`)[0])==null?void 0:r.trim();if(o){let w=`CSV \u2022 ${o.length>50?o.slice(0,47)+"...":o} \u2022 ${a}`;return this.firstLineCache.set(e.path,{line:w,timestamp:Date.now()}),w}return`CSV file \u2022 ${a}`}catch(p){return`CSV file \u2022 ${a}`}}return`${t.toUpperCase()} file \u2022 ${a}`}if(e.stat.size>this.MAX_FILE_SIZE_FOR_PREVIEW)return"Large markdown file";let i=this.firstLineCache.get(e.path);if(i&&Date.now()-i.timestamp<this.CACHE_DURATION)return i.line;try{let a=(await this.app.vault.cachedRead(e)).split(`
`),m=0;if(((l=a[0])==null?void 0:l.trim())==="---"){for(let o=1;o<a.length;o++)if(((s=a[o])==null?void 0:s.trim())==="---"){m=o+1;break}}let p=[];for(let o=m;o<a.length&&p.length<this.plugin.settings.previewLines;o++){let v=(u=a[o])==null?void 0:u.trim();v&&v!=="---"&&!v.startsWith("# ")&&p.push(v)}if(p.length>0){let o=p.join(`
`);return this.firstLineCache.set(e.path,{line:o,timestamp:Date.now()}),o}return"No additional text"}catch(h){return"Error reading file"}}getTimeSection(e){let t=(0,d.moment)();return e.isSame(t,"day")?"Today":e.isSame(t.subtract(1,"day"),"day")?"Yesterday":e.isAfter(t.subtract(7,"days"))?"Previous 7 days":e.isAfter(t.subtract(30,"days"))?"Previous 30 days":e.isSame(t,"year")?e.format("MMMM"):e.format("YYYY")}async refreshView(){let e=this.containerEl.children[1];e.empty();let t=this.app.vault.getFiles().filter(s=>this.shouldRefreshForFile(s)).sort((s,u)=>u.stat.mtime-s.stat.mtime).slice(0,this.plugin.settings.maxNotesToShow),i="",r=this.app.workspace.getActiveFile();r&&(this.lastActiveFile=r.path);let l=r?r.path:this.lastActiveFile;for(let s of t){let u=(0,d.moment)(s.stat.mtime),h=this.getTimeSection(u);h!==i&&(i=h,e.createEl("h6",{text:h}));let a=e.createEl("div",{cls:`recent-note-item ${l===s.path?"is-active":""}`}),m=a.createEl("div",{text:s.basename,cls:"recent-note-title"}),p=this.plugin.settings.previewLines>1,o=a.createEl("div",{cls:`recent-note-info ${p?"has-multiple-lines":""}`}),v=(0,d.moment)(),w;h==="Today"?w=(0,d.moment)(s.stat.mtime).format("HH:mm"):h==="Yesterday"?w=(0,d.moment)(s.stat.mtime).format("HH:mm"):(0,d.moment)(s.stat.mtime).isAfter(v.subtract(7,"days"))?w=(0,d.moment)(s.stat.mtime).format("dddd"):w=(0,d.moment)(s.stat.mtime).format("DD/MM/YYYY");let y=await this.getFirstLineOfFile(s),T=o.createEl("div",{cls:`recent-note-preview ${p?"has-multiple-lines":""}`});y.split(`
`).forEach(f=>{T.createEl("div",{text:f,cls:"recent-note-preview-line"})});let P=o.createEl("span",{text:w,cls:p?"recent-note-date recent-note-date-below":"recent-note-date"});a.addEventListener("click",async f=>{await this.app.workspace.getLeaf(f.metaKey||f.ctrlKey).openFile(s),s.extension!=="md"&&setTimeout(()=>{this.debouncedRefresh()},50)}),a.addEventListener("contextmenu",f=>{f.preventDefault();let F=new n.Menu;F.addItem(L=>{L.setIcon("trash").setTitle("Delete").onClick(async()=>{!await this.app.vault.adapter.exists(s.path)||!confirm(`Are you sure you want to delete "${s.path}"?`)||(await this.app.fileManager.trashFile(s),this.refreshView())})}),F.addSeparator(),this.app.workspace.trigger("file-menu",F,s,"recent-notes-view",null),F.showAtPosition({x:f.clientX,y:f.clientY})})}}async onOpen(){this.registerInterval(window.setInterval(()=>this.clearOldCache(),this.CACHE_DURATION)),await this.refreshView(),this.registerEvent(this.app.vault.on("modify",e=>{e instanceof n.TFile&&this.firstLineCache.delete(e.path);let t=this.app.workspace.getActiveFile();this.shouldRefreshForFile(t)&&this.debouncedRefresh()})),this.registerEvent(this.app.vault.on("create",e=>{e instanceof n.TFile&&this.shouldRefreshForFile(e)&&this.debouncedRefresh()})),this.registerEvent(this.app.vault.on("delete",e=>{e instanceof n.TFile&&this.shouldRefreshForFile(e)&&this.debouncedRefresh()})),this.registerEvent(this.app.vault.on("rename",e=>{e instanceof n.TFile&&this.shouldRefreshForFile(e)&&this.debouncedRefresh()})),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{let e=this.app.workspace.getActiveFile();this.shouldRefreshForFile(e)&&this.debouncedRefresh()}))}async onClose(){this.refreshTimeout&&clearTimeout(this.refreshTimeout)}},C=class extends n.Plugin{async onload(){await this.loadSettings(),this.registerView(S,e=>this.view=new E(e,this)),this.addRibbonIcon("clock-10","Recent notes",()=>{this.activateView()}),this.addCommand({id:"show-recent-notes",name:"Open",callback:()=>{this.activateView()}}),this.addSettingTab(new x(this.app,this))}async activateView(){let{workspace:e}=this.app,t=e.getLeavesOfType(S)[0];t||(t=e.getRightLeaf(!1),t&&await t.setViewState({type:S,active:!0})),t&&e.revealLeaf(t)}async loadSettings(){this.settings=Object.assign({},M,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},x=class extends n.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new n.Setting(e).setName("Maximum notes to show").setDesc("How many recent notes to display in the view").addText(t=>t.setPlaceholder("100").setValue(this.plugin.settings.maxNotesToShow.toString()).onChange(async i=>{let r=parseInt(i);isNaN(r)||(this.plugin.settings.maxNotesToShow=r,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView())})),new n.Setting(e).setName("Preview lines").setDesc("Number of text lines to show in the preview (1-3)").addDropdown(t=>t.addOption("1","1 line").addOption("2","2 lines").addOption("3","3 lines").setValue(this.plugin.settings.previewLines.toString()).onChange(async i=>{this.plugin.settings.previewLines=parseInt(i),await this.plugin.saveSettings(),this.plugin.view&&(this.plugin.view.clearCache(),await this.plugin.view.refreshView())})),new n.Setting(e).setName("Excluded folders").setDesc("List of folders to exclude from recent files (one per line)").addTextArea(t=>t.setPlaceholder(`folder1
folder2/subfolder`).setValue(this.plugin.settings.excludedFolders.join(`
`)).onChange(async i=>{let r=i.split(`
`).map(l=>l.trim()).filter(l=>l.length>0);this.plugin.settings.excludedFolders=r,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),new n.Setting(e).setName("Excluded files").setDesc("List of specific files to exclude from recent files (one per line, full path required)").addTextArea(t=>t.setPlaceholder(`folder1/note.md
folder2/image.png`).setValue(this.plugin.settings.excludedFiles.join(`
`)).onChange(async i=>{let r=i.split(`
`).map(l=>l.trim()).filter(l=>l.length>0);this.plugin.settings.excludedFiles=r,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),e.createEl("h3",{text:"File types to show"}),new n.Setting(e).setName("Show Markdown files").setDesc("Show .md files in the recent list").addToggle(t=>t.setValue(this.plugin.settings.showMarkdownFiles).onChange(async i=>{this.plugin.settings.showMarkdownFiles=i,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),new n.Setting(e).setName("Show Image files").setDesc("Show image files (png, jpg, gif, etc.) in the recent list").addToggle(t=>t.setValue(this.plugin.settings.showImageFiles).onChange(async i=>{this.plugin.settings.showImageFiles=i,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),new n.Setting(e).setName("Show PDF files").setDesc("Show .pdf files in the recent list").addToggle(t=>t.setValue(this.plugin.settings.showPDFFiles).onChange(async i=>{this.plugin.settings.showPDFFiles=i,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),new n.Setting(e).setName("Show Audio files").setDesc("Show audio files (mp3, wav, etc.) in the recent list").addToggle(t=>t.setValue(this.plugin.settings.showAudioFiles).onChange(async i=>{this.plugin.settings.showAudioFiles=i,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),new n.Setting(e).setName("Show Video files").setDesc("Show video files (mp4, webm, etc.) in the recent list").addToggle(t=>t.setValue(this.plugin.settings.showVideoFiles).onChange(async i=>{this.plugin.settings.showVideoFiles=i,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),new n.Setting(e).setName("Show Canvas files").setDesc("Show .canvas files in the recent list").addToggle(t=>t.setValue(this.plugin.settings.showCanvasFiles).onChange(async i=>{this.plugin.settings.showCanvasFiles=i,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),new n.Setting(e).setName("Show CSV files").setDesc("Show .csv files in the recent list").addToggle(t=>t.setValue(this.plugin.settings.showCSVFiles).onChange(async i=>{this.plugin.settings.showCSVFiles=i,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()}))}};
