/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var L=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var M=Object.prototype.hasOwnProperty;var P=(u,p)=>{for(var e in p)L(u,e,{get:p[e],enumerable:!0})},_=(u,p,e,t)=>{if(p&&typeof p=="object"||typeof p=="function")for(let i of k(p))!M.call(u,i)&&i!==e&&L(u,i,{get:()=>p[i],enumerable:!(t=R(p,i))||t.enumerable});return u};var $=u=>_(L({},"__esModule",{value:!0}),u);var Y={};P(Y,{default:()=>C});module.exports=$(Y);var a=require("obsidian"),c=require("obsidian"),O={maxNotesToShow:100,showMarkdownFiles:!0,showImageFiles:!0,showPDFFiles:!0,showAudioFiles:!0,showVideoFiles:!0,showCanvasFiles:!0,showCSVFiles:!0,excludedFolders:[],excludedFiles:[],previewLines:1,pinnedNotes:[]},S="recent-notes-view",x=class extends a.ItemView{constructor(e,t){super(e);this.refreshTimeout=null;this.lastActiveFile=null;this.firstLineCache=new Map;this.MAX_FILE_SIZE_FOR_PREVIEW=100*1024;this.CACHE_DURATION=5*60*1e3;this.lastEditedFile=null;this.currentFileIndex=-1;this.debouncedRefresh=()=>{this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(()=>{this.refreshView(),this.refreshTimeout=null},20)};this.plugin=t,this.containerEl.addClass("recent-notes-view")}moveToAdjacentNote(e){let t=this.getRecentFiles();if(t.length===0)return;let i=this.app.workspace.getActiveFile();if(!i){let l=e==="up"?t[t.length-1]:t[0];this.openFile(l);return}let o=t.findIndex(l=>l.path===i.path);if(o===-1){let l=e==="up"?t[t.length-1]:t[0];this.openFile(l);return}let n=e==="up"?o-1:o+1;n<0||(n>=t.length&&(n=0),this.openFile(t[n]))}getRecentFiles(){return this.app.vault.getFiles().filter(t=>this.shouldRefreshForFile(t)).sort((t,i)=>i.stat.mtime-t.stat.mtime).slice(0,this.plugin.settings.maxNotesToShow)}async openFile(e){let t=this.app.workspace.getMostRecentLeaf();t&&await t.openFile(e)}clearOldCache(){let e=Date.now();for(let[t,i]of this.firstLineCache.entries())e-i.timestamp>this.CACHE_DURATION&&this.firstLineCache.delete(t)}shouldRefreshForFile(e){if(!e)return!1;let t=e.path.toLowerCase();if(this.plugin.settings.excludedFolders.some(l=>{let h=l.toLowerCase().trim();return h&&t.startsWith(h+"/")})||this.plugin.settings.excludedFiles.some(l=>{let h=l.toLowerCase().trim();return h&&t===h}))return!1;let n=e.extension.toLowerCase();return this.plugin.settings.showMarkdownFiles&&n==="md"||this.plugin.settings.showImageFiles&&["png","jpg","jpeg","gif","bmp","svg"].includes(n)||this.plugin.settings.showPDFFiles&&n==="pdf"||this.plugin.settings.showAudioFiles&&["mp3","wav","m4a","ogg","3gp","flac","webm","aac"].includes(n)||this.plugin.settings.showVideoFiles&&["mp4","webm","ogv","mov","mkv"].includes(n)||this.plugin.settings.showCanvasFiles&&n==="canvas"||this.plugin.settings.showCSVFiles&&n==="csv"}clearCache(){this.firstLineCache.clear()}getViewType(){return S}getDisplayText(){return"Recent notes"}getIcon(){return"clock-10"}cleanMarkdownFormatting(e){return e=e.replace(/^#+\s+/g,""),e=e.replace(/[*_]{1,3}([^*_]+)[*_]{1,3}/g,"$1"),e=e.replace(/~~([^~]+)~~/g,"$1"),e=e.replace(/^[-*_]{3,}\s*$/g,""),e=e.replace(/\[([^\]]+)\]\([^)]+\)/g,"$1"),e=e.replace(/`+/g,""),e=e.replace(/^>\s+/g,""),e=e.replace(/^- \[[x ]\]\s+/i,""),e=e.replace(/^[-*+]\s+/g,""),e=e.replace(/^\d+\.\s+/g,""),e=e.replace(/https?:\/\//g,""),e=e.replace(/www\./g,""),e.trim()}async getFirstLineOfFile(e){var o,n,l,h;let t=e.extension.toLowerCase();if(t!=="md"){let g=e.stat.size,r="";if(g<1024?r=`${g} B`:g<1024*1024?r=`${(g/1024).toFixed(1)} KB`:r=`${(g/(1024*1024)).toFixed(1)} MB`,["png","jpg","jpeg","gif","bmp","svg"].includes(t))return`Image file \u2022 ${r}`;if(t==="pdf")return`PDF document \u2022 ${r}`;if(["mp3","wav","m4a","ogg","3gp","flac","webm","aac"].includes(t))return`Audio file \u2022 ${r}`;if(["mp4","webm","ogv","mov","mkv"].includes(t))return`Video file \u2022 ${r}`;if(t==="canvas")return"Canvas file";if(t==="csv"){if(e.stat.size>this.MAX_FILE_SIZE_FOR_PREVIEW)return`CSV file \u2022 ${r}`;let f=this.firstLineCache.get(e.path);if(f&&Date.now()-f.timestamp<this.CACHE_DURATION)return f.line;try{let s=(o=(await this.app.vault.cachedRead(e)).split(`
`)[0])==null?void 0:o.trim();if(s){let w=`CSV \u2022 ${s.length>50?s.slice(0,47)+"...":s} \u2022 ${r}`;return this.firstLineCache.set(e.path,{line:w,timestamp:Date.now()}),w}return`CSV file \u2022 ${r}`}catch(m){return`CSV file \u2022 ${r}`}}return`${t.toUpperCase()} file \u2022 ${r}`}if(e.stat.size>this.MAX_FILE_SIZE_FOR_PREVIEW)return"Large markdown file";let i=this.firstLineCache.get(e.path);if(i&&Date.now()-i.timestamp<this.CACHE_DURATION)return i.line;try{let r=(await this.app.vault.cachedRead(e)).split(`
`),f=0;if(((n=r[0])==null?void 0:n.trim())==="---"){for(let s=1;s<r.length;s++)if(((l=r[s])==null?void 0:l.trim())==="---"){f=s+1;break}}let m=[];for(let s=f;s<r.length&&m.length<this.plugin.settings.previewLines;s++){let d=(h=r[s])==null?void 0:h.trim();if(d&&d!=="---"){let w=this.cleanMarkdownFormatting(d);w&&m.push(w)}}if(m.length>0){let s=m.join(`
`);return this.firstLineCache.set(e.path,{line:s,timestamp:Date.now()}),s}return"No additional text"}catch(g){return"Error reading file"}}getTimeSection(e){let t=(0,c.moment)();return e.isSame(t,"day")?"Today":e.isSame(t.subtract(1,"day"),"day")?"Yesterday":e.isAfter(t.subtract(7,"days"))?"Previous 7 days":e.isAfter(t.subtract(30,"days"))?"Previous 30 days":e.isSame(t,"year")?e.format("MMMM"):e.format("YYYY")}scrollToTodaySection(){let e=this.containerEl.children[1],t=Array.from(e.querySelectorAll("h6"));for(let i of t)if(i.textContent==="Today"){e.scrollTop>300&&i.scrollIntoView({behavior:"smooth",block:"start"});break}}async refreshView(){var m;let e=this.containerEl.children[1],t=e.scrollTop;e.empty();let i=this.app.vault.getFiles().filter(s=>this.shouldRefreshForFile(s)).sort((s,d)=>d.stat.mtime-s.stat.mtime).slice(0,this.plugin.settings.maxNotesToShow),o=i.filter(s=>this.plugin.settings.pinnedNotes.includes(s.path)),n=i.filter(s=>!this.plugin.settings.pinnedNotes.includes(s.path)),l="",h=this.app.workspace.getActiveFile(),g=this.lastEditedFile&&((m=i[0])==null?void 0:m.path)===this.lastEditedFile,r=i[0]&&this.plugin.settings.pinnedNotes.includes(i[0].path);h&&(this.lastActiveFile=h.path);let f=h?h.path:this.lastActiveFile;if(o.length>0){e.createEl("h6",{text:"Pinned"});for(let s of o){let d=e.createEl("div",{cls:`recent-note-item ${f===s.path?"is-active":""}`}),w=d.createEl("div",{text:s.basename,cls:"recent-note-title"}),F=this.plugin.settings.previewLines>1,y=d.createEl("div",{cls:`recent-note-info ${F?"has-multiple-lines":""}`}),T=(0,c.moment)(),v;this.getTimeSection((0,c.moment)(s.stat.mtime))==="Today"?v=(0,c.moment)(s.stat.mtime).format("HH:mm"):this.getTimeSection((0,c.moment)(s.stat.mtime))==="Yesterday"?v=(0,c.moment)(s.stat.mtime).format("HH:mm"):(0,c.moment)(s.stat.mtime).isAfter(T.subtract(7,"days"))?v=(0,c.moment)(s.stat.mtime).format("dddd"):v=(0,c.moment)(s.stat.mtime).format("DD/MM/YYYY");let V=await this.getFirstLineOfFile(s),E=y.createEl("div",{cls:`recent-note-preview ${F?"has-multiple-lines":""}`});V.split(`
`).forEach(b=>{E.createEl("div",{text:b,cls:"recent-note-preview-line"})});let D=y.createEl("span",{text:v,cls:F?"recent-note-date recent-note-date-below":"recent-note-date"});this.addFileItemEventListeners(d,s)}l=""}for(let s of n){let d=(0,c.moment)(s.stat.mtime),w=this.getTimeSection(d);w!==l&&(l=w,e.createEl("h6",{text:w}));let F=e.createEl("div",{cls:`recent-note-item ${f===s.path?"is-active":""}`}),y=F.createEl("div",{text:s.basename,cls:"recent-note-title"}),T=this.plugin.settings.previewLines>1,v=F.createEl("div",{cls:`recent-note-info ${T?"has-multiple-lines":""}`}),V=(0,c.moment)(),E;this.getTimeSection((0,c.moment)(s.stat.mtime))==="Today"?E=(0,c.moment)(s.stat.mtime).format("HH:mm"):this.getTimeSection((0,c.moment)(s.stat.mtime))==="Yesterday"?E=(0,c.moment)(s.stat.mtime).format("HH:mm"):(0,c.moment)(s.stat.mtime).isAfter(V.subtract(7,"days"))?E=(0,c.moment)(s.stat.mtime).format("dddd"):E=(0,c.moment)(s.stat.mtime).format("DD/MM/YYYY");let D=await this.getFirstLineOfFile(s),b=v.createEl("div",{cls:`recent-note-preview ${T?"has-multiple-lines":""}`});D.split(`
`).forEach(I=>{b.createEl("div",{text:I,cls:"recent-note-preview-line"})});let H=v.createEl("span",{text:E,cls:T?"recent-note-date recent-note-date-below":"recent-note-date"});this.addFileItemEventListeners(F,s)}g&&!r?this.scrollToTodaySection():e.scrollTop=t,this.lastEditedFile=null}addFileItemEventListeners(e,t){e.addEventListener("mousedown",async i=>{if(i.button!==0)return;i.preventDefault(),i.stopPropagation(),await this.app.workspace.getLeaf(i.metaKey||i.ctrlKey).openFile(t),t.extension!=="md"&&setTimeout(()=>{this.debouncedRefresh()},50)}),e.addEventListener("contextmenu",i=>{i.preventDefault();let o=new a.Menu,n=this.plugin.settings.pinnedNotes.includes(t.path);o.addItem(l=>{l.setIcon(n?"pin-off":"pin").setTitle(n?"Unpin":"Pin").onClick(async()=>{n?this.plugin.settings.pinnedNotes=this.plugin.settings.pinnedNotes.filter(h=>h!==t.path):this.plugin.settings.pinnedNotes.push(t.path),await this.plugin.saveSettings(),this.refreshView()})}),o.addItem(l=>{l.setIcon("trash").setTitle("Delete").onClick(async()=>{if(!await this.app.vault.adapter.exists(t.path))return;new N(this.app,t.path,async()=>{await this.app.fileManager.trashFile(t),this.refreshView()}).open()})}),o.addSeparator(),this.app.workspace.trigger("file-menu",o,t,"recent-notes-view",null),o.showAtPosition({x:i.clientX,y:i.clientY})})}async onOpen(){this.registerInterval(window.setInterval(()=>this.clearOldCache(),this.CACHE_DURATION)),await this.refreshView(),this.registerEvent(this.app.vault.on("modify",e=>{e instanceof a.TFile&&(this.firstLineCache.delete(e.path),this.lastEditedFile=e.path);let t=this.app.workspace.getActiveFile();this.shouldRefreshForFile(t)&&this.debouncedRefresh()})),this.registerEvent(this.app.vault.on("create",e=>{e instanceof a.TFile&&this.shouldRefreshForFile(e)&&this.debouncedRefresh()})),this.registerEvent(this.app.vault.on("delete",e=>{e instanceof a.TFile&&this.shouldRefreshForFile(e)&&this.debouncedRefresh()})),this.registerEvent(this.app.vault.on("rename",e=>{e instanceof a.TFile&&this.shouldRefreshForFile(e)&&this.debouncedRefresh()})),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{let e=this.app.workspace.getActiveFile();this.shouldRefreshForFile(e)&&this.debouncedRefresh()}))}async onClose(){this.refreshTimeout&&clearTimeout(this.refreshTimeout)}},N=class extends a.Modal{constructor(e,t,i){super(e);this.filename=t;this.onConfirm=i}onOpen(){let{contentEl:e,titleEl:t}=this;t.setText("Delete file"),e.createEl("p").setText(`Are you sure you want to delete "${this.filename}"?`);let i=e.createDiv({cls:"modal-button-container"});i.createEl("button",{cls:"mod-warning",text:"Delete"}).addEventListener("click",()=>{this.onConfirm(),this.close()}),i.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.close()})}onClose(){let{contentEl:e}=this;e.empty()}},C=class extends a.Plugin{async onload(){await this.loadSettings(),this.registerView(S,e=>this.view=new x(e,this)),this.addRibbonIcon("clock-10","Recent notes",()=>{this.activateView()}),this.addCommand({id:"show-recent-notes",name:"Open",callback:()=>{this.activateView()}}),this.addCommand({id:"move-to-previous-recent-note",name:"Move to previous note",callback:()=>{this.view&&this.view.moveToAdjacentNote("up")}}),this.addCommand({id:"move-to-next-recent-note",name:"Move to next note",callback:()=>{this.view&&this.view.moveToAdjacentNote("down")}}),this.addSettingTab(new A(this.app,this))}async activateView(){let{workspace:e}=this.app,t=e.getLeavesOfType(S)[0];t||(t=e.getLeftLeaf(!1),t&&await t.setViewState({type:S,active:!0})),t&&e.revealLeaf(t)}async loadSettings(){this.settings=Object.assign({},O,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},A=class extends a.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new a.Setting(e).setName("Maximum notes to show").setDesc("How many recent notes to display in the view").addText(t=>t.setPlaceholder("100").setValue(this.plugin.settings.maxNotesToShow.toString()).onChange(async i=>{let o=parseInt(i);isNaN(o)||(this.plugin.settings.maxNotesToShow=o,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView())})),new a.Setting(e).setName("Preview lines").setDesc("Number of text lines to show in the preview (1-3)").addDropdown(t=>t.addOption("1","1 line").addOption("2","2 lines").addOption("3","3 lines").setValue(this.plugin.settings.previewLines.toString()).onChange(async i=>{this.plugin.settings.previewLines=parseInt(i),await this.plugin.saveSettings(),this.plugin.view&&(this.plugin.view.clearCache(),await this.plugin.view.refreshView())})),new a.Setting(e).setName("Excluded folders").setDesc("List of folders to exclude from recent files (one per line)").addTextArea(t=>t.setPlaceholder(`folder1
folder2/subfolder`).setValue(this.plugin.settings.excludedFolders.join(`
`)).onChange(async i=>{let o=i.split(`
`).map(n=>n.trim()).filter(n=>n.length>0);this.plugin.settings.excludedFolders=o,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),new a.Setting(e).setName("Excluded files").setDesc("List of specific files to exclude from recent files (one per line, full path required)").addTextArea(t=>t.setPlaceholder(`folder1/note.md
folder2/image.png`).setValue(this.plugin.settings.excludedFiles.join(`
`)).onChange(async i=>{let o=i.split(`
`).map(n=>n.trim()).filter(n=>n.length>0);this.plugin.settings.excludedFiles=o,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),e.createEl("h3",{text:"File types to show"}),new a.Setting(e).setName("Show Markdown files").setDesc("Show .md files in the recent list").addToggle(t=>t.setValue(this.plugin.settings.showMarkdownFiles).onChange(async i=>{this.plugin.settings.showMarkdownFiles=i,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),new a.Setting(e).setName("Show Image files").setDesc("Show image files (png, jpg, gif, etc.) in the recent list").addToggle(t=>t.setValue(this.plugin.settings.showImageFiles).onChange(async i=>{this.plugin.settings.showImageFiles=i,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),new a.Setting(e).setName("Show PDF files").setDesc("Show .pdf files in the recent list").addToggle(t=>t.setValue(this.plugin.settings.showPDFFiles).onChange(async i=>{this.plugin.settings.showPDFFiles=i,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),new a.Setting(e).setName("Show Audio files").setDesc("Show audio files (mp3, wav, etc.) in the recent list").addToggle(t=>t.setValue(this.plugin.settings.showAudioFiles).onChange(async i=>{this.plugin.settings.showAudioFiles=i,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),new a.Setting(e).setName("Show Video files").setDesc("Show video files (mp4, webm, etc.) in the recent list").addToggle(t=>t.setValue(this.plugin.settings.showVideoFiles).onChange(async i=>{this.plugin.settings.showVideoFiles=i,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),new a.Setting(e).setName("Show Canvas files").setDesc("Show .canvas files in the recent list").addToggle(t=>t.setValue(this.plugin.settings.showCanvasFiles).onChange(async i=>{this.plugin.settings.showCanvasFiles=i,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),new a.Setting(e).setName("Show CSV files").setDesc("Show .csv files in the recent list").addToggle(t=>t.setValue(this.plugin.settings.showCSVFiles).onChange(async i=>{this.plugin.settings.showCSVFiles=i,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()}))}};
