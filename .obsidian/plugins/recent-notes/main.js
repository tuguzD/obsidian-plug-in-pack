/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var y=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var A=Object.prototype.hasOwnProperty;var I=(u,r)=>{for(var e in r)y(u,e,{get:r[e],enumerable:!0})},N=(u,r,e,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of D(r))!A.call(u,s)&&s!==e&&y(u,s,{get:()=>r[s],enumerable:!(t=b(r,s))||t.enumerable});return u};var L=u=>N(y({},"__esModule",{value:!0}),u);var M={};I(M,{default:()=>V});module.exports=L(M);var a=require("obsidian"),w=require("obsidian"),k={maxNotesToShow:100,showMarkdownFiles:!0,showImageFiles:!0,showPDFFiles:!0,showAudioFiles:!0,showVideoFiles:!0,showCanvasFiles:!0,showCSVFiles:!0,excludedFolders:[]},C="recent-notes-view",T=class extends a.ItemView{constructor(e,t){super(e);this.refreshTimeout=null;this.lastActiveFile=null;this.firstLineCache=new Map;this.MAX_FILE_SIZE_FOR_PREVIEW=100*1024;this.CACHE_DURATION=5*60*1e3;this.debouncedRefresh=()=>{this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(()=>{this.refreshView(),this.refreshTimeout=null},20)};this.plugin=t,this.containerEl.addClass("recent-notes-view")}clearOldCache(){let e=Date.now();for(let[t,s]of this.firstLineCache.entries())e-s.timestamp>this.CACHE_DURATION&&this.firstLineCache.delete(t)}shouldRefreshForFile(e){if(!e||this.lastActiveFile===e.path)return!1;this.lastActiveFile=e.path;let t=e.path.toLowerCase();if(this.plugin.settings.excludedFolders.some(h=>{let p=h.toLowerCase().trim();return p&&t.startsWith(p+"/")}))return!1;let o=e.extension.toLowerCase();return this.plugin.settings.showMarkdownFiles&&o==="md"||this.plugin.settings.showImageFiles&&["png","jpg","jpeg","gif","bmp","svg"].includes(o)||this.plugin.settings.showPDFFiles&&o==="pdf"||this.plugin.settings.showAudioFiles&&["mp3","wav","m4a","ogg","3gp","flac","webm","aac"].includes(o)||this.plugin.settings.showVideoFiles&&["mp4","webm","ogv","mov","mkv"].includes(o)||this.plugin.settings.showCanvasFiles&&o==="canvas"||this.plugin.settings.showCSVFiles&&o==="csv"}getViewType(){return C}getDisplayText(){return"Recent notes"}getIcon(){return"clock-10"}async getFirstLineOfFile(e){var o,h,p,m;let t=e.extension.toLowerCase();if(t!=="md"){let i=e.stat.size,n="";if(i<1024?n=`${i} B`:i<1024*1024?n=`${(i/1024).toFixed(1)} KB`:n=`${(i/(1024*1024)).toFixed(1)} MB`,["png","jpg","jpeg","gif","bmp","svg"].includes(t))return`Image file \u2022 ${n}`;if(t==="pdf")return`PDF document \u2022 ${n}`;if(["mp3","wav","m4a","ogg","3gp","flac","webm","aac"].includes(t))return`Audio file \u2022 ${n}`;if(["mp4","webm","ogv","mov","mkv"].includes(t))return`Video file \u2022 ${n}`;if(t==="canvas")return"Canvas file";if(t==="csv"){if(e.stat.size>this.MAX_FILE_SIZE_FOR_PREVIEW)return`CSV file \u2022 ${n}`;let c=this.firstLineCache.get(e.path);if(c&&Date.now()-c.timestamp<this.CACHE_DURATION)return c.line;try{let g=(o=(await this.app.vault.cachedRead(e)).split(`
`)[0])==null?void 0:o.trim();if(g){let S=`CSV \u2022 ${g.length>50?g.slice(0,47)+"...":g} \u2022 ${n}`;return this.firstLineCache.set(e.path,{line:S,timestamp:Date.now()}),S}return`CSV file \u2022 ${n}`}catch(l){return`CSV file \u2022 ${n}`}}return`${t.toUpperCase()} file \u2022 ${n}`}if(e.stat.size>this.MAX_FILE_SIZE_FOR_PREVIEW)return"Large markdown file";let s=this.firstLineCache.get(e.path);if(s&&Date.now()-s.timestamp<this.CACHE_DURATION)return s.line;try{let n=(await this.app.vault.cachedRead(e)).split(`
`),c=0;if(((h=n[0])==null?void 0:h.trim())==="---"){for(let l=1;l<n.length;l++)if(((p=n[l])==null?void 0:p.trim())==="---"){c=l+1;break}}for(let l=c;l<n.length;l++){let g=(m=n[l])==null?void 0:m.trim();if(g&&g!=="---"){let d=g.replace(/^#\s*/,"");return this.firstLineCache.set(e.path,{line:d,timestamp:Date.now()}),d}}return"No additional text"}catch(i){return"Error reading file"}}getTimeSection(e){let t=(0,w.moment)();return e.isSame(t,"day")?"Today":e.isSame(t.subtract(1,"day"),"day")?"Yesterday":e.isAfter(t.subtract(7,"days"))?"Previous 7 days":e.isAfter(t.subtract(30,"days"))?"Previous 30 days":e.isSame(t,"year")?e.format("MMMM"):e.format("YYYY")}async refreshView(){var m;let e=this.containerEl.children[1];e.empty();let t=this.app.vault.getFiles().filter(i=>this.shouldRefreshForFile(i)).sort((i,n)=>n.stat.mtime-i.stat.mtime).slice(0,this.plugin.settings.maxNotesToShow),s="",o=this.app.workspace.activeLeaf,h=o==null?void 0:o.getViewState(),p=(m=h==null?void 0:h.state)==null?void 0:m.file;for(let i of t){let n=(0,w.moment)(i.stat.mtime),c=this.getTimeSection(n);c!==s&&(s=c,e.createEl("h6",{text:c}));let l=e.createEl("div",{cls:`recent-note-item ${p===i.path?"is-active":""}`}),g=l.createEl("div",{text:i.basename,cls:"recent-note-title"}),d=l.createEl("div",{cls:"recent-note-info"}),S=(0,w.moment)(),v;c==="Today"?v=(0,w.moment)(i.stat.mtime).format("HH:mm"):c==="Yesterday"?v=(0,w.moment)(i.stat.mtime).format("HH:mm"):(0,w.moment)(i.stat.mtime).isAfter(S.subtract(7,"days"))?v=(0,w.moment)(i.stat.mtime).format("dddd"):v=(0,w.moment)(i.stat.mtime).format("DD/MM/YYYY"),d.createEl("span",{text:v,cls:"recent-note-date"});let x=await this.getFirstLineOfFile(i);d.createEl("span",{text:x,cls:"recent-note-preview"}),l.addEventListener("click",async f=>{await this.app.workspace.getLeaf(f.metaKey||f.ctrlKey).openFile(i),i.extension!=="md"&&setTimeout(()=>{this.debouncedRefresh()},50)}),l.addEventListener("contextmenu",f=>{f.preventDefault();let F=new a.Menu;F.addItem(R=>{R.setIcon("trash").setTitle("Delete").onClick(async()=>{await this.app.vault.adapter.exists(i.path)&&(await this.app.vault.trash(i,!0),this.refreshView())})}),F.addSeparator(),this.app.workspace.trigger("file-menu",F,i,"recent-notes-view",null),F.showAtPosition({x:f.clientX,y:f.clientY})})}}async onOpen(){this.registerInterval(window.setInterval(()=>this.clearOldCache(),this.CACHE_DURATION)),await this.refreshView(),this.registerEvent(this.app.vault.on("modify",()=>{let e=this.app.workspace.getActiveFile();this.shouldRefreshForFile(e)&&this.debouncedRefresh()})),this.registerEvent(this.app.vault.on("create",e=>{e instanceof a.TFile&&this.shouldRefreshForFile(e)&&this.debouncedRefresh()})),this.registerEvent(this.app.vault.on("delete",e=>{e instanceof a.TFile&&this.shouldRefreshForFile(e)&&this.debouncedRefresh()})),this.registerEvent(this.app.vault.on("rename",e=>{e instanceof a.TFile&&this.shouldRefreshForFile(e)&&this.debouncedRefresh()})),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{let e=this.app.workspace.getActiveFile();this.shouldRefreshForFile(e)&&this.debouncedRefresh()}))}async onClose(){this.refreshTimeout&&clearTimeout(this.refreshTimeout)}},V=class extends a.Plugin{async onload(){await this.loadSettings(),this.registerView(C,e=>this.view=new T(e,this)),this.addRibbonIcon("clock-10","Recent notes",()=>{this.activateView()}),this.addCommand({id:"show-recent-notes",name:"Open",callback:()=>{this.activateView()}}),this.addSettingTab(new E(this.app,this))}async activateView(){let{workspace:e}=this.app,t=e.getLeavesOfType(C)[0];t||(t=e.getRightLeaf(!1),t&&await t.setViewState({type:C,active:!0})),t&&e.revealLeaf(t)}async loadSettings(){this.settings=Object.assign({},k,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},E=class extends a.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new a.Setting(e).setName("Maximum notes to show").setDesc("How many recent notes to display in the view").addText(t=>t.setPlaceholder("100").setValue(this.plugin.settings.maxNotesToShow.toString()).onChange(async s=>{let o=parseInt(s);isNaN(o)||(this.plugin.settings.maxNotesToShow=o,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView())})),new a.Setting(e).setName("Excluded folders").setDesc("List of folders to exclude from recent files (one per line)").addTextArea(t=>t.setPlaceholder(`folder1
folder2/subfolder`).setValue(this.plugin.settings.excludedFolders.join(`
`)).onChange(async s=>{let o=s.split(`
`).map(h=>h.trim()).filter(h=>h.length>0);this.plugin.settings.excludedFolders=o,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),e.createEl("h3",{text:"File types to show"}),new a.Setting(e).setName("Show Markdown files").setDesc("Show .md files in the recent list").addToggle(t=>t.setValue(this.plugin.settings.showMarkdownFiles).onChange(async s=>{this.plugin.settings.showMarkdownFiles=s,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),new a.Setting(e).setName("Show Image files").setDesc("Show image files (png, jpg, gif, etc.) in the recent list").addToggle(t=>t.setValue(this.plugin.settings.showImageFiles).onChange(async s=>{this.plugin.settings.showImageFiles=s,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),new a.Setting(e).setName("Show PDF files").setDesc("Show .pdf files in the recent list").addToggle(t=>t.setValue(this.plugin.settings.showPDFFiles).onChange(async s=>{this.plugin.settings.showPDFFiles=s,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),new a.Setting(e).setName("Show Audio files").setDesc("Show audio files (mp3, wav, etc.) in the recent list").addToggle(t=>t.setValue(this.plugin.settings.showAudioFiles).onChange(async s=>{this.plugin.settings.showAudioFiles=s,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),new a.Setting(e).setName("Show Video files").setDesc("Show video files (mp4, webm, etc.) in the recent list").addToggle(t=>t.setValue(this.plugin.settings.showVideoFiles).onChange(async s=>{this.plugin.settings.showVideoFiles=s,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),new a.Setting(e).setName("Show Canvas files").setDesc("Show .canvas files in the recent list").addToggle(t=>t.setValue(this.plugin.settings.showCanvasFiles).onChange(async s=>{this.plugin.settings.showCanvasFiles=s,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()})),new a.Setting(e).setName("Show CSV files").setDesc("Show .csv files in the recent list").addToggle(t=>t.setValue(this.plugin.settings.showCSVFiles).onChange(async s=>{this.plugin.settings.showCSVFiles=s,await this.plugin.saveSettings(),this.plugin.view&&await this.plugin.view.refreshView()}))}};

/* nosourcemap */