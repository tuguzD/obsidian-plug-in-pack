/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var E=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var A=(n,o)=>{for(var e in o)E(n,e,{get:o[e],enumerable:!0})},D=(n,o,e,s)=>{if(o&&typeof o=="object"||typeof o=="function")for(let t of B(o))!$.call(n,t)&&t!==e&&E(n,t,{get:()=>o[t],enumerable:!(s=N(o,t))||s.enumerable});return n};var L=n=>D(E({},"__esModule",{value:!0}),n);var M={};A(M,{default:()=>w});module.exports=L(M);var u=require("obsidian"),V=require("@codemirror/state");var p=require("obsidian"),T={highlightColorOccurrences:"#FFFF00",highlightColorKeywords:"#bdfc64",occuraPluginEnabled:!0,occuraPluginEnabledHotKey:"",statusBarOccurrencesNumberEnabled:!0,keywords:[],autoKeywordsHighlightEnabled:!1,keywordsCaseSensitive:!1},y=class extends p.PluginSettingTab{constructor(e,s){super(e,s);this.keywordComponents=[];this.plugin=s}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"General"}),new p.Setting(e).setName("Highlight color").setDesc("Set the color used to highlight occurrences.").addText(t=>{t.inputEl.type="color",t.setValue(this.plugin.settings.highlightColorOccurrences).onChange(async i=>{this.plugin.settings.highlightColorOccurrences=i,await this.plugin.saveSettings(),this.plugin.updateHighlightStyle()})}),new p.Setting(e).setName("Hotkey").setDesc("Click and press the desired hotkey combination").addText(t=>{t.setPlaceholder("Click and press hotkey").setValue(this.plugin.settings.occuraPluginEnabledHotKey),t.inputEl.addEventListener("focus",()=>{t.inputEl.value=""}),t.inputEl.addEventListener("blur",()=>{t.inputEl.value||t.setValue(this.plugin.settings.occuraPluginEnabledHotKey)}),t.inputEl.addEventListener("keydown",async i=>{i.preventDefault(),i.stopPropagation();let l=this.captureHotkey(i);t.setValue(l),this.plugin.settings.occuraPluginEnabledHotKey=l,await this.plugin.saveSettings(),this.plugin.updateKeyHandler()})}),new p.Setting(e).setName("Display the number of occurrences").setDesc("Display the number of occurrences found in the Status bar").addToggle(t=>{t.setValue(this.plugin.settings.statusBarOccurrencesNumberEnabled).onChange(async i=>{this.plugin.settings.statusBarOccurrencesNumberEnabled=i,await this.plugin.saveSettings(),this.plugin.updateEditors()})}),e.createEl("h2",{text:"Keyword highlighting"}),new p.Setting(e).setName("Automatic keywords highlighting").setDesc("Automatic keywords highlighting").addToggle(t=>{t.setValue(this.plugin.settings.autoKeywordsHighlightEnabled).onChange(async i=>{this.plugin.settings.autoKeywordsHighlightEnabled=i,await this.plugin.saveSettings(),this.plugin.updateEditors()})}),new p.Setting(e).setName("Keyword highlight color").setDesc("Set the color used to highlight keywords.").addText(t=>{t.inputEl.type="color",t.setValue(this.plugin.settings.highlightColorKeywords).onChange(async i=>{this.plugin.settings.highlightColorKeywords=i,await this.plugin.saveSettings(),this.plugin.updateHighlightStyle()})}),new p.Setting(e).setName("Keywords case sensitive").setDesc("Enable or disable case sensitivity for keyword highlighting.").addToggle(t=>{t.setValue(this.plugin.settings.keywordsCaseSensitive).onChange(async i=>{this.plugin.settings.keywordsCaseSensitive=i,await this.plugin.saveSettings(),this.plugin.updateEditors()})}),new p.Setting(e).setName("Add Keyword").addButton(t=>{t.setButtonText("Add Keyword").setCta().onClick(()=>{this.plugin.settings.keywords.push(""),this.display()})});let s=e.createEl("div",{cls:"occura-keywords-container"});this.keywordComponents=[],this.plugin.settings.keywords.forEach((t,i)=>{let l=s.createEl("div",{cls:"occura-keyword-item"}),r=new p.TextComponent(l);r.setPlaceholder("Enter keyword").setValue(t).onChange(async g=>{this.plugin.settings.keywords[i]=g,await this.plugin.saveSettings()}),this.keywordComponents.push(r),r.inputEl.addClass("occura-keyword-input");let a=l.createEl("button",{text:"\u2715",cls:"occura-remove-button"});a.onclick=async()=>{this.plugin.settings.keywords.splice(i,1),await this.plugin.saveSettings(),this.display()}})}captureHotkey(e){let s=[];(e.ctrlKey||e.metaKey)&&s.push("Mod"),e.shiftKey&&s.push("Shift"),e.altKey&&s.push("Alt");let t=e.key.toUpperCase();return["CONTROL","SHIFT","ALT","META"].includes(t)||s.push(t),s.join("+")}};var f=require("@codemirror/view"),x=require("@codemirror/state"),c=require("obsidian"),R=f.Decoration.mark({class:"found-occurrence",priority:100}),I=f.Decoration.mark({class:"keyword-occurrence",priority:50}),k=0;function v(n){return f.ViewPlugin.fromClass(class{constructor(o){this.view=o;this.lastOccuraPluginEnabledState=n.settings.occuraPluginEnabled,this.lastAutoKeywordsHighlightEnabledState=n.settings.autoKeywordsHighlightEnabled,this.decorations=this.createDecorations()}update(o){(o.selectionSet||o.docChanged||o.viewportChanged||n.settings.occuraPluginEnabled!==this.lastOccuraPluginEnabledState||n.settings.autoKeywordsHighlightEnabled!==this.lastAutoKeywordsHighlightEnabledState)&&(this.decorations=this.createDecorations())}createDecorations(){this.lastOccuraPluginEnabledState=n.settings.occuraPluginEnabled,this.lastAutoKeywordsHighlightEnabledState=n.settings.autoKeywordsHighlightEnabled;let{state:o}=this.view,e=[];if(k=0,n.settings.occuraPluginEnabled){let t=o.selection.main;if(t.empty)n.statusBarOccurrencesNumber&&n.settings.statusBarOccurrencesNumberEnabled&&n.statusBarOccurrencesNumber.setText("");else{let i=o.doc.sliceString(t.from,t.to).trim();if(i&&!/\s/.test(i)){let l=new RegExp(i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g");for(let{from:r,to:a}of this.view.visibleRanges){let g=o.doc.sliceString(r,a),d;for(;(d=l.exec(g))!==null;){let h=r+d.index,m=h+d[0].length;e.push({from:h,to:m,decoration:R}),k++}}n.statusBarOccurrencesNumber&&n.settings.statusBarOccurrencesNumberEnabled&&n.statusBarOccurrencesNumber.setText(`Occura found: ${i} `+k+" times")}else n.statusBarOccurrencesNumber&&n.settings.statusBarOccurrencesNumberEnabled&&n.statusBarOccurrencesNumber.setText("")}}if(n.settings.occuraPluginEnabled&&n.settings.autoKeywordsHighlightEnabled&&n.settings.keywords.length>0){let t=n.settings.keywords.filter(i=>i.trim()!=="");if(t.length>0){let i=n.settings.keywordsCaseSensitive?"g":"gi",l=t.map(r=>{let a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return new RegExp(`\\b${a}\\b`,i)});for(let{from:r,to:a}of this.view.visibleRanges){let g=o.doc.sliceString(r,a);l.forEach(d=>{let h;for(;(h=d.exec(g))!==null;){let m=r+h.index,b=m+h[0].length;e.push({from:m,to:b,decoration:I})}})}}}e.sort((t,i)=>t.from-i.from);let s=new x.RangeSetBuilder;for(let t of e)s.add(t.from,t.to,t.decoration);return s.finish()}},{decorations:o=>o.decorations})}function C(n){let o=n.app.workspace.getActiveViewOfType(c.MarkdownView);if(!o){new c.Notice("No active editor");return}let e=o.editor,s=e.getSelection().trim();if(!s||/\s/.test(s)){new c.Notice("Please select some text to highlight.");return}let t=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),i=new RegExp(t,"g"),l=e.getValue(),r=[],a;for(;(a=i.exec(l))!==null;)r.push({from:a.index,to:a.index+a[0].length});if(r.length===0){new c.Notice("No occurrences found.");return}let g=e.cm;if(!g){new c.Notice("Cannot access the editor view.");return}let d=r.reverse().map(h=>({from:h.from,to:h.to,insert:`==${l.slice(h.from,h.to)}==`}));g.dispatch({changes:d}),new c.Notice(`Permanently highlighted ${r.length} for "${s}" occurrences.`)}function S(n){let o=n.app.workspace.getActiveViewOfType(c.MarkdownView);if(!o){new c.Notice("No active editor");return}let e=o.editor,s=e.getSelection().trim();if(!s||/\s/.test(s)){new c.Notice("Please select some text to remove highlighting from.");return}let i=`==${s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}==`,l=new RegExp(i,"g"),r=e.getValue(),a=[],g;for(;(g=l.exec(r))!==null;)a.push({from:g.index,to:g.index+g[0].length});if(a.length===0){new c.Notice("No highlighted occurrences found.");return}let d=e.cm;if(!d){new c.Notice("Cannot access the editor view.");return}let h=a.reverse().map(m=>{let b=r.slice(m.from+2,m.to-2);return{from:m.from,to:m.to,insert:b}});d.dispatch({changes:h}),new c.Notice(`Removed highlighting from ${a.length} occurrences of "${s}".`)}function K(n){let o=n.app.workspace.getActiveViewOfType(c.MarkdownView);if(!o){new c.Notice("No active editor");return}let e=o.editor,s=e.getSelection().trim();if(!s||/\s/.test(s)){new c.Notice("Please select a single word to tag.");return}let t=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),i=new RegExp(`\\b${t}\\b`,"g"),l=e.getValue(),r=[],a;for(;(a=i.exec(l))!==null;)r.push({from:a.index,to:a.index+a[0].length});if(r.length===0){new c.Notice("No occurrences found.");return}r.reverse();for(let g of r){let d=e.offsetToPos(g.from),h=e.offsetToPos(g.to),m=e.getRange(d,h);e.replaceRange(`#${m}`,d,h)}new c.Notice(`Tagged ${r.length} occurrences of "${s}".`)}function O(n){let o=n.app.workspace.getActiveViewOfType(c.MarkdownView);if(!o){new c.Notice("Select Source mode");return}let e=o.editor,s=e.getSelection().trim();if(!s||/\s/.test(s)){new c.Notice("Please select the tagged word to remove tags from.");return}let t=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),i=new RegExp(`#\\b${t}\\b`,"g"),l=e.getValue(),r=[],a;for(;(a=i.exec(l))!==null;)r.push({from:a.index,to:a.index+a[0].length});if(r.length===0){new c.Notice("No tagged occurrences found.");return}r.reverse();for(let g of r){let d=e.offsetToPos(g.from),h=e.offsetToPos(g.to),m=e.getRange(d,h).replace(/^#+/,"");e.replaceRange(m,d,h)}new c.Notice(`Removed tags from ${r.length} occurrences of "${s}".`)}var H=require("obsidian");function P(n){var t;let o={ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1},e=n.split("+"),s=((t=e.pop())==null?void 0:t.toUpperCase())||"";for(let i of e)switch(i.toLowerCase()){case"mod":H.Platform.isMacOS?o.metaKey=!0:o.ctrlKey=!0;break;case"ctrl":o.ctrlKey=!0;break;case"cmd":case"meta":o.metaKey=!0;break;case"shift":o.shiftKey=!0;break;case"alt":case"option":o.altKey=!0;break;default:break}return{key:s,modifiers:o}}var w=class extends u.Plugin{async onload(){await this.loadSettings(),this.highlightCompartment=new V.Compartment,this.addSettingTab(new y(this.app,this)),this.registerEditorExtension(this.highlightCompartment.of(v(this))),this.registerDomEvent(document,"click",this.handleDocumentClick.bind(this)),this.updateHighlightStyle(),this.addCommand({id:"toggle-highlight-occurrences",name:"Toggle highlight occurrences",callback:()=>{this.toggleHighlighting()}}),this.addCommand({id:"toggle-keyword-highlighting",name:"Toggle keyword highlighting",callback:()=>{this.toggleKeywordHighlighting()}}),this.addCommand({id:"set-permanent-highlight-occurrences",name:"Set permanently highlight for occurrences",callback:()=>{this.settings.occuraPluginEnabled?C(this):new u.Notice("Please enable Occura")}}),this.addCommand({id:"remove-permanent-highlight-occurrences",name:"Remove permanently highlight for occurrences",callback:()=>{this.settings.occuraPluginEnabled?S(this):new u.Notice("Please enable Occura")}}),this.addCommand({id:"create-tag-for-occurrences",name:"Create Tag for occurrences",callback:()=>{this.settings.occuraPluginEnabled?K(this):new u.Notice("Please enable Occura")}}),this.addCommand({id:"remove-tag-from-occurrences",name:"Remove Tag for occurrences",callback:()=>{this.settings.occuraPluginEnabled?O(this):new u.Notice("Please enable Occura")}}),this.registerEvent(this.app.workspace.on("layout-change",()=>{this.addIconsToAllLeaves()})),this.addIconsToAllLeaves(),this.updateKeyHandler()}updateKeyHandler(){this.keyHandler&&window.removeEventListener("keydown",this.keyHandler,!0);let e=P(this.settings.occuraPluginEnabledHotKey);this.keyHandler=s=>{let i=s.key.toUpperCase().replace("ARROW","");if(s.ctrlKey===e.modifiers.ctrlKey&&s.shiftKey===e.modifiers.shiftKey&&s.altKey===e.modifiers.altKey&&s.metaKey===e.modifiers.metaKey&&i===e.key)return s.preventDefault(),s.stopPropagation(),this.toggleHighlighting(),!1},window.addEventListener("keydown",this.keyHandler,!0)}async loadSettings(){this.settings=Object.assign({},T,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}toggleHighlighting(){this.settings.occuraPluginEnabled=!this.settings.occuraPluginEnabled,this.saveSettings(),this.updateEditors(),this.updateAllTitleBarIcons()}toggleKeywordHighlighting(){this.settings.autoKeywordsHighlightEnabled=!this.settings.autoKeywordsHighlightEnabled,this.saveSettings(),this.updateEditors()}handleDocumentClick(e){if(!e.target.closest(".cm-content")){let t=this.app.workspace.getActiveViewOfType(u.MarkdownView);t&&t.editor.setCursor(t.editor.getCursor())}}updateHighlightStyle(){this.styleEl&&this.styleEl.remove(),this.styleEl=document.createElement("style"),this.styleEl.textContent=`
        .found-occurrence {background-color: ${this.settings.highlightColorOccurrences};}
        .keyword-occurrence { background-color: ${this.settings.highlightColorKeywords}; }
    `,document.head.appendChild(this.styleEl)}updateEditors(){let e=this.app.workspace.getLeavesOfType("markdown").map(s=>s.view).filter(s=>s instanceof u.MarkdownView);for(let s of e){let t=s.editor.cm;t&&t.dispatch({effects:this.highlightCompartment.reconfigure(v(this))})}}addIconsToAllLeaves(){let e=this.app.workspace.getLeavesOfType("markdown");for(let s of e)this.addTitleBarIcon(s)}addTitleBarIcon(e){if(!(e.view instanceof u.MarkdownView))return;let s=e.view,t=s.containerEl.querySelector(".highlight-toggle-icon");t&&t.remove();let i=document.createElement("div");i.addClass("highlight-toggle-icon","clickable-icon"),this.updateIconElement(i),i.addEventListener("click",()=>{this.toggleHighlighting()});let l=s.containerEl.querySelector(".view-header");if(l){let r=l.querySelector(".view-actions");r&&r.insertBefore(i,r.firstChild)}}updateAllTitleBarIcons(){document.querySelectorAll(".highlight-toggle-icon").forEach(s=>{this.updateIconElement(s)})}updateIconElement(e){e.empty(),(0,u.setIcon)(e,"highlighter"),this.settings.occuraPluginEnabled?(this.statusBarOccurrencesNumber=this.addStatusBarItem(),(0,u.setTooltip)(e,"Disable highlighting"),e.removeClass("is-disabled")):(this.statusBarOccurrencesNumber&&(this.statusBarOccurrencesNumber.remove(),this.statusBarOccurrencesNumber=null),(0,u.setTooltip)(e,"Enable highlighting"),e.addClass("is-disabled"))}onunload(){window.removeEventListener("keydown",this.keyHandler,!0),this.styleEl&&this.styleEl.remove(),document.querySelectorAll(".highlight-toggle-icon").forEach(s=>s.remove())}};

/* nosourcemap */