/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var S=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var q=Object.prototype.hasOwnProperty;var N=(s,t)=>{for(var e in t)S(s,e,{get:t[e],enumerable:!0})},$=(s,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of _(t))!q.call(s,i)&&i!==e&&S(s,i,{get:()=>t[i],enumerable:!(n=I(t,i))||n.enumerable});return s};var U=s=>$(S({},"__esModule",{value:!0}),s);var z={};N(z,{default:()=>C});module.exports=U(z);var k=require("obsidian");var O=require("obsidian");var R="list",E="dynamic-outline-button",M=class{_createButtonHTML(){let t=createEl("button",{cls:`clickable-icon view-action ${E}`,attr:{"aria-label":"Toggle Dynamic Outline"}});return(0,O.setIcon)(t,R),t}_handleButtonClick(t,e){let n=t.target,i=e.getActiveMarkdownView();if(!i)return;let a=e.windowManager.getWindowFromView(i);a?e.windowManager.hideWindow(a,n):e.windowManager.createWindowInView(i,e.headingsManager.getHeadingsForView(i,e),e)}addButtonToLeaf(t,e){if(this.getButtonFromLeaf(t))return;let n=t.view.containerEl.querySelector("div.view-actions");if(!n)return;let i=this._createButtonHTML();return n.insertBefore(i,n.firstChild),e.registerDomEvent(i,"click",a=>this._handleButtonClick(a,e)),i}addButtonToLeaves(t){t.app.workspace.onLayoutReady(()=>{t.getAllMarkdownLeaves().forEach(n=>{this.addButtonToLeaf(n,t)})})}getButtonFromLeaf(t){return t.view.containerEl.querySelector(`button.${E}`)}removeButtonFromLeaf(t){var e;(e=this.getButtonFromLeaf(t))==null||e.remove()}removeButtonFromLeaves(t){t.getAllMarkdownLeaves().forEach(n=>{this.removeButtonFromLeaf(n)})}};var b=require("obsidian");var H=class{constructor(t,e){this.plugin=e,this.searchContainer=t,this.inputField=this.searchContainer.createEl("input",{attr:{placeholder:"Search headings...",type:"search"}}),this.clearButton=this.searchContainer.createEl("div",{cls:"search-input-clear-button dynamic-outline-search-clear-button",attr:{"aria-label":"Clear search"}}),this.setupEventListeners()}setupEventListeners(){this.plugin.registerDomEvent(this.searchContainer,"input",()=>{this.toggleClearButton()}),this.plugin.registerDomEvent(this.clearButton,"click",()=>{this.clearInput()})}toggleClearButton(){this.inputField.value.length>0?(this.clearButton.classList.add("visible"),this.inputField.classList.add("has-content")):(this.clearButton.classList.remove("visible"),this.inputField.classList.remove("has-content"))}clearInput(){this.inputField.value="";let t=new Event("input",{bubbles:!0,cancelable:!0});this.inputField.dispatchEvent(t),this.inputField.focus()}};var L=class{_createWindowHTML(t){let e=createEl("div",{attr:{id:"dynamic-outline"}}),n=e.createEl("div",{cls:"dynamic-outline-search-container"});return new H(n,t),e.createEl("div",{cls:"dynamic-outline-content-container"}).createEl("ul",{}),e}_createWindowListElement(t){let e=createEl("li",{attr:{"data-heading-line":t.position.start.line}}),n=createEl("a",{cls:`heading-level-${t.level}`,text:t.heading});return e.append(n),e}createWindowInView(t,e,n){let i=this._createWindowHTML(n);this.updateWindowWithHeadings(i,e,t,n);let a=i.querySelector("input");a&&n.registerDomEvent(a,"input",()=>{let u=a.value.toLowerCase(),c=i.querySelectorAll("li");c==null||c.forEach(l=>{var d;(d=l.textContent)!=null&&d.toLowerCase().includes(u)?l.classList.remove("outline-item-hidden"):l.classList.add("outline-item-hidden")})}),t.contentEl.append(i),n.settings.autofocusSearchOnOpen&&(a==null||a.focus()),n.settings.highlightCurrentHeading&&n.highlightCurrentHeading("start");let o=n.buttonManager.getButtonFromLeaf(t.leaf);return o==null||o.classList.add("button-active"),i}updateWindowWithHeadings(t,e,n,i){let a=t.querySelector("ul");a&&(a.empty(),e==null||e.forEach(o=>{let u=this._createWindowListElement(o);a.append(u),u.onclick=function(){if(n.leaf.openFile(n.file,{eState:{line:o.position.start.line}}),setTimeout(()=>{n==null||n.currentMode.applyScroll(o.position.start.line)},0),i.settings.resetSearchFieldOnHeadingClick){let c=t.querySelector("input");if(c){c.value="";let l=new Event("input",{bubbles:!0,cancelable:!0});c.dispatchEvent(l),c.focus()}}}}))}handleFileOpen(t){let e=t.app.workspace.getActiveViewOfType(b.MarkdownView);if(!e)return;let n=this.getWindowFromView(e),i=t.headingsManager.getHeadingsForView(e,t);!i||i.length<t.settings.minimumHeadings?n&&this.hideWindowFromView(e):n||this.createWindowInView(e,i,t)}getWindowFromView(t){return t==null?void 0:t.contentEl.querySelector("#dynamic-outline")}hideWindow(t,e){t==null||t.remove(),e==null||e.classList.remove("button-active")}hideWindowFromView(t){let e=this.getWindowFromView(t),n=t==null?void 0:t.containerEl.querySelector(`button.${E}`);e==null||e.remove(),n==null||n.classList.remove("button-active")}};var V=require("obsidian");var y=class{_cleanupHeadings(t){let e=a=>(0,V.htmlToMarkdown)(a).replaceAll("*","").replaceAll("_","").replaceAll("`","").replaceAll("==","").replaceAll("~~",""),n=a=>a.replace(/\[([^\]]+)\]\(.*?\)/g,"$1").replace(/\[\[([^\]]+)\|([^\]]+)\]\]/g,"$2").replace(/\[\[([^\]]+)\]\]/g,"$1"),i=t;return i.forEach(a=>{let o=a.heading;o=e(o),o=n(o),a.heading=o}),i}getHeadingsForView(t,e){var u;let n=t==null?void 0:t.file;if(!n)return[];let a=(u=(e.app.metadataCache.getFileCache(n)||{}).headings)!=null?u:[];return this._cleanupHeadings(a)}};var T=require("obsidian");var F=require("obsidian");var r=class{constructor(t,e){this.plugin=t,this.containerEl=e}};var h=class extends r{display(){new F.Setting(this.containerEl).setName("Autofocus search field on open").setDesc("When the outline is opened, focus the search field immediately.").addToggle(t=>{t.setValue(this.plugin.settings.autofocusSearchOnOpen).onChange(async e=>{this.plugin.settings.autofocusSearchOnOpen=e,await this.plugin.saveSettings()})})}};var B=require("obsidian");var m=class extends r{display(){new B.Setting(this.containerEl).setName("Highlight active heading on scroll").setDesc(g('When scrolling throught the file, highlight the current outline heading.<br><span style="color: var(--text-accent)">Requires a restart to take effect.</span>')).addToggle(t=>{t.setValue(this.plugin.settings.highlightCurrentHeading).onChange(async e=>{this.plugin.settings.highlightCurrentHeading=e,await this.plugin.saveSettings()})})}};var W=require("obsidian");var p=class extends r{display(){new W.Setting(this.containerEl).setName("Outline opacity").setDesc(g('To customize the opacity of the outline, please use the <a href="https://obsidian.md/plugins?id=obsidian-style-settings">Style Settings</a> plugin.'))}};var A=require("obsidian");var w=class extends r{display(){new A.Setting(this.containerEl).setName("Reset search field on heading click").setDesc("Reset the search field to empty when clicking on a outline heading.").addToggle(t=>{t.setValue(this.plugin.settings.resetSearchFieldOnHeadingClick).onChange(async e=>{this.plugin.settings.resetSearchFieldOnHeadingClick=e,await this.plugin.saveSettings()})})}};var D=require("obsidian");var f=class extends r{display(){new D.Setting(this.containerEl).setName("Toggle automatically").setDesc(g('Show and hide the outline automatically based on the number of headings in the file.<br><span style="color: var(--text-accent)">Requires a restart to take effect.</span>')).addToggle(e=>{e.setValue(this.plugin.settings.toggleAutomatically).onChange(async n=>{this.plugin.settings.toggleAutomatically=n,await this.plugin.saveSettings(),t.setDisabled(!n)})});let t=new D.Setting(this.containerEl).setName("Minimum headings").setDesc(g("The minimum number of headings in the file to trigger the outline.")).addSlider(e=>{e.setLimits(1,10,1).setDynamicTooltip().setValue(this.plugin.settings.minimumHeadings).onChange(async n=>{this.plugin.settings.minimumHeadings=n,await this.plugin.saveSettings()})}).setDisabled(!this.plugin.settings.toggleAutomatically)}};var P={autofocusSearchOnOpen:!0,resetSearchFieldOnHeadingClick:!0,highlightCurrentHeading:!0,toggleAutomatically:!1,minimumHeadings:1,outlineOpacity:1};function g(s){return(0,T.sanitizeHTMLToDom)(s)}var v=class extends T.PluginSettingTab{constructor(e,n){super(e,n);this.plugin=n}display(){let{containerEl:e}=this;e.empty(),new f(this.plugin,e).display(),new m(this.plugin,e).display(),new w(this.plugin,e).display(),new h(this.plugin,e).display(),new p(this.plugin,e).display()}};var C=class extends k.Plugin{constructor(){super(...arguments);this.headingsManager=new y;this.buttonManager=new M;this.windowManager=new L;this.getAllMarkdownLeaves=()=>this.app.workspace.getLeavesOfType("markdown");this.getActiveMarkdownView=()=>this.app.workspace.getActiveViewOfType(k.MarkdownView);this.handleMetadataChanged=()=>{let e=this.getActiveMarkdownView(),n=this.windowManager.getWindowFromView(e);if(!n)return;let i=this.headingsManager.getHeadingsForView(e,this);this.windowManager.updateWindowWithHeadings(n,i,e,this)};this.highlightCurrentHeading=(e="nearest")=>{let n=this.getActiveMarkdownView(),i=this.windowManager.getWindowFromView(n);if(!i)return;let a=this.headingsManager.getHeadingsForView(n,this),o=n==null?void 0:n.currentMode.getScroll(),u=a.reduce((l,d)=>o!==void 0&&d.position.start.line<=o+1&&(!l||l.position.start.line<d.position.start.line)?d:l,null);if(u){let l=i.querySelector(`li[data-heading-line="${u.position.start.line}"]`);l&&(i.querySelectorAll("li").forEach(x=>x.classList.remove("highlight")),l.classList.add("highlight"))}else{let l=i.querySelector("li");l&&l.classList.add("highlight")}let c=i.querySelector("li.highlight");c&&c.scrollIntoView({behavior:"instant",block:e})}}async onload(){await this.loadSettings(),this.addSettingTab(new v(this.app,this)),this.app.workspace.trigger("parse-style-settings"),this.buttonManager.addButtonToLeaves(this),this.registerEvent(this.app.workspace.on("layout-change",()=>{this.buttonManager.addButtonToLeaves(this)})),this.settings.toggleAutomatically&&this.registerEvent(this.app.workspace.on("file-open",()=>{this.windowManager.handleFileOpen(this)})),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.handleMetadataChanged()})),this.registerEvent(this.app.metadataCache.on("changed",()=>{this.handleMetadataChanged()})),this.settings.highlightCurrentHeading&&activeWindow.document.addEventListener("scroll",e=>{let n=e.target;n!=null&&n.classList.contains("dynamic-outline-content-container")||this.highlightCurrentHeading()},!0),this.addCommand({id:"toggle-dynamic-outline",name:"Toggle for current file",checkCallback:e=>{let n=this.getActiveMarkdownView();return n?(e||(this.windowManager.getWindowFromView(n)?this.windowManager.hideWindowFromView(n):this.windowManager.createWindowInView(n,this.headingsManager.getHeadingsForView(n,this),this)),!0):!1}})}onunload(){this.buttonManager.removeButtonFromLeaves(this)}async loadSettings(){this.settings=Object.assign({},P,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};

/* nosourcemap */