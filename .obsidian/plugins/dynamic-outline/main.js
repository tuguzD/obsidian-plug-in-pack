/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var rt=Object.create;var be=Object.defineProperty;var st=Object.getOwnPropertyDescriptor;var lt=Object.getOwnPropertyNames;var ot=Object.getPrototypeOf,ct=Object.prototype.hasOwnProperty;var ut=(v,e)=>()=>(e||v((e={exports:{}}).exports,e),e.exports),gt=(v,e)=>{for(var i in e)be(v,i,{get:e[i],enumerable:!0})},We=(v,e,i,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let l of lt(e))!ct.call(v,l)&&l!==i&&be(v,l,{get:()=>e[l],enumerable:!(n=st(e,l))||n.enumerable});return v};var dt=(v,e,i)=>(i=v!=null?rt(ot(v)):{},We(e||!v||!v.__esModule?be(i,"default",{value:v,enumerable:!0}):i,v)),ht=v=>We(be({},"__esModule",{value:!0}),v);var Ke=ut((ze,He)=>{((v,e)=>{typeof define=="function"&&define.amd?define([],e):typeof He=="object"&&He.exports?He.exports=e():v.fuzzysort=e()})(ze,v=>{"use strict";var e=(a,t)=>{if(!a||!t)return C;var r=Y(a);Q(t)||(t=N(t));var c=r.bitflags;return(c&t._bitflags)!==c?C:ae(r,t)},i=(a,t,r)=>{if(!a)return r!=null&&r.all?Pe(t,r):xe;var c=Y(a),u=c.bitflags,o=c.containsSpace,s=G((r==null?void 0:r.threshold)||0),h=(r==null?void 0:r.limit)||Ve,g=0,f=0,w=t.length;function B(X){g<h?(Ee.add(X),++g):(++f,X._score>Ee.peek()._score&&Ee.replaceTop(X))}if(r!=null&&r.key)for(var D=r.key,y=0;y<w;++y){var k=t[y],E=ye(k,D);if(E&&(Q(E)||(E=N(E)),(u&E._bitflags)===u)){var b=ae(c,E);b!==C&&(b._score<s||(b.obj=k,B(b)))}}else if(r!=null&&r.keys){var $=r.keys,F=$.length;e:for(var y=0;y<w;++y){var k=t[y];{for(var I=0,_=0;_<F;++_){var D=$[_],E=ye(k,D);if(!E){ke[_]=le;continue}Q(E)||(E=N(E)),ke[_]=E,I|=E._bitflags}if((u&I)!==u)continue}if(o)for(let L=0;L<c.spaceSearches.length;L++)z[L]=A;for(var _=0;_<F;++_){if(E=ke[_],E===le){re[_]=le;continue}if(re[_]=ae(c,E,!1,o),re[_]===C){re[_]=le;continue}if(o)for(let H=0;H<c.spaceSearches.length;H++){if(J[H]>-1e3&&z[H]>A){var O=(z[H]+J[H])/4;O>z[H]&&(z[H]=O)}J[H]>z[H]&&(z[H]=J[H])}}if(o){for(let L=0;L<c.spaceSearches.length;L++)if(z[L]===A)continue e}else{var m=!1;for(let L=0;L<F;L++)if(re[L]._score!==A){m=!0;break}if(!m)continue}var P=new S(F);for(let L=0;L<F;L++)P[L]=re[L];if(o){var M=0;for(let L=0;L<c.spaceSearches.length;L++)M+=z[L]}else{var M=A;for(let H=0;H<F;H++){var b=P[H];if(b._score>-1e3&&M>A){var O=(M+b._score)/4;O>M&&(M=O)}b._score>M&&(M=b._score)}}if(P.obj=k,P._score=M,r!=null&&r.scoreFn){if(M=r.scoreFn(P),!M)continue;M=G(M),P._score=M}M<s||B(P)}}else for(var y=0;y<w;++y){var E=t[y];if(E&&(Q(E)||(E=N(E)),(u&E._bitflags)===u)){var b=ae(c,E);b!==C&&(b._score<s||B(b))}}if(g===0)return xe;for(var U=new Array(g),y=g-1;y>=0;--y)U[y]=Ee.poll();return U.total=g+f,U},n=(a,t="<b>",r="</b>")=>{for(var c=typeof t=="function"?t:void 0,u=a.target,o=u.length,s=a.indexes,h="",g=0,f=0,w=!1,B=[],D=0;D<o;++D){var y=u[D];if(s[f]===D){if(++f,w||(w=!0,c?(B.push(h),h=""):h+=t),f===s.length){c?(h+=y,B.push(c(h,g++)),h="",B.push(u.substr(D+1))):h+=y+r+u.substr(D+1);break}}else w&&(w=!1,c?(B.push(c(h,g++)),h=""):h+=r);h+=y}return c?B:h},l=a=>{typeof a=="number"?a=""+a:typeof a!="string"&&(a="");var t=Te(a);return x(a,{_targetLower:t._lower,_targetLowerCodes:t.lowerCodes,_bitflags:t.bitflags})},d=()=>{De.clear(),Ie.clear()};class p{get indexes(){return this._indexes.slice(0,this._indexes.len).sort((t,r)=>t-r)}set indexes(t){return this._indexes=t}highlight(t,r){return n(this,t,r)}get score(){return ie(this._score)}set score(t){this._score=G(t)}}class S extends Array{get score(){return ie(this._score)}set score(t){this._score=G(t)}}var x=(a,t)=>{var c,u,o,s,h,g,f;let r=new p;return r.target=a,r.obj=(c=t.obj)!=null?c:C,r._score=(u=t._score)!=null?u:A,r._indexes=(o=t._indexes)!=null?o:[],r._targetLower=(s=t._targetLower)!=null?s:"",r._targetLowerCodes=(h=t._targetLowerCodes)!=null?h:C,r._nextBeginningIndexes=(g=t._nextBeginningIndexes)!=null?g:C,r._bitflags=(f=t._bitflags)!=null?f:0,r},ie=a=>a===A?0:a>1?a:Math.E**(((-a+1)**.04307-1)*-2),G=a=>a===0?A:a>1?a:1-Math.pow(Math.log(a)/-2+1,1/.04307),ne=a=>{typeof a=="number"?a=""+a:typeof a!="string"&&(a=""),a=a.trim();var t=Te(a),r=[];if(t.containsSpace){var c=a.split(/\s+/);c=[...new Set(c)];for(var u=0;u<c.length;u++)if(c[u]!==""){var o=Te(c[u]);r.push({lowerCodes:o.lowerCodes,_lower:c[u].toLowerCase(),containsSpace:!1})}}return{lowerCodes:t.lowerCodes,_lower:t._lower,containsSpace:t.containsSpace,bitflags:t.bitflags,spaceSearches:r}},N=a=>{if(a.length>999)return l(a);var t=De.get(a);return t!==void 0||(t=l(a),De.set(a,t)),t},Y=a=>{if(a.length>999)return ne(a);var t=Ie.get(a);return t!==void 0||(t=ne(a),Ie.set(a,t)),t},Pe=(a,t)=>{var r=[];r.total=a.length;var c=(t==null?void 0:t.limit)||Ve;if(t!=null&&t.key)for(var u=0;u<a.length;u++){var o=a[u],s=ye(o,t.key);if(s!=C){Q(s)||(s=N(s));var h=x(s.target,{_score:s._score,obj:o});if(r.push(h),r.length>=c)return r}}else if(t!=null&&t.keys)for(var u=0;u<a.length;u++){for(var o=a[u],g=new S(t.keys.length),f=t.keys.length-1;f>=0;--f){var s=ye(o,t.keys[f]);if(!s){g[f]=le;continue}Q(s)||(s=N(s)),s._score=A,s._indexes.len=0,g[f]=s}if(g.obj=o,g._score=A,r.push(g),r.length>=c)return r}else for(var u=0;u<a.length;u++){var s=a[u];if(s!=C&&(Q(s)||(s=N(s)),s._score=A,s._indexes.len=0,r.push(s),r.length>=c))return r}return r},ae=(a,t,r=!1,c=!1)=>{if(r===!1&&a.containsSpace)return et(a,t,c);for(var u=a._lower,o=a.lowerCodes,s=o[0],h=t._targetLowerCodes,g=o.length,f=h.length,y=0,w=0,B=0;;){var D=s===h[w];if(D){if(q[B++]=w,++y,y===g)break;s=o[y]}if(++w,w>=f)return C}var y=0,k=!1,E=0,b=t._nextBeginningIndexes;b===C&&(b=t._nextBeginningIndexes=it(t.target)),w=q[0]===0?0:b[q[0]-1];var $=0;if(w!==f)for(;;)if(w>=f){if(y<=0||(++$,$>200))break;--y;var F=we[--E];w=b[F]}else{var D=o[y]===h[w];if(D){if(we[E++]=w,++y,y===g){k=!0;break}++w}else w=b[w]}var I=g<=1?-1:t._targetLower.indexOf(u,q[0]),_=!!~I,O=_?I===0||t._nextBeginningIndexes[I-1]===I:!1;if(_&&!O){for(var m=0;m<b.length;m=b[m])if(!(m<=I)){for(var P=0;P<g&&o[P]===t._targetLowerCodes[m+P];P++);if(P===g){I=m,O=!0;break}}}var M=L=>{for(var H=0,Ne=0,K=1;K<g;++K)L[K]-L[K-1]!==1&&(H-=L[K],++Ne);var at=L[g-1]-L[0]-(g-1);if(H-=(12+at)*Ne,L[0]!==0&&(H-=L[0]*L[0]*.2),!k)H*=1e3;else{for(var Be=1,K=b[0];K<f;K=b[K])++Be;Be>24&&(H*=(Be-24)*10)}return H-=(f-g)/2,_&&(H/=1+g*g*1),O&&(H/=1+g*g*1),H-=(f-g)/2,H};if(k)if(O){for(var m=0;m<g;++m)q[m]=I+m;var U=q,X=M(q)}else var U=we,X=M(we);else{if(_)for(var m=0;m<g;++m)q[m]=I+m;var U=q,X=M(U)}t._score=X;for(var m=0;m<g;++m)t._indexes[m]=U[m];t._indexes.len=g;let Le=new p;return Le.target=t.target,Le._score=t._score,Le._indexes=t._indexes,Le},et=(a,t,r)=>{for(var c=new Set,u=0,o=C,s=0,h=a.spaceSearches,g=h.length,f=0,w=()=>{for(let O=f-1;O>=0;O--)t._nextBeginningIndexes[_e[O*2+0]]=_e[O*2+1]},B=!1,_=0;_<g;++_){J[_]=A;var D=h[_];if(o=ae(D,t),r){if(o===C)continue;B=!0}else if(o===C)return w(),C;var y=_===g-1;if(!y){var k=o._indexes,E=!0;for(let m=0;m<k.len-1;m++)if(k[m+1]-k[m]!==1){E=!1;break}if(E){var b=k[k.len-1]+1,$=t._nextBeginningIndexes[b-1];for(let m=b-1;m>=0&&$===t._nextBeginningIndexes[m];m--)t._nextBeginningIndexes[m]=b,_e[f*2+0]=m,_e[f*2+1]=$,f++}}u+=o._score/g,J[_]=o._score/g,o._indexes[0]<s&&(u-=(s-o._indexes[0])*2),s=o._indexes[0];for(var F=0;F<o._indexes.len;++F)c.add(o._indexes[F])}if(r&&!B)return C;w();var I=ae(a,t,!0);if(I!==C&&I._score>u){if(r)for(var _=0;_<g;++_)J[_]=I._score/g;return I}r&&(o=t),o._score=u;var _=0;for(let O of c)o._indexes[_++]=O;return o._indexes.len=_,o},Fe=a=>a.replace(/\p{Script=Latin}+/gu,t=>t.normalize("NFD")).replace(/[\u0300-\u036f]/g,""),Te=a=>{a=Fe(a);for(var t=a.length,r=a.toLowerCase(),c=[],u=0,o=!1,s=0;s<t;++s){var h=c[s]=r.charCodeAt(s);if(h===32){o=!0;continue}var g=h>=97&&h<=122?h-97:h>=48&&h<=57?26:h<=127?30:31;u|=1<<g}return{lowerCodes:c,bitflags:u,containsSpace:o,_lower:r}},tt=a=>{for(var t=a.length,r=[],c=0,u=!1,o=!1,s=0;s<t;++s){var h=a.charCodeAt(s),g=h>=65&&h<=90,f=g||h>=97&&h<=122||h>=48&&h<=57,w=g&&!u||!o||!f;u=g,o=f,w&&(r[c++]=s)}return r},it=a=>{a=Fe(a);for(var t=a.length,r=tt(a),c=[],u=r[0],o=0,s=0;s<t;++s)u>s?c[s]=u:(u=r[++o],c[s]=u===void 0?t:u);return c},De=new Map,Ie=new Map,q=[],we=[],_e=[],z=[],J=[],ke=[],re=[],ye=(a,t)=>{var r=a[t];if(r!==void 0)return r;if(typeof t=="function")return t(a);var c=t;Array.isArray(t)||(c=t.split("."));for(var u=c.length,o=-1;a&&++o<u;)a=a[c[o]];return a},Q=a=>typeof a=="object"&&typeof a._bitflags=="number",Ve=1/0,A=-Ve,xe=[];xe.total=0;var C=null,le=l(""),nt=a=>{var t=[],r=0,c={},u=o=>{for(var s=0,h=t[s],g=1;g<r;){var f=g+1;s=g,f<r&&t[f]._score<t[g]._score&&(s=f),t[s-1>>1]=t[s],g=1+(s<<1)}for(var w=s-1>>1;s>0&&h._score<t[w]._score;w=(s=w)-1>>1)t[s]=t[w];t[s]=h};return c.add=o=>{var s=r;t[r++]=o;for(var h=s-1>>1;s>0&&o._score<t[h]._score;h=(s=h)-1>>1)t[s]=t[h];t[s]=o},c.poll=o=>{if(r!==0){var s=t[0];return t[0]=t[--r],u(),s}},c.peek=o=>{if(r!==0)return t[0]},c.replaceTop=o=>{t[0]=o,u()},c},Ee=nt();return{single:e,go:i,prepare:l,cleanup:d}})});var pt={};gt(pt,{BUTTON_CLASS:()=>Me,LUCID_ICON_NAME:()=>Ae,WINDOW_ID:()=>te,default:()=>Oe});module.exports=ht(pt);var se=require("obsidian");var Re=require("obsidian");var Ue=require("obsidian");var qe=require("obsidian"),oe=class{constructor(e,i){this._plugin=e,this._view=i}get headings(){return this._getHeadingsForView(this._view)}updateView(e){this._view=e}_getHeadingsForView(e){var p;let i=e==null?void 0:e.file;if(!i)return[];let l=(p=(this._plugin.app.metadataCache.getFileCache(i)||{}).headings)!=null?p:[];return this._cleanupHeadings(l)}_cleanupHeadings(e){let i=d=>(0,qe.htmlToMarkdown)(d).replaceAll("*","").replaceAll("_","").replaceAll("`","").replaceAll("==","").replaceAll("~~",""),n=d=>d.replace(/\[([^\]]+)\]\(.*?\)/g,"$1").replace(/\[\[([^\]]+)\|([^\]]+)\]\]/g,"$2").replace(/\[\[([^\]]+)\]\]/g,"$1"),l=e;return l.forEach(d=>{let p=d.heading;p=i(p),p=n(p),d.heading=p}),l}};var Z=class{constructor(e,i){this._plugin=e,i?(this.element=i,this.inputField=this.element.querySelector("input"),this.clearButton=this.element.querySelector(".dynamic-outline-search-clear-button")):(this.element=createEl("div",{cls:"dynamic-outline-search-container"}),this.inputField=createEl("input",{attr:{placeholder:"Search headings\u2026",type:"search"}}),this.element.appendChild(this.inputField),this.clearButton=createEl("div",{cls:"search-input-clear-button dynamic-outline-search-clear-button",attr:{"aria-label":"Clear search"}}),this.element.appendChild(this.clearButton),this.setupEventListeners())}setupEventListeners(){this._plugin.registerDomEvent(this.inputField,"input",()=>{this.handleInput()}),this._plugin.registerDomEvent(this.clearButton,"click",()=>{this.clearInput()})}clearInput(e=!0){this.inputField.value="";let i=new Event("input",{bubbles:!0,cancelable:!0});this.inputField.dispatchEvent(i),e&&this.inputField.focus()}handleInput(){this.inputField.value.length>0?(this.clearButton.classList.add("visible"),this.inputField.classList.add("has-content")):(this.clearButton.classList.remove("visible"),this.inputField.classList.remove("has-content"))}};var ce=class{constructor(e,i){this._plugin=e,this._view=i,this._stateManager=W.getInstance()}createLiElement(e,i=e.level){var p;let n=(p=this._plugin.getCssVariableAsNumber("--dynamic-outline-tab-size"))!=null?p:24,l=createEl("li",{attr:{"data-heading-line":e.position.start.line,style:`padding-left: ${(i-1)*n}px !important`}}),d=createEl("a",{cls:`heading-level-${e.level}`,text:e.heading});return l.append(d),this._setupEventListener(l,e),l}updateLiElementLine(e,i){e.setAttribute("data-heading-line",i.position.start.line.toString()),this._setupEventListener(e,i)}_setupEventListener(e,i){e.onclick=()=>{if(this._view.file){if(this._view.leaf.openFile(this._view.file,{eState:{line:i.position.start.line}}),setTimeout(()=>{this._view.currentMode.applyScroll(i.position.start.line)},0),this._plugin.settings.resetSearchFieldOnHeadingClick){let n=this._stateManager.getWindowInView(this._view),l=n.getContainerElement().querySelector(".dynamic-outline-search-container");if(!l)return;new Z(this._plugin,l).clearInput(!1),n.removeHovered()}this._plugin.runCommand("editor:focus")}},e.addEventListener("mouseenter",()=>{e.classList.add("hovered")}),e.addEventListener("mouseleave",()=>{e.classList.remove("hovered")})}};var $e=dt(Ke()),j=class j{constructor(e,i){this._latestHeadings=[];this._pinned=!1;this._plugin=e,this._view=i,this._stateManager=W.getInstance(),this._containerEl=this.createElement(),this._dynamicHeadings=new oe(this._plugin,this._view),this.setupEventListeners()}get visible(){return!!this._view.containerEl.querySelector(`#${te}`)}get pinned(){return this._pinned}set pinned(e){this._pinned=e;let i=this._stateManager.getButtonInView(this._view);i.pinned=e,this._plugin.settings.toggleOnHover&&!e&&this.hide()}setupEventListeners(){this._plugin.registerDomEvent(this._containerEl.querySelector("input"),"input",()=>{this.filterItems()}),this._plugin.registerDomEvent(this._containerEl.querySelector("input"),"keydown",e=>{this.handleKeyDown(e)}),this._plugin.settings.toggleOnHover&&(this._plugin.registerDomEvent(this._containerEl,"mouseenter",()=>this.handleMouseEnter()),this._plugin.registerDomEvent(this._containerEl,"mouseleave",()=>this.handleMouseLeave()))}getVisibleLiItems(){return Array.from(this._containerEl.querySelectorAll("li:not(.outline-item-hidden"))}setHovered(e,i){e.forEach((n,l)=>{n.classList.toggle("hovered",l===i)})}handleKeyDown(e){let i=()=>{let S=n.findIndex(x=>x.classList.contains("hovered"));return S!==-1?S:n.findIndex(x=>x.classList.contains("highlight"))||0},n=this.getVisibleLiItems(),l=n.length,d=i(),p=d;switch(e.key){case"ArrowDown":case"Tab":e.preventDefault(),p=e.shiftKey?(d+l-1)%l:(d+1)%l;break;case"ArrowUp":e.preventDefault(),p=(d+l-1)%l;break;case"Enter":e.preventDefault(),d>=0&&n[d].click();break;case"Escape":e.preventDefault(),this.hide();break}p!==d&&(this.setHovered(n,p),n[p].scrollIntoView({block:"nearest"}))}filterItems(){let i=this._containerEl.querySelector("input").value.toLowerCase(),n=this._containerEl.querySelectorAll("li"),l;i===""?l=Array.from(n):l=$e.go(i,Array.from(n),{key:"textContent"}).map(p=>p.obj),n.forEach(p=>{p.classList.toggle("outline-item-hidden",!l.includes(p))});let d=this.getVisibleLiItems();this.setHovered(d,0)}handleMouseEnter(){this.clearHideTimeout(),this.getVisibleLiItems().forEach(i=>{i.classList.remove("hovered")})}handleMouseLeave(){this._plugin.settings.toggleOnHover&&!this.pinned&&(j.hideTimeout=setTimeout(()=>{this.hide()},100))}getContainerElement(){return this._containerEl}clearHideTimeout(){j.hideTimeout&&(clearTimeout(j.hideTimeout),j.hideTimeout=null)}createElement(){let e=createEl("div",{attr:{id:"dynamic-outline"}}),i=new Z(this._plugin);e.appendChild(i.element);let n=createEl("div",{cls:"dynamic-outline-content-container"});return n.createEl("ul",{}),e.appendChild(n),e}checkForObstructions(){let e=document.getElementById("cMenuToolbarModalBar"),i=e!==null&&e.classList.contains("top");this._containerEl.classList.toggle("obstruction-top",i)}checkForLocation(){this._containerEl.classList.toggle("location-left",this._plugin.settings.windowLocation==="left")}removeHovered(){this.getVisibleLiItems().forEach(i=>{i.classList.remove("hovered")})}updateView(e){this._view=e,this._dynamicHeadings.updateView(e)}highlightCurrentHeading(e="nearest"){let i=(x,ie)=>{let G=0,ne=0,N=x.length-1;for(;ne<=N;){let Y=Math.floor((ne+N)/2);x[Y].position.start.line<=ie?(G=Y,ne=Y+1):N=Y-1}return G},n=this._view.currentMode.getScroll(),l=this.getHeadings();if(l.length==0)return;let d=i(l,n+1);this._containerEl.querySelectorAll("li").forEach((x,ie)=>x.classList.toggle("highlight",ie===d));let S=this._containerEl.querySelector("li.highlight");S==null||S.scrollIntoView({behavior:"instant",block:e})}getHeadings(){return this._dynamicHeadings.headings}update(){let e=(d,p)=>d.length===p.length&&d.every((S,x)=>S.heading===p[x].heading&&S.level===p[x].level),i=this._containerEl.querySelector("ul");if(!i)return;let n=new ce(this._plugin,this._view),l=this.getHeadings();if(l.length>0&&e(l,this._latestHeadings)){i.querySelectorAll("li").forEach((p,S)=>{n.updateLiElementLine(p,l[S])});return}if(this._latestHeadings=l,i.empty(),this._plugin.settings.dynamicHeadingIndentation){let d=[];l==null||l.forEach(p=>{for(;d.length>0&&p.level<=d[d.length-1];)d.pop();d.push(p.level);let S=n.createLiElement(p,d.length);i.append(S)})}else l==null||l.forEach(d=>{let p=n.createLiElement(d);i.append(p)});this._plugin.settings.highlightCurrentHeading&&this.highlightCurrentHeading()}show(e){if(this.visible)return;this.checkForObstructions(),this.checkForLocation(),this.update(),this._view.contentEl.append(this._containerEl);let i=this._stateManager.getButtonInView(this._view);if(i.active=!0,this._plugin.settings.autofocusSearchOnOpen){let n=this._containerEl.querySelector("input");n==null||n.focus()}this._plugin.settings.highlightCurrentHeading&&this.highlightCurrentHeading(e==null?void 0:e.scrollBlock)}hide(){if(!this.visible)return;this._containerEl.remove(),this.removeHovered();let e=this._stateManager.getButtonInView(this._view);e.active=!1,this._plugin.runCommand("editor:focus"),this._plugin.settings.toggleOnHover&&(this.pinned=!1)}toggle(){this.visible?this.hide():this.show()}};j.hideTimeout=null;var ee=j;var ue=class{constructor(e){this._plugin=e,this._stateManager=W.getInstance(),this._containerEl=this.createElement(),this.setupEventListeners()}get visible(){return!!this._view.containerEl.querySelector(`button.${Me}`)}get active(){return this._containerEl.classList.contains("button-active")}set active(e){this._containerEl.classList.toggle("button-active",e)}set pinned(e){this._containerEl.classList.toggle("pinned",e)}setupEventListeners(){this._plugin.registerDomEvent(this._containerEl,"click",()=>this.handleClick()),this._plugin.settings.toggleOnHover&&(this._plugin.registerDomEvent(this._containerEl,"mouseenter",()=>this.handleMouseEnter()),this._plugin.registerDomEvent(this._containerEl,"mouseleave",()=>this.handleMouseLeave()))}createElement(){let e=createEl("button",{cls:`clickable-icon view-action ${Me}`,attr:{"aria-label":"Toggle Dynamic Outline"}});return(0,Ue.setIcon)(e,Ae),e}handleMouseEnter(){let e=this._stateManager.getWindowInView(this._view);e.visible||e.show({scrollBlock:"start"}),this._plugin.settings.toggleOnHover&&e.clearHideTimeout()}handleMouseLeave(){let e=this._stateManager.getWindowInView(this._view);e.visible&&!e.pinned&&(ee.hideTimeout=setTimeout(()=>{e.hide()},100))}getViewActionButtons(){return this._view.containerEl.querySelector(".view-actions")}getViewHeaderLeft(){return this._view.containerEl.querySelector(".view-header-left .view-header-nav-buttons")}updateView(e){this._view=e}handleClick(){let e=this._stateManager.getWindowInView(this._view);if(e.visible){if(this._plugin.settings.toggleOnHover)if(e.pinned)e.pinned=!1,e.clearHideTimeout();else{e.pinned=!0;return}e.hide()}else e.show({scrollBlock:"start"}),this._plugin.settings.toggleOnHover&&(e.pinned=!0)}show(){if(this.active=this.visible,this._plugin.settings.windowLocation==="right"){let e=this.getViewActionButtons();e&&e.insertBefore(this._containerEl,e==null?void 0:e.firstChild)}else if(this._plugin.settings.windowLocation==="left"){let e=this.getViewHeaderLeft();e&&e.appendChild(this._containerEl)}else console.error("Invalid window location")}hide(){this.visible&&this._containerEl.remove()}};var W=class v{constructor(e){this._windows=new Map;this._buttons=new Map;this._plugin=e}static initialize(e){return v.instance||(v.instance=new v(e)),v.instance}static getInstance(){if(!v.instance)throw new Error("OutlineStateManager not initialized");return v.instance}getActiveMDView(){return this._plugin.app.workspace.getActiveViewOfType(Re.MarkdownView)}getOpenMDViews(){return this._plugin.app.workspace.getLeavesOfType("markdown").map(i=>i.view)}getButtonInView(e){let i=this.getKey(e);this._buttons.has(i)||this._buttons.set(i,new ue(this._plugin));let n=this._buttons.get(i);return n.updateView(e),n}getWindowInView(e){let i=this.getKey(e);this._windows.has(i)||this._windows.set(i,new ee(this._plugin,e));let n=this._windows.get(i);return n.updateView(e),n}handleFileOpen(){let e=this.getActiveMDView();if(!e)return;let i=this.getWindowInView(e),n=i.getHeadings(),l=n&&this.isEnoughWidth(e)&&n.length>=this._plugin.settings.minimumHeadings;i.visible&&!l?(this._plugin.settings.toggleOnHover&&(i.pinned=!1),i.hide()):!i.visible&&l&&(setTimeout(()=>i.show(),50),this._plugin.settings.toggleOnHover&&(i.pinned=!0))}handleMetadataChanged(){let e=this.getActiveMDView();if(!e)return;this.getWindowInView(e).update()}createButtonsInOpenViews(){this.getOpenMDViews().forEach(e=>{if(e.leaf.width===0)return;let i=this.getButtonInView(e);i.visible||i.show()})}removeAll(){this._windows.forEach(e=>e.hide()),this._buttons.forEach(e=>e.hide()),this._windows.clear(),this._buttons.clear()}getKey(e){return e.leaf.id}isEnoughWidth(e){var l;if(this._plugin.settings.contentOverlap==="allow")return!0;let i=e.contentEl.innerWidth,n=(l=this._plugin.getCssVariableAsNumber("--dynamic-outline-window-width"))!=null?l:256;switch(this._plugin.settings.contentOverlap){case"partial":return i-700>=n;case"prevent":return(i-700)/2>=n;default:return!0}}};var R=require("obsidian");var Ge=require("obsidian");var T=class{constructor(e,i){this.plugin=e,this.containerEl=i}};var ge=class extends T{display(){new Ge.Setting(this.containerEl).setName("Autofocus search field on open").setDesc("Focus the search field on window open. Useful for immediate keyboard control.").addToggle(e=>{e.setValue(this.plugin.settings.autofocusSearchOnOpen).onChange(async i=>{this.plugin.settings.autofocusSearchOnOpen=i,await this.plugin.saveSettings()})})}};var Ye=require("obsidian");var de=class extends T{display(){let e,i=this.plugin.settings.highlightCurrentHeading;new Ye.Setting(this.containerEl).setName("Highlight active heading").setDesc(V("Highlight current outline heading while scrolling down the file.")).addButton(n=>{e=n,n.setButtonText("Reload plugin"),n.setTooltip("Requires a plugin reload to take effect."),n.setDisabled(!0),n.setClass("dynamic-outline-reload"),n.setCta(),n.onClick(()=>{this.plugin.reloadPlugin()})}).addToggle(n=>{n.setValue(this.plugin.settings.highlightCurrentHeading).onChange(async l=>{this.plugin.settings.highlightCurrentHeading=l,await this.plugin.saveSettings(),e.setDisabled(l===i)})})}};var Je=require("obsidian");var he=class extends T{display(){new Je.Setting(this.containerEl).setName("Reset search field on jump").setDesc("Erase the search field contents after clicking a heading.").addToggle(e=>{e.setValue(this.plugin.settings.resetSearchFieldOnHeadingClick).onChange(async i=>{this.plugin.settings.resetSearchFieldOnHeadingClick=i,await this.plugin.saveSettings()})})}};var Ce=require("obsidian");var pe=class extends T{display(){let e,i=this.plugin.settings.toggleAutomatically;new Ce.Setting(this.containerEl).setName("Toggle automatically on file open").setDesc(V("Show and hide outline automatically based on the number of headings in the file.")).addButton(d=>{e=d,d.setButtonText("Reload plugin"),d.setTooltip("Requires a plugin reload to take effect."),d.setDisabled(!0),d.setClass("dynamic-outline-reload"),d.setCta(),d.onClick(()=>{this.plugin.reloadPlugin()})}).addToggle(d=>{d.setValue(this.plugin.settings.toggleAutomatically).onChange(async p=>{this.plugin.settings.toggleAutomatically=p,await this.plugin.saveSettings(),e.setDisabled(p===i),n.setDisabled(!p),l.setDisabled(!p)})});let n=new Ce.Setting(this.containerEl).setName("Minimum number of headings").setDesc(V("Set the minimum number of headings to trigger the outline.")).addSlider(d=>{d.setLimits(1,10,1).setDynamicTooltip().setValue(this.plugin.settings.minimumHeadings).onChange(async p=>{this.plugin.settings.minimumHeadings=p,await this.plugin.saveSettings()})}).setDisabled(!this.plugin.settings.toggleAutomatically),l=new Ce.Setting(this.containerEl).setName("Content overlap").setDesc("Set how much content overlap is acceptable for the automatic outline to trigger. Choosing to prevent overlap will show the outline less frequently, particularly when horizontal space is limited.").addDropdown(d=>{d.addOption("allow","Allow").addOption("partial","Partial").addOption("prevent","Prevent").setValue(this.plugin.settings.contentOverlap).onChange(async p=>{this.plugin.settings.contentOverlap=p,await this.plugin.saveSettings()})}).setDisabled(!this.plugin.settings.toggleAutomatically)}};var Qe=require("obsidian");var ve=class extends T{display(){let e,i=this.plugin.settings.toggleOnHover;new Qe.Setting(this.containerEl).setName("Toggle on button hover").setDesc(V("Hover to show or hide the outline, click to pin.")).addButton(n=>{e=n,n.setButtonText("Reload plugin"),n.setTooltip("Requires a plugin reload to take effect."),n.setDisabled(!0),n.setClass("dynamic-outline-reload"),n.setCta(),n.onClick(()=>{this.plugin.reloadPlugin()})}).addToggle(n=>{n.setValue(this.plugin.settings.toggleOnHover).onChange(async l=>{this.plugin.settings.toggleOnHover=l,await this.plugin.saveSettings(),e.setDisabled(l===i)})})}};var Xe=require("obsidian");var me=class extends T{display(){let e,i=this.plugin.settings.windowLocation;new Xe.Setting(this.containerEl).setName("Outline location").setDesc(V("Set the location for both the window and the button.")).addButton(n=>{e=n,n.setButtonText("Reload plugin"),n.setTooltip("Requires a plugin reload to take effect."),n.setDisabled(!0),n.setClass("dynamic-outline-reload"),n.setCta(),n.onClick(()=>{this.plugin.reloadPlugin()})}).addDropdown(n=>n.addOption("right","Right").addOption("left","Left").setValue(this.plugin.settings.windowLocation).onChange(async l=>{this.plugin.settings.windowLocation=l,await this.plugin.saveSettings(),e.setDisabled(l===i)}))}};var Ze=require("obsidian");var fe=class extends T{display(){let e,i=this.plugin.settings.dynamicHeadingIndentation;new Ze.Setting(this.containerEl).setName("Dynamic heading indentation").setDesc(V("Adjusts heading indentation based on the previous heading level for improved visual hierarchy.")).addButton(n=>{e=n,n.setButtonText("Reload plugin"),n.setTooltip("Requires a plugin reload to take effect."),n.setDisabled(!0),n.setClass("dynamic-outline-reload"),n.setCta(),n.onClick(()=>{this.plugin.reloadPlugin()})}).addToggle(n=>{n.setValue(this.plugin.settings.dynamicHeadingIndentation).onChange(async l=>{this.plugin.settings.dynamicHeadingIndentation=l,await this.plugin.saveSettings(),e.setDisabled(l===i)})})}};var je={autofocusSearchOnOpen:!0,dynamicHeadingIndentation:!0,highlightCurrentHeading:!0,minimumHeadings:1,resetSearchFieldOnHeadingClick:!0,toggleAutomatically:!1,contentOverlap:"allow",toggleOnHover:!1,windowLocation:"right"};function V(v){return(0,R.sanitizeHTMLToDom)(v)}var Se=class extends R.PluginSettingTab{constructor(e,i){super(e,i),this.plugin=i}display(){let{containerEl:e}=this;e.empty(),new R.Setting(e).setName(V("Window behavior")).setHeading().setDesc("Customize the visibility and behavior of the outline window."),new ve(this.plugin,e).display(),new pe(this.plugin,e).display(),new R.Setting(e).setName(V("Navigation and search")).setHeading().setDesc("Configure how you move through and search your outline."),new de(this.plugin,e).display(),new ge(this.plugin,e).display(),new he(this.plugin,e).display(),new R.Setting(e).setName(V("Layout")).setHeading().setDesc(V('To customize the appearance of the Dynamic Outline, please use the <a href="https://obsidian.md/plugins?id=obsidian-style-settings">Style Settings</a> plugin.')),new fe(this.plugin,e).display(),new me(this.plugin,e).display()}};var te="dynamic-outline",Me="dynamic-outline-button",Ae="list",Oe=class extends se.Plugin{constructor(){super(...arguments);this.debounceHandler=(0,se.debounce)(i=>{let n=i.target;if(!(n!=null&&n.classList.contains("dynamic-outline-content-container"))){let l=this.stateManager.getActiveMDView();l&&this.stateManager.getWindowInView(l).highlightCurrentHeading()}},0)}async onload(){await this.loadSettings(),this.addSettingTab(new Se(this.app,this)),this.app.workspace.trigger("parse-style-settings"),this.stateManager=W.initialize(this),this.stateManager.createButtonsInOpenViews(),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.stateManager.createButtonsInOpenViews()})),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.stateManager.handleMetadataChanged()})),this.registerEvent(this.app.metadataCache.on("changed",()=>{this.stateManager.handleMetadataChanged()})),this.settings.toggleAutomatically&&this.registerEvent(this.app.workspace.on("file-open",()=>{this.stateManager.handleFileOpen()})),this.settings.highlightCurrentHeading&&(activeWindow.document.addEventListener("scroll",this.debounceHandler,!0),this.registerEvent(this.app.metadataCache.on("changed",()=>{let i=this.stateManager.getActiveMDView();i&&this.stateManager.getWindowInView(i).highlightCurrentHeading()}))),this.addCommand({id:"toggle-dynamic-outline",name:"Toggle for current file",checkCallback:i=>{let n=this.stateManager.getActiveMDView();return n?(i||this.stateManager.getButtonInView(n).handleClick(),!0):!1}})}onunload(){this.stateManager.removeAll(),activeWindow.document.removeEventListener("scroll",this.debounceHandler,!0)}async loadSettings(){this.settings=Object.assign({},je,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async reloadPlugin(){let i=this.app.plugins,n=this.app.setting;i.enabledPlugins.has(te)&&(await i.disablePlugin(te),await i.enablePlugin(te),await n.openTabById(te),new se.Notice("Dynamic Outline has been reloaded"))}getCssVariableAsNumber(i,n=document.body){let l=getComputedStyle(n).getPropertyValue(i).trim(),d=parseFloat(l);return isNaN(d)?null:d}runCommand(i){this.app.commands.executeCommandById(i)}};
