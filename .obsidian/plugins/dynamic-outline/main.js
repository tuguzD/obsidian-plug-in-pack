/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var P=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var J=Object.getOwnPropertyNames;var Q=Object.prototype.hasOwnProperty;var X=(a,e)=>{for(var t in e)P(a,t,{get:e[t],enumerable:!0})},Y=(a,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of J(e))!Q.call(a,n)&&n!==t&&P(a,n,{get:()=>e[n],enumerable:!(i=G(e,n))||i.enumerable});return a};var Z=a=>Y(P({},"__esModule",{value:!0}),a);var ee={};X(ee,{BUTTON_CLASS:()=>A,LUCID_ICON_NAME:()=>I,WINDOW_ID:()=>b,default:()=>S});module.exports=Z(ee);var h=require("obsidian");var W=require("obsidian");var N=require("obsidian"),v=class{constructor(e,t){this._plugin=e,this._view=t}get headings(){return this._getHeadingsForView(this._view)}_getHeadingsForView(e){var o;let t=e==null?void 0:e.file;if(!t)return[];let n=(o=(this._plugin.app.metadataCache.getFileCache(t)||{}).headings)!=null?o:[];return this._cleanupHeadings(n)}_cleanupHeadings(e){let t=s=>(0,N.htmlToMarkdown)(s).replaceAll("*","").replaceAll("_","").replaceAll("`","").replaceAll("==","").replaceAll("~~",""),i=s=>s.replace(/\[([^\]]+)\]\(.*?\)/g,"$1").replace(/\[\[([^\]]+)\|([^\]]+)\]\]/g,"$2").replace(/\[\[([^\]]+)\]\]/g,"$1"),n=e;return n.forEach(s=>{let o=s.heading;o=t(o),o=i(o),s.heading=o}),n}};var p=class{constructor(e,t){this._plugin=e,t?(this.element=t,this.inputField=this.element.querySelector("input"),this.clearButton=this.element.querySelector(".dynamic-outline-search-clear-button")):(this.element=createEl("div",{cls:"dynamic-outline-search-container"}),this.inputField=createEl("input",{attr:{placeholder:"Search headings...",type:"search"}}),this.element.appendChild(this.inputField),this.clearButton=createEl("div",{cls:"search-input-clear-button dynamic-outline-search-clear-button",attr:{"aria-label":"Clear search"}}),this.element.appendChild(this.clearButton),this._setupEventListeners())}clearInput(){this.inputField.value="";let e=new Event("input",{bubbles:!0,cancelable:!0});this.inputField.dispatchEvent(e),this.inputField.focus()}_setupEventListeners(){this._plugin.registerDomEvent(this.inputField,"input",()=>{this._toggleClearButton()}),this._plugin.registerDomEvent(this.clearButton,"click",()=>{this.clearInput()})}_toggleClearButton(){this.inputField.value.length>0?(this.clearButton.classList.add("visible"),this.inputField.classList.add("has-content")):(this.clearButton.classList.remove("visible"),this.inputField.classList.remove("has-content"))}};var w=class{constructor(e,t){this._plugin=e,this._view=t,this._stateManager=l.getInstance()}createLiElement(e){let t=createEl("li",{attr:{"data-heading-line":e.position.start.line}}),i=createEl("a",{cls:`heading-level-${e.level}`,text:e.heading});return t.append(i),this._setupEventListener(t,e),t}updateLiElementLine(e,t){e.setAttribute("data-heading-line",t.position.start.line.toString()),this._setupEventListener(e,t)}_setupEventListener(e,t){e.onclick=()=>{if(this._view.file&&(this._view.leaf.openFile(this._view.file,{eState:{line:t.position.start.line}}),setTimeout(()=>{this._view.currentMode.applyScroll(t.position.start.line)},0),this._plugin.settings.resetSearchFieldOnHeadingClick)){let n=this._stateManager.getWindow(this._view).getContainerElement().querySelector(".dynamic-outline-search-container");if(!n)return;new p(this._plugin,n).clearInput()}}}};var m=class{constructor(e,t){this._pinned=!1;this._lastHeadings=[];this._plugin=e,this._view=t,this._stateManager=l.getInstance(),this.visible=!1,this._containerEl=this.createElement(),this.setupEventListeners(),this._dynamicHeadings=new v(this._plugin,this._view)}get pinned(){return this._pinned}set pinned(e){this._pinned=e,this._plugin.settings.toggleOnHover&&!e&&this.hide()}setupEventListeners(){this._plugin.registerDomEvent(this._containerEl.querySelector("input"),"input",()=>{this.filterItems()}),this._plugin.settings.toggleOnHover&&(this._plugin.registerDomEvent(this._containerEl,"mouseenter",()=>this.handleMouseEnter()),this._plugin.registerDomEvent(this._containerEl,"mouseleave",()=>this.handleMouseLeave()))}filterItems(){let t=this._containerEl.querySelector("input").value.toLowerCase(),i=this._containerEl.querySelectorAll("li");i==null||i.forEach(n=>{var s;(s=n.textContent)!=null&&s.toLowerCase().includes(t)?n.classList.remove("outline-item-hidden"):n.classList.add("outline-item-hidden")})}handleMouseEnter(){this.clearHideTimeout()}handleMouseLeave(){this._plugin.settings.toggleOnHover&&!this.pinned&&(m.hideTimeout=setTimeout(()=>{this.hide()},100))}getContainerElement(){return this._containerEl}clearHideTimeout(){m.hideTimeout&&(clearTimeout(m.hideTimeout),m.hideTimeout=null)}createElement(){let e=createEl("div",{attr:{id:"dynamic-outline"}}),t=new p(this._plugin);e.appendChild(t.element);let i=createEl("div",{cls:"dynamic-outline-content-container"});return i.createEl("ul",{}),e.appendChild(i),e}checkForObstructions(){let e=document.getElementById("cMenuToolbarModalBar");e!=null&&e.classList.contains("top")&&this._containerEl.classList.add("obstruction-top")}checkForLocation(){this._containerEl.classList.toggle("location-left",this._plugin.settings.windowLocation==="left")}highlightCurrentHeading(e="nearest"){let t=(d,k)=>{let F=0,B=0,V=d.length-1;for(;B<=V;){let O=Math.floor((B+V)/2);d[O].position.start.line<=k?(F=O,B=O+1):V=O-1}return F},i=this._view.currentMode.getScroll(),n=this.getHeadings();if(n.length==0)return;let s=t(n,i+1);this._containerEl.querySelectorAll("li").forEach((d,k)=>d.classList.toggle("highlight",k===s));let u=this._containerEl.querySelector("li.highlight");u==null||u.scrollIntoView({behavior:"instant",block:e})}getHeadings(){return this._dynamicHeadings.headings}update(){let e=(s,o)=>(console.log(s),s.length===o.length&&s.every((u,d)=>u.heading===o[d].heading&&u.level===o[d].level)),t=this._containerEl.querySelector("ul");if(!t)return;let i=new w(this._plugin,this._view),n=this.getHeadings();if(e(n,this._lastHeadings)){t.querySelectorAll("li").forEach((o,u)=>{i.updateLiElementLine(o,n[u])});return}this._lastHeadings=n,t.empty(),n==null||n.forEach(s=>{let o=i.createLiElement(s);t.append(o)}),this._plugin.settings.highlightCurrentHeading&&this.highlightCurrentHeading()}show(e){if(this.visible)return;this.checkForObstructions(),this.checkForLocation(),this.update(),this._view.contentEl.append(this._containerEl),this.visible=!0;let t=this._stateManager.getButton(this._view);if(t.active=!0,this._plugin.settings.autofocusSearchOnOpen){let i=this._containerEl.querySelector("input");i==null||i.focus()}this._plugin.settings.highlightCurrentHeading&&this.highlightCurrentHeading(e==null?void 0:e.scrollBlock)}hide(){if(!this.visible)return;this.visible=!1,this._containerEl.remove();let e=this._stateManager.getButton(this._view);e.active=!1,this._plugin.settings.toggleOnHover&&(this.pinned=!1)}toggle(){this.visible?this.hide():this.show()}},g=m;g.hideTimeout=null;var f=class{constructor(e,t){this._plugin=e,this._view=t,this._stateManager=l.getInstance(),this.visible=!1,this._active=!1,this._containerEl=this.createElement(),this.setupEventListeners()}get active(){return this._active}set active(e){this._active=e,this._containerEl.classList.toggle("button-active",this._active)}setupEventListeners(){this._plugin.registerDomEvent(this._containerEl,"click",()=>this.handleClick()),this._plugin.settings.toggleOnHover&&(this._plugin.registerDomEvent(this._containerEl,"mouseenter",()=>this.handleMouseEnter()),this._plugin.registerDomEvent(this._containerEl,"mouseleave",()=>this.handleMouseLeave()))}createElement(){let e=createEl("button",{cls:`clickable-icon view-action ${A}`,attr:{"aria-label":"Toggle Dynamic Outline"}});return(0,W.setIcon)(e,I),e}handleMouseEnter(){let e=this._stateManager.getWindow(this._view);e.visible||e.show({scrollBlock:"start"}),this._plugin.settings.toggleOnHover&&e.clearHideTimeout()}handleMouseLeave(){let e=this._stateManager.getWindow(this._view);e.visible&&!e.pinned&&(g.hideTimeout=setTimeout(()=>{e.hide()},100))}getViewActionButtons(){return this._view.containerEl.querySelector(".view-actions")}getViewHeaderLeft(){return this._view.containerEl.querySelector(".view-header-left .view-header-nav-buttons")}handleClick(){let e=this._stateManager.getWindow(this._view);if(e.visible){if(this._plugin.settings.toggleOnHover)if(e.pinned)e.pinned=!1,e.clearHideTimeout();else{e.pinned=!0;return}e.hide()}else e.show({scrollBlock:"start"}),e.pinned=!0}show(){if(this._plugin.settings.windowLocation==="right"){let e=this.getViewActionButtons();e&&(e.insertBefore(this._containerEl,e==null?void 0:e.firstChild),this.visible=!0)}else if(this._plugin.settings.windowLocation==="left"){let e=this.getViewHeaderLeft();e&&(e.appendChild(this._containerEl),this.visible=!0)}else console.error("Invalid window location")}hide(){this._containerEl.remove(),this.visible=!1}};var l=class{constructor(e){this._windows=new Map;this._buttons=new Map;this._plugin=e}static initialize(e){return l.instance||(l.instance=new l(e)),l.instance}static getInstance(){if(!l.instance)throw new Error("OutlineStateManager not initialized");return l.instance}getKey(e){return e.leaf.id}getButton(e){let t=this.getKey(e);return this._buttons.has(t)||this._buttons.set(t,new f(this._plugin,e)),this._buttons.get(t)}getWindow(e){let t=this.getKey(e);return this._windows.has(t)||this._windows.set(t,new g(this._plugin,e)),this._windows.get(t)}handleFileOpen(){let e=this._plugin.getActiveMarkdownView();if(!e)return;let t=this.getWindow(e),i=t.getHeadings(),n=i&&i.length>=this._plugin.settings.minimumHeadings;t.visible&&!n?(this._plugin.settings.toggleOnHover&&(t.pinned=!1),t.hide()):!t.visible&&n&&(setTimeout(()=>t.show(),50),this._plugin.settings.toggleOnHover&&(t.pinned=!0))}handleMetadataChanged(){let e=this._plugin.getActiveMarkdownView();e&&this.getWindow(e).update()}createButtonsInActiveViews(){this._plugin.getActiveMarkdownViews().forEach(e=>{if(e.leaf.width===0)return;let t=this.getButton(e);t.visible||t.show()})}removeAll(){this._windows.forEach(e=>e.visible&&e.hide()),this._buttons.forEach(e=>e.visible&&e.hide()),this._windows.clear(),this._buttons.clear()}};var D=require("obsidian");var q=require("obsidian");var r=class{constructor(e,t){this.plugin=e,this.containerEl=t}};var E=class extends r{display(){new q.Setting(this.containerEl).setName("Autofocus search field on open").setDesc("Focus the search field immediately after the outline is opened.").addToggle(e=>{e.setValue(this.plugin.settings.autofocusSearchOnOpen).onChange(async t=>{this.plugin.settings.autofocusSearchOnOpen=t,await this.plugin.saveSettings()})})}};var R=require("obsidian");var _=class extends r{display(){let e,t=this.plugin.settings.highlightCurrentHeading;new R.Setting(this.containerEl).setName("Highlight active heading").setDesc(c("Highlight the current outline heading when scrolling the file.</span>")).addButton(i=>{e=i,i.setButtonText("Reload plugin"),i.setTooltip("Requires a plugin reload to take effect."),i.setDisabled(!0),i.setClass("dynamic-outline-reload"),i.setCta(),i.onClick(()=>{this.plugin.reloadPlugin()})}).addToggle(i=>{i.setValue(this.plugin.settings.highlightCurrentHeading).onChange(async n=>{this.plugin.settings.highlightCurrentHeading=n,await this.plugin.saveSettings(),e.setDisabled(n===t)})})}};var U=require("obsidian");var H=class extends r{display(){new U.Setting(this.containerEl).setName("Style customizations").setDesc(c('Please use the <a href="https://obsidian.md/plugins?id=obsidian-style-settings">Style Settings</a> plugin to apply custom font size, opacity, alignment, etc.'))}};var z=require("obsidian");var y=class extends r{display(){new z.Setting(this.containerEl).setName("Reset search field").setDesc("Erase the search field contents after jumping to a heading.").addToggle(e=>{e.setValue(this.plugin.settings.resetSearchFieldOnHeadingClick).onChange(async t=>{this.plugin.settings.resetSearchFieldOnHeadingClick=t,await this.plugin.saveSettings()})})}};var x=require("obsidian");var M=class extends r{display(){let e,t=this.plugin.settings.toggleAutomatically;new x.Setting(this.containerEl).setName("Toggle automatically").setDesc(c("Show and hide the outline automatically based on the number of headings in the file.</span>")).addButton(n=>{e=n,n.setButtonText("Reload plugin"),n.setTooltip("Requires a plugin reload to take effect."),n.setDisabled(!0),n.setClass("dynamic-outline-reload"),n.setCta(),n.onClick(()=>{this.plugin.reloadPlugin()})}).addToggle(n=>{n.setValue(this.plugin.settings.toggleAutomatically).onChange(async s=>{this.plugin.settings.toggleAutomatically=s,await this.plugin.saveSettings(),e.setDisabled(s===t),i.setDisabled(!s)})});let i=new x.Setting(this.containerEl).setName("Minimum headings").setDesc(c("The minimum number of headings in the file to trigger the outline.")).addSlider(n=>{n.setLimits(1,10,1).setDynamicTooltip().setValue(this.plugin.settings.minimumHeadings).onChange(async s=>{this.plugin.settings.minimumHeadings=s,await this.plugin.saveSettings()})}).setDisabled(!this.plugin.settings.toggleAutomatically)}};var $=require("obsidian");var L=class extends r{display(){let e,t=this.plugin.settings.toggleOnHover;new $.Setting(this.containerEl).setName("Toggle on hover").setDesc(c("Show and hide on mouse hover. Pin the outline on mouse click.</span>")).addButton(i=>{e=i,i.setButtonText("Reload plugin"),i.setTooltip("Requires a plugin reload to take effect."),i.setDisabled(!0),i.setClass("dynamic-outline-reload"),i.setCta(),i.onClick(()=>{this.plugin.reloadPlugin()})}).addToggle(i=>{i.setValue(this.plugin.settings.toggleOnHover).onChange(async n=>{this.plugin.settings.toggleOnHover=n,await this.plugin.saveSettings(),e.setDisabled(n===t)})})}};var K=require("obsidian");var C=class extends r{display(){let e,t=this.plugin.settings.windowLocation;new K.Setting(this.containerEl).setName("Window location").setDesc(c("Set the location for the window (right by default).</span>")).addButton(i=>{e=i,i.setButtonText("Reload plugin"),i.setTooltip("Requires a plugin reload to take effect."),i.setDisabled(!0),i.setClass("dynamic-outline-reload"),i.setCta(),i.onClick(()=>{this.plugin.reloadPlugin()})}).addDropdown(i=>i.addOption("right","Right").addOption("left","Left").setValue(this.plugin.settings.windowLocation).onChange(async n=>{this.plugin.settings.windowLocation=n,await this.plugin.saveSettings(),e.setDisabled(n===t)}))}};var j={autofocusSearchOnOpen:!0,highlightCurrentHeading:!0,minimumHeadings:1,resetSearchFieldOnHeadingClick:!0,toggleAutomatically:!1,toggleOnHover:!1,windowLocation:"right"};function c(a){return(0,D.sanitizeHTMLToDom)(a)}var T=class extends D.PluginSettingTab{constructor(t,i){super(t,i);this.plugin=i}display(){let{containerEl:t}=this;t.empty(),new M(this.plugin,t).display(),new L(this.plugin,t).display(),new _(this.plugin,t).display(),new C(this.plugin,t).display(),new E(this.plugin,t).display(),new y(this.plugin,t).display(),new H(this.plugin,t).display()}};var b="dynamic-outline",A="dynamic-outline-button",I="list",S=class extends h.Plugin{constructor(){super(...arguments);this.getActiveMarkdownView=()=>this.app.workspace.getActiveViewOfType(h.MarkdownView);this.getActiveMarkdownViews=()=>this.app.workspace.getLeavesOfType("markdown").map(t=>t.view);this.debounceHandler=(0,h.debounce)(t=>{let i=t.target;if(!(i!=null&&i.classList.contains("dynamic-outline-content-container"))){let n=this.getActiveMarkdownView();n&&this.stateManager.getWindow(n).highlightCurrentHeading()}},0)}async onload(){await this.loadSettings(),this.addSettingTab(new T(this.app,this)),this.app.workspace.trigger("parse-style-settings"),this.stateManager=l.initialize(this),this.stateManager.createButtonsInActiveViews(),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.stateManager.createButtonsInActiveViews()})),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.stateManager.handleMetadataChanged()})),this.registerEvent(this.app.metadataCache.on("changed",()=>{this.stateManager.handleMetadataChanged()})),this.settings.toggleAutomatically&&this.registerEvent(this.app.workspace.on("file-open",()=>{this.stateManager.handleFileOpen()})),this.settings.highlightCurrentHeading&&(activeWindow.document.addEventListener("scroll",this.debounceHandler,!0),this.registerEvent(this.app.metadataCache.on("changed",()=>{let t=this.getActiveMarkdownView();t&&this.stateManager.getWindow(t).highlightCurrentHeading()}))),this.addCommand({id:"toggle-dynamic-outline",name:"Toggle for current file",checkCallback:t=>{let i=this.getActiveMarkdownView();return i?(t||this.stateManager.getButton(i).handleClick(),!0):!1}})}onunload(){this.stateManager.removeAll(),activeWindow.document.removeEventListener("scroll",this.debounceHandler,!0)}async loadSettings(){this.settings=Object.assign({},j,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async reloadPlugin(){let t=this.app.plugins,i=this.app.setting;t.enabledPlugins.has(b)&&(await t.disablePlugin(b),await t.enablePlugin(b),await i.openTabById(b),new h.Notice("Dynamic Outline has been reloaded"))}};
